---
title: "Borboletas frugívoras"
bibliography: [referencias_cap04.bib]
---


```{r library, echo=FALSE, message=FALSE, warning=FALSE}

library(tidyverse)
library(data.table)
library(descr)
library(RColorBrewer)
library(kableExtra)
library(knitr)
library(DT)
library(plotly)
library(ggthemes)
library(forcats)
library(leaflet)
library(sf)
library(rgdal)
library(treemapify)
library(reshape2)
library(randomcoloR)
library(gridExtra)
```



</br>

**Isabela Freitas Oliveira**^1-2^, **Arlindo Gomes Filho**^3^ & **Onildo João Marini Filho**^1^


1. Centro Nacional de Pesquisa e Conservação da Biodiversidade do Cerrado e Restauração Ecológica - CBC  
*Instituto Chico Mendes de Conservação da Biodiversidade – ICMBio*  
*Parque Nacional de Brasília*  
*Via Epia, BR-450, Km 8,5*  
*70635-800 Brasília, DF*  

2. Coordenação de Monitoramento da Biodiversidade - COMOB  
*Instituto Chico Mendes de Conservação da Biodiversidade – ICMBio*  
*Complexo Administrativo EQSW 103/104 s/n*  
*70670-350 Brasília, DF*  

3. Centro Nacional de Pesquisa e Conservação de Aves Silvestres – CEMAVE\
*Instituto Chico Mendes de Conservação da Biodiversidade – ICMBio*\
*BR-230 Km 10*\
*Floresta Nacional da Restinga de Cabedelo*\
*58108-012 Cabedelo, PB*



<p><font size="2">

<b>Como citar</b>: Oliveira, I. F.; Gomes-Filho, A. G.; Marini-Filho, O. J. Borboletas frugívoras. In:  Programa Nacional de Monitoramento da Biodiversidade – Programa Monitora, Subprograma Terrestre, componente Florestal. Relatório 2014-2022. Instituto Chico Mendes de Conservação da Biodiversidade, Brasília, 2024.

</font></p>

</br>

Os insetos estão entre os organismos mais diversos e ameaçados do mundo (@Cardoso_2020; @Wagner_2020; @Janzen_2021). Entender como essa diversidade está distribuída no tempo e no espaço é crucial, visto que muitas espécies estão sendo extintas antes mesmo de serem descobertas pela ciência (@Eggleton_2020; @Liu_2022). O Brasil, um país extenso e megadiverso, conta com poucos projetos de longo prazo (mais de cinco anos) voltados a investigar padrões de diversidade locais e regionais,  especialmente em grupos de invertebrados como insetos (@Costa_2020). A maioria das pesquisas abrange escalas locais e curtos períodos de tempo (@Ribeiro_2010; @Graca_2016; @Beirao_2017; @Araujo_2020;  @Oliveira_2021; @Bellaver_2023; @Brito_Freire_2022), contribuindo significativamente para a compreensão de padrões de diversidade específicos, mas ressaltando a importância da implementação de projetos de longa duração em diversas áreas do país. 

Nas últimas décadas, as borboletas frugívoras têm sido utilizadas como organismos modelo em monitoramentos de fauna em diversos países da região tropical (@Hughes_1998; @Molleman_2006; @DeVries_2012; @Aduse-Poku_2012; @Nyafwono_2014; @VanSwaay_2015; @Freitas_2024). A seleção deste grupo se deve à sua grande diversidade e significância ecológica, aliada à facilidade de amostragem por meio de armadilhas atrativas (@DeVries_Walla_2001; @Freitas_2014). O uso dessas armadilhas possibilita a amostragem simultânea em várias áreas, padronizando o esforço amostral e reduzindo a chance de viés nos dados. Além disso, as borboletas frugívoras são altamente sensíveis a alterações ambientais, o que as torna indicadoras valiosas de perturbações nos *habitat* (@Bonebrake_2010; @Oliveira_2018). Essas transformações ambientais em escala local ou regional podem influenciar nas variações no número de espécies e indivíduos das borboletas, bem como nas mudanças de composição da comunidade (@Oliveira_2023). Assim, devido ao seu curto ciclo de vida, estas mudanças na comunidade de borboletas são observadas relativamente rápido. Outros fatores determinantes para a escolha de borboletas frugívoras em estudos de monitoramento são a relativa facilidade na identificação e sua boa resolução taxônomica, quando comparadas a outros grupos de insetos. 

Neste capítulo, serão apresentados os resultados gerais da aplicação do protocolo básico de borboletas frugívoras em unidades de conservação (UCs) federais do Programa Monitora.  


</br>

## Métodos, implementação e validação protocolar

</br>



Os métodos de amostragem das borboletas frugívoras seguiram o Roteiro Metodológico do Programa Monitora (@Nobre_2014) e uma breve descrição geral dos procedimentos adotados em campo é apresentada no capítulo 2 deste relatório.  

</br>


## Resultados

</br>  


O protocolo básico de amostragem de borboletas frugívoras, com identificação taxonômica no nível de tribo, foi aplicado em 50 UCs^[Neste relatório os dados da ESEC da Terra do Meio e da RESEX do Rio Iriri foram agrupados e tratados conjuntamente, como uma única unidade de análise (um bloco).], durante o período de 2014 a 2022, Dessas, 31 (62%) já estão consolidadas, isto é, com três ou mais EAs em operação. O protocolo avançado de borboletas frugívoras foi aplicado, em algum momento, em 31 UCs, embora parte dos dados ainda aguarde validação  (@fig-mapa-distribuicao-ucs-borboletas).  

</br>


```{r figura - distribuição ucs borboletas}
#| label: fig-mapa-distribuicao-ucs-borboletas
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Distribuição das unidades de conservação com amostragem de borboletas frugívoras no Componente Florestal do Programa Monitora – 2014 a 2022."

knitr::include_graphics("imagens/cap04/bo_mapa_distribuicao-ucs-borboletas.jpeg")

```


</br>


Após a correção, limpeza e verificação dos dados foram contabilizadas 85.386 borboletas frugívoras capturadas de 2014 a 2022. Desse total, 915 indivíduos (1%) foram registrados como ‘NA’ em sua tribo, sem a chance de verificação por falta de fotografias. Assim, 84.471 indivíduos foram identificados a nível de tribo pelos monitores. Na Amazônia, foram capturados 76.308 indivíduos, no Cerrado 6.378 e na Mata Atlântica 2.700 indivíduos.  

O esforço amostral de borboletas frugívoras vem aumentando desde o início da implementação do Programa Monitora (exceto em 2020). Entre 2014 e 2019, o esforço amostral aumentou linearmente, tendo atingido um total de cerca de 17.152 armadilhas-dia em 2019. Em 2020, ano com maior impacto da pandemia de Covid-19, houve uma queda de 74% em relação ao ano anterior. No entanto, em 2021, o esforço amostral ainda não havia se recuperado totalmente, tendo voltado a crescer apenas em 2022, com um aumento de 15% em relação a 2019 (@fig-esforco-amostral).  

De maneira geral, observou-se que o número de indivíduos amostrados acompanhou o esforço amostral, havendo um aumento na abundância de borboletas com o aumento do esforço amostral. Porém, os últimos anos apresentaram uma abundância menor em relação ao esforço (Figura 4.2). Ao todo, foram capturados 85.386 indivíduos de borboletas, com um esforço amostral de 90.320 armadilhas/dia no período de 2014 a 2022 (@fig-esforco-amostral). 


</br>

 
```{r grafico ucs_ativas_taxa_acumulado}
#| label: fig-esforco-amostral
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Variação no número de registros de borboletas frugívoras e esforço amostral (número de armadilhas * número de dias de amostragem) acumulados por ano do Programa Monitora."


# #Script: Isabela Freitas Oliveira
# 
# library(dplyr)
# 
# # Ler e limpar dados_borboletas
# dados_borboletas <- read.table("dados/borboletas/dados_analise_borboletas_Isabela_V2.txt", header = TRUE)
# dados_borboletas <- dados_borboletas %>%
#   filter(ano != "2023", !is.na(tribo))
# 
# 
# # Calcular o esforço amostral para cada combinação de uc_ea, expedicao e ano
# esforco_por_expedicao <- dados_borboletas %>%
#   group_by(uc_ea, uc, expedicao, ano) %>%
#   summarize(
#     max_dia_amostragem = max(dia_amostragem) - 1,
#     .groups = 'drop'
#   ) %>%
#   mutate(
#     esforco_amostral = 16 * max_dia_amostragem
#   )
# 
# # Agregar o esforço de amostragem para cada uc_ea e ano
# esforco_total_por_ea_ano <- esforco_por_expedicao %>%
#   group_by(uc_ea, ano) %>%
#   summarize(
#     esforco_total_ano = sum(esforco_amostral),
#     .groups = 'drop'
#   )
# 
# # Agregar o esforço de amostragem para cada uc e ano
# esforco_total_por_uc_ano <- esforco_por_expedicao %>%
#   group_by(uc, ano) %>%
#   summarize(
#     esforco_total_ano = sum(esforco_amostral),
#     .groups = 'drop'
#   )
# 
# 
# # Agregação para obter o esforço total por ano por uc
# esforco_por_ano_uc <- esforco_total_por_uc_ano %>%
#   group_by(ano,uc) %>%
#   summarize(
#     esforco = sum(esforco_total_ano),
#     .groups = 'drop'
#   )
# 
# # Agregação para obter o esforço total por ano
# esforco_por_ano <- esforco_total_por_uc_ano %>%
#   group_by(ano) %>%
#   summarize(
#     esforco = sum(esforco_total_ano),
#     .groups = 'drop'
#   )
# 
# # Agregação para obter o número total de indivíduos por ano
# num_ind_por_ano <- dados_borboletas %>%
#   group_by(ano) %>%
#   summarize(
#     num_ind = sum(individuos, na.rm = TRUE),
#     .groups = 'drop'
#   )
# 
# 
# # Juntar as duas tabelas agregadas
# tabela_final_esfoco <- left_join(esforco_por_ano, num_ind_por_ano, by = "ano")
# #write.csv(tabela_final_esfoco, "tabela_final_esfoco.csv", row.names = FALSE)
# 
# 
# #####Fazer o gráfico de Abundancia e esforço
# # Definindo os dados para cada série separadamente
# dados_esforco <- tabela_final_esfoco[, c("ano", "esforco")]
# names(dados_esforco)[2] <- "valor"
# dados_esforco$tipo <- "Esforço"
# 
# dados_abundancia <- tabela_final_esfoco[, c("ano", "num_ind")]
# names(dados_abundancia)[2] <- "valor"
# dados_abundancia$tipo <- "Abundância"
# 
# # Juntando os dados
# dados_plot <- rbind(dados_esforco, dados_abundancia)
# 
# # Criando o gráfico
# grafico <- ggplot(data = dados_plot, aes(x = ano, y = valor, colour = tipo, linetype = tipo, shape = tipo)) +
#   geom_line(size = 1.0) +
#   geom_point(size = 3) +
#   scale_colour_manual(values = c("Esforço" = "#35978f", "Abundância" = "#dfc27d")) +
#   scale_linetype_manual(values = c("Esforço" = "solid", "Abundância" = "solid")) +
#   scale_shape_manual(values = c("Esforço" = 16, "Abundância" = 17)) +
#   scale_y_continuous(
#     "Esforço Amostral e Abundância",
#     labels = scales::label_number(big.mark = ".", decimal.mark = ","),
#     limits = c(0, 25000)
#   ) +
#   scale_x_continuous(breaks = tabela_final_esfoco$ano) +
#   labs(
#     title = "",
#     x = " ",
#     y = "Esforço Amostral e Abundância",
#     colour = "",
#     shape = "", # Isso ajuda a garantir que as formas correspondam na legenda
#     linetype = "" # Isso ajuda a garantir que os tipos de linha correspondam na legenda
#   ) +
#   theme_minimal() +
#   theme(
#     plot.title = element_text(hjust = -0.5, size = 18, lineheight = 1.5), # Ajuste o lineheight conforme necessário
#     legend.position = c(0.10, 0.93), # Define a posição da legenda no canto superior esquerdo
#     legend.justification = c(0, 1), # Define a justificação da legenda para o canto superior esquerdo
#     legend.box.just = "left", # Alinha a legenda à esquerda
#     legend.box.background = element_rect(fill = "white", color = "white"),
#     axis.ticks.y = element_line(color = "black"),
#     axis.text.y = element_text(margin = margin(r = 5)),
#     axis.text.x = element_text(margin = margin(r = 12)),
#     axis.title.y = element_text(size = 10, margin = margin(r = 10)),
#     axis.title.x = element_text(size = 10, margin = margin(t = 10)),
#     axis.text = element_text(size = 10),
#     axis.line = element_line(colour = "gray40"),
#     legend.text = element_text(size = 10),
#     axis.line.x = element_blank(),
#     panel.grid.minor = element_blank()
#   )
# 
# grafico
# 
# ggsave("imagens/cap04/bo_esforco.JPG",
#        #plot = last_plot(),
#        device =  "jpeg",
#        scale=0.6,
#        width = 300,
#        height = 240,
#        units = "mm",
#        dpi = 120)

knitr::include_graphics("imagens/cap04/bo_esforco.JPG")

```

</br>


### Regiões climáticas

</br>


Os períodos de amostragem propostos no protocolo do Programa Monitora para borboletas frugívoras na Amazônia seguem a mesma lógica aplicada para as regiões Central e Sudeste do Brasil, onde há alta abundância populacional e maior diversidade de espécies de borboletas frugívoras no final do período de chuvas intensas e no período seco (@Barlow_2007; @Checa_2009; @Ribeiro_2010). No entanto, há algumas exceções que precisam ser avaliadas caso a caso. Os períodos de amostragem para as regiões amazônicas apresentados a seguir baseiam-se na caracterização climática associada ao padrão de chuvas em toda a Amazônia (@Marengo_2001; @Sampaio_2021). Com base na identificação dos padrões de chuva em cada região, foram definidas seis regiões climáticas que englobam as Unidades de Conservação participantes do Programa Monitora (@fig-regioes-climaticas). As regiões climáticas são: Sudoeste, Central, Leste, Sudeste, Norte e Noroeste. Isso permite determinar o período mais adequado para a amostragem (@tbl-periodos-amostragem), considerando que o regime de chuvas é uma característica regional relevante para as borboletas frugívoras (@Barlow_2007; @Checa_2009). A definição deste período e sua manutenção ao longo do tempo possibilitam que as comparações interanuais sejam feitas considerando as populações mais abundantes daquele período. 


</br>

```{r tabela periodos de amostragem amazonia}
#| label: tbl-periodos-amostragem
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| tab-cap: "Unidades de conservação por região climática da Amazônia e períodos indicados para amostragens de borboletas (final das chuvas). UCs com * situam-se em duas ou mais regiões climáticas (q. = quinzena)."

tabela_periodos_amostragem <- read.csv2("dados/tabelas/borboletas/tab_periodos_amostragem.csv", fileEncoding='UTF-8', check.names=F)

tab_periodos_amostragem <- kbl(tabela_periodos_amostragem,
             booktabs = TRUE,
             longtable = TRUE,
             caption = "Unidades de conservação por região climática da Amazônia e períodos indicados para amostragens de borboletas (final das chuvas). UCs com * situam-se em duas ou mais regiões climáticas (q. = quinzena).",
            col.names = c("Unidade de Conservação", "Região", "Período de Amostragem"), align = c("l", "c", "c")) %>%
    #column_spec(3, italic = TRUE) %>%
kable_styling(full_width = F, bootstrap_options = c("striped", "hover", "condensed", "responsive"), latex_options = c("repeat_header"), repeat_header_text = "\\textit{(continuação)}")


tab_periodos_amostragem

```


</br>


O número de UCs amostradas varia bastante entre as regiões (@fig-regioes-climaticas). Atualmente, nenhuma UC da região Noroeste da Amazônia participa do Programa Monitora aplicando o protocolo de borboletas frugívoras. No entanto, seria de extrema importância implementar esse protocolo em pelo menos três UCs nessa região: ESEC Juami-Japurá, PARNA do Pico da Neblina e RESEX Auatí-Paraná. Outra região climática em que se faz necessária a inclusão de mais UCs para o protocolo de borboletas frugívoras é a sudeste amazônica. Esta região é de extrema importância por abrigar uma rica diversidade de espécies e estar constantemente ameaçada pelo agronegócio e mineração. Assim sugerimos a inclusão da ESEC Iquê, REBIO Nascentes da Serra do Cachimbo, FLONA Jamanxim, PARNA Rio Novo e FLONA de Carajás. Além dessas regiões, é importante também a inclusão de UCs mais ao norte da região climática sudoeste. Assim, sugere-se a inclusão de UCs no médio e baixo rio Juruá, como as RESEX Médio Juruá, Baixo Juruá e FLONA de Tefé. 


</br>


```{r figura - mapa das regiões climáticas}
#| label: fig-regioes-climaticas
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '60%'
#| fig-cap: "Distribuição das UCs do Programa Monitora com amostragens de borboletas frugívoras nos polígonos das regiões climáticas da Amazônia definidos em função do regime de chuvas. Note as regiões com maiores lacunas de UCs participantes do Programa Monitora: Noroeste, Sudeste e porção norte da região Sudoeste. Cada UC está indicada pelo seu código no Cadastro Nacional de Unidades de Conservação - CNUC."

knitr::include_graphics("imagens/cap04/bo_mapa_ucs.jpeg")

```


</br>


A região Sudoeste amazônica foi a que teve o maior número de UCs aplicando o protocolo de borboletas no período de 2014 a 2022, com 15 UCs amostradas: ESEC Rio Acre, FLONA do Jamari, PARNA da Serra da Cutia, PARNA da Serra do Divisor, PARNA de Pacaás Novos, PARNA Mapinguari, REBIO do Jaru, RESEX Arapixi, RESEX Barreiro das Antas, RESEX Chico Mendes, RESEX do Alto Tarauacá, RESEX do Cazumbá-Iracema, RESEX do Rio do Cautário, RESEX Rio Ouro Preto e RESEX Riozinho da Liberdade. Nesta região, as coletas foram realizadas em 48 EAs, contando com a colaboração de diversos monitores comunitários, habitantes das Reservas Extrativistas (@fig-ucs-eas-combinado).  


De 2014 a 2022 as amostragens de borboletas frugívoras na região climática central amazônica foram realizadas em 37 EAs em 11 UCs (@fig-ucs-eas-combinado): ESEC da Terra do Meio, FLONA de Tapajós, PARNA da Amazônia, PARNA dos Campos Amazônicos, PARNA do Jaú, PARNA Nascentes do Lago Jari, REBIO do Uatumã, RESEX do Lago do Capanã Grande, RESEX Riozinho do Anfrísio, RESEX Tapajós-Arapiuns e RESEX Verde para Sempre.  

Na região Leste amazônica, as amostragens se iniciaram em 2016. Até 2022, seis UCs e 17 EAs foram amostradas (@fig-ucs-eas-combinado): ESEC do Jari, PARNA do Cabo Orange, PARNA Montanhas do Tumucumaque, REBIO do Gurupi, RESEX Ipaú-Anilzinho e RESEX Renascer.  

Na região Sudeste amazônica, as amostragens de borboletas frugívoras também se iniciaram em 2016 e ocorreram em seis EAs, contemplando apenas duas UCs: PARNA do Juruena e REBIO do Tapirapé.  

Finalmente, na região Norte da Amazônia, a aplicação do protocolo de borboletas frugívoras se iniciou em 2017, com cinco UCs e nove EAs amostradas até 2022 (@fig-ucs-eas-combinado): ESEC de Maracá, ESEC de Niquiá, PARNA da Serra da Mocidade, PARNA do Monte Roraima e PARNA do Viruá. 


</br>


```{r numero-ucs-amostradas}
#| label: fig-numero-ucs-amostradas
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '60%'



# library(tidyverse)
# library(ggplot2)
# library(stringr)

# # Carregar os dados
# dados_borboletas <- read.table("dados/borboletas/dados_analise_borboletas_Isabela_V2.txt", header = TRUE)
# dados_borboletas <- dados_borboletas[dados_borboletas$ano != "2023", ]
# 
# # Converter o ano para fator
# dados_borboletas$ano <- factor(dados_borboletas$ano)
# 
# # Filtrar os dados para incluir apenas regiões da Amazônia
# dados_amazonia <- dados_borboletas %>%
#   filter(regiao %in% c("central", "sudoeste", "leste", "sudeste", "norte"))
# 
# # Preparar os dados para o gráfico
# contagem_uc_amazonia <- dados_amazonia %>%
#   group_by(ano, regiao) %>%
#   summarise(num_uc = n_distinct(uc))
# 
# # Definir a ordem dos níveis da variável regiao
# contagem_uc_amazonia$regiao <- factor(contagem_uc_amazonia$regiao, levels = c("central", "sudoeste", "leste", "sudeste", "norte"))
# 
# 
# # Cores para cada região da Amazônia
# cores_amazonia <- c(
#   "#003c30",
#   "#01665e",
#   "#35978f",
#   "#80cdc1",
#   "#c7eae5"
# )
# 
# # Gráfico
# grafico_uc_amazonia <- ggplot(contagem_uc_amazonia, aes(x = ano, y = num_uc, fill = regiao)) +
#   geom_bar(stat = "identity", position = "dodge") +
#   scale_fill_manual(values = cores_amazonia) + # Definindo as cores manualmente
#   labs(
#     x = "",
#     y = "",
#     fill = "",
#     title = ""
#   ) +
#   theme_minimal() +
#   theme(
#     plot.title = element_text(size = 26, hjust = 0, lineheight = 1.3),
#     legend.position = c(0, 1.15), # Define a posição da legenda no canto superior esquerdo
#     legend.justification = c(0, 1), # Define a justificação da legenda para o canto superior esquerdo
#     legend.box.just = "left", # Alinha a legenda à esquerda
#     legend.title = element_text(size = 20),
#     legend.text = element_text(size = 20),
#     axis.title.x = element_text(size = 20), 
#     axis.text.x = element_text(size = 18),  
#     #axis.line = element_line(colour = "gray40"),
#     axis.line.x = element_blank(),
#     axis.text.y = element_blank(),
#     panel.grid.minor = element_blank() 
#   ) 
# 
# # Exibir o gráfico
# print(grafico_uc_amazonia)
# 
# ##f1
# grafico_uc_amazonia <- ggplot(contagem_uc_amazonia, aes(x = ano, y = num_uc, fill = regiao)) +
#   geom_bar(stat = "identity", position = "dodge") +
#   geom_text(aes(label = num_uc), position = position_dodge(width = 0.9), vjust = -0.3, size = 3) + # Adicionando os valores
#   scale_fill_manual(values = cores_amazonia) + # Definindo as cores manualmente
#   labs(
#     x = "",
#     y = "",
#     fill = "",
#     title = "Número de UCs"
#   ) +
#   theme_minimal() +
#   theme(
#     plot.title = element_text(size = 14, hjust = 0.3, lineheight = 1.3),
#     legend.position = c(0, 1.15), # Define a posição da legenda no canto superior esquerdo
#     legend.justification = c(0, 1), # Define a justificação da legenda para o canto superior esquerdo
#     legend.box.just = "left", # Alinha a legenda à esquerda
#     legend.title = element_text(size = 10),
#     legend.text = element_text(size = 8),
#     axis.title.x = element_text(size = 12), 
#     axis.text.x = element_text(size = 10),  
#     #axis.line = element_line(colour = "gray40"),
#     axis.line.x = element_blank(),
#     axis.text.y = element_blank(),
#     panel.grid.major = element_blank(),
#     panel.grid.minor = element_blank() 
#   ) 
# 
# # Exibir o gráfico
# print(grafico_uc_amazonia)


# Salvar a imagem usando ggsave()

# ggsave(
#   filename = "grafico_numeros_de_uc_amazonia_f1.png",
#   plot = grafico_uc_amazonia,
#   device = "png",
#   path = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela",
#   dpi = 300,
#   width = 12,
#   height = 8,
#   units = "in"
# )


```


</br>

```{r numero-eas-amostradas}
#| label: fig-numero-eas-amostradas
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '60%'


# library(tidyverse)
# library(ggplot2)
# library(stringr)

# # Carregar os dados
# dados_borboletas <- read.table("dados/borboletas/dados_analise_borboletas_Isabela_V2.txt", header = TRUE)
# dados_borboletas <- dados_borboletas[dados_borboletas$ano != "2023", ]
# 
# # Converter o ano para fator
# dados_borboletas$ano <- factor(dados_borboletas$ano)
# 
# # Filtrar os dados para incluir apenas regiões da Amazônia
# dados_amazonia <- dados_borboletas %>%
#   filter(regiao %in% c("central", "sudoeste", "leste", "sudeste", "norte"))
# 
# # Preparar os dados para o gráfico
# contagem_ea_amazonia <- dados_amazonia %>%
#   group_by(ano, regiao) %>%
#   summarise(num_ea = n_distinct(uc_ea))
# 
# # Definir a ordem dos níveis da variável regiao
# contagem_ea_amazonia$regiao <- factor(contagem_ea_amazonia$regiao, levels = c("central", "sudoeste", "leste", "sudeste", "norte"))
# 
# 
# # Cores para cada região da Amazônia
# cores_amazonia <- c(
#   "#543005",
#   "#8c510a",
#   "#bf812d",
#   "#dfc27d",
#   "#f6e8c3"
# )
# 
# 
# # Gráfico
# grafico_ea_amazonia<-ggplot(contagem_ea_amazonia, aes(x = ano, y = num_ea, fill = regiao)) +
#   geom_bar(stat = "identity", position = "dodge") +
#   geom_text(aes(label = num_ea), position = position_dodge(width = 0.9), vjust = -0.3, size = 3) + # Adicionando os valores
#   scale_fill_manual(values = cores_amazonia) + # Definindo as cores manualmente
#   labs(
#     x = "",
#     y = "",
#     fill = "",
#     title = "Número de EAs"
#   ) +
#   theme_minimal() +
#   theme(
#     plot.title = element_text(size = 14, hjust = 0.3, lineheight = 1.3),
#     legend.position = c(0, 1.15), # Define a posição da legenda no canto superior esquerdo
#     legend.justification = c(0, 1), # Define a justificação da legenda para o canto superior esquerdo
#     legend.box.just = "left", # Alinha a legenda à esquerda
#     legend.title = element_text(size = 10),
#     legend.text = element_text(size = 8),
#     axis.title.x = element_text(size = 12), 
#     axis.text.x = element_text(size = 10),  
#     #axis.line = element_line(colour = "gray40"),
#     axis.line.x = element_blank(),
#     axis.text.y = element_blank(),
#     panel.grid.major = element_blank(),
#     panel.grid.minor = element_blank() 
#   ) 
# 
# # Exibir o gráfico
# print(grafico_ea_amazonia)


# Salvar a imagem usando ggsave()

# ggsave(
#   filename = "grafico_numeros_de_ea_amazonia_f1.png",
#   plot = grafico_ea_amazonia,
#   device = "png",
#   path = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela",
#   dpi = 300,
#   width = 12,
#   height = 8,
#   units = "in"
# )

```
</br>

```{r ucs-eas-amostradas}
#| label: fig-ucs-eas-amostradas
#| echo: false
#| message: false
#| warning: false
#| include: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '75%'
#| fig-cap: "Número de unidades de conservação (UCs) e estações amostrais (EAs) do Programa Monitora na região amazônica por região climática com amostragem de borboletas frugívoras implementadas de 2014 a 2022."



# library(gridExtra)
# combinado <- grid.arrange(grafico_uc_amazonia, grafico_ea_amazonia, ncol=1)

# ggsave(
#   filename = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela/ucs_eas_combinados.png",
#   plot = combinado,
#   device = "png",
#   dpi = 300,
#   width = 14,
#   height = 12,
#   units = "in"
# )

``` 

```{r grafico ucs-eas-combinado}
#| label: fig-ucs-eas-combinado
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '75%'
#| fig-cap: "Número de UCs e EAs amostradas por região climática na Amazônia por ano. A região climática Noroeste não teve UCs com amostragens no período de 2014-2022."

knitr::include_graphics("imagens/cap04/bo-ucs-eas-combinados.png")

```



</br>


Para maior confiabilidade das informações apresentadas neste relatório, foi estabelecido um esforço amostral mínimo por ano para os biomas. Para cada região Amazônica foram consideradas amostragens suficientemente boas aquelas que tiveram esforço amostral de pelo menos 1.728 armadilhas*dia, equivalendo a nove EAs amostradas no ano, considerando duas campanhas amostrais por EA/ano.   


</br>


## Assinatura das tribos de borboletas ao longo dos anos  

</br>

O Programa Monitora convencionou chamar a distribuição acumulada de frequências relativas da abundância de espécies identificadas ao nível de tribos de “assinatura de tribos” (ver relatórios do Programa Monitora 2014-2016 e 2014-2018). Essa assinatura de tribos de borboletas é uma forma gráfica de representar as proporções das tribos de borboletas de uma determinada comunidade presente naquele ano ou local. A adoção da assinatura ao nível de tribo levou em consideração que este é o nível taxonômico que permite fazer generalizações sobre as tendências observadas na comunidade de borboletas frugívoras (@Freitas_2024). Ela se torna efetiva quando comparada em longo prazo ou entre locais. Com a assinatura de borboletas, detectam-se variações nas tribos mais representativas daquela comunidade amostrada, sendo possível assim, realizar diagnósticos ambientais mais informativos para aquela região ou ano.  

A abordagem que vem sendo utilizada no Programa Monitora considera a existência de diferentes níveis de associação entre as tribos de borboletas frugívoras e a estrutura das formações florestais, variando das florestas mais alteradas ou abertas até florestas mais adensadas e fechadas. O protocolo adotado pelo grupo de especialistas em borboletas consultado pelo ICMBio considerou que as tribos registradas estão relacionadas aos seguintes tipos de ambientes: 

- Florestas fechadas/preservadas: Brassolini, Haeterini e Morphini. Em situações de perturbação da floresta, a abundância relativa dessas tribos diminui consistentemente; 

- Florestas abertas/perturbadas (com abertura significativa no dossel): Ageroniini, Callicorini e Biblidini. As espécies dessas tribos são favorecidas por alterações na estrutura da floresta e suas abundâncias aumentam consistentemente com perturbações locais. 

As tribos Preponini, Melanitini, Anaeini, Epicaliini, Epiphilini, Coeini e Satyrini não apresentam associação clara com ambientes florestais ou não demonstram tendência definida. A abundância dessas tribos pode aumentar ou diminuir em resposta a perturbações da floresta, como abertura de clareiras ou eventuais alterações no dossel. 

Embora ainda pouco disseminada em trabalhos acadêmicos, a assinatura de tribos de borboletas é uma métrica versátil e biologicamente fundamentada que tem um papel importante no monitoramento de fauna. Esta é uma maneira viável de analisar e apresentar dados de um grupo com grande riqueza de espécies de uma região megadiversa, amostrado em uma escala tão ampla como a região Amazônica, ou pequenas como uma determinada UC. 


```{r preparação gráficos assinaturas2}
#| label: prep-graficos-assinaturas2
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
# 
# # Gráficos de dados Borboletas - Protocolo básico - Amazônia regional - individual
# ### Tribos com asterisco estão ausentes nos dados
# ## Script: Isabela Freitas Oliveira
# 
# library(ggplot2)
# library(dplyr)
# library(scales)
# library(tools)
# 
# # Função auxiliar para ajustar o título
# ajustar_titulo <- function(titulo) {
#   palavras <- strsplit(titulo, " ")[[1]]
#   
#   # Palavras que necessitam de correção de acentuação
#   correcoes <- list(
#     "leste" = "Região climática Leste Amazônica", "sudoeste" = "Região climática Sudoeste Amazônica", "central" = "Região climática Central Amazônica",
#     "norte" = "Região climática Norte Amazônica", "sudeste" = "Região climática Sudeste Amazônica"
#   )
#   
#   palavras <- sapply(palavras, function(palavra) {
#     # Aplicar regras específicas para certas palavras
#     if (tolower(palavra) %in% c("esec", "flona", "rebio", "resex", "parna")) {
#       return(toupper(palavra))
#     } else if (tolower(palavra) %in% c("de", "da", "do", "dos", "das")) {
#       return(tolower(palavra))
#     } else {
#       # Corrigir acentuação, se necessário
#       palavra_corrigida <- tolower(palavra)
#       if (palavra_corrigida %in% names(correcoes)) {
#         return(correcoes[[palavra_corrigida]])
#       } else {
#         return(tools::toTitleCase(palavra))
#       }
#     }
#   })
#   
#   return(paste(palavras, collapse = " "))
# }
# 
# 
# # Função para gerar o gráfico para cada região
# gerar_grafico_por_regiao <- function(dados, nome_regiao) {
#   # Preparar o título
#   titulo <- ajustar_titulo(nome_regiao)  # Utilizando a função de ajuste de título aqui
#   
#   # Filtrar os dados para a região atual
#   dados_regiao <- subset(dados, regiao == nome_regiao & bioma == "Amazonia")
#   dados_regiao <- dados_regiao[!is.na(dados_regiao$tribo), ] #tirar os dados 'NA' que estão na tribo
#   
#   # Calcular o total de indivíduos por ano para a região atual
#   total_individuos_por_ano <- dados_regiao %>%
#     group_by(ano) %>%
#     summarise(total = sum(soma_individuos), .groups = 'drop')
#   
#   # Agregar dados por ano e tribo
#   dados_agregados <- dados_regiao %>%
#     group_by(ano, tribo) %>%
#     summarize(frequencia = sum(soma_individuos), .groups = 'drop')
#   
#   # Calcular totais e proporções
#   total_por_ano <- dados_agregados %>%
#     group_by(ano) %>%
#     summarize(total = sum(frequencia), .groups = 'drop')
#   
#   dados_agregados <- left_join(dados_agregados, total_por_ano, by = "ano") %>%
#     mutate(proporcao = frequencia / total * 100)
#   
#   # Ajustar proporções
#   dados_agregados <- dados_agregados %>%
#     group_by(ano) %>%
#     mutate(diferenca = 100 - sum(proporcao),
#            proporcao_ajustada = ifelse(proporcao == max(proporcao), proporcao + diferenca, proporcao)) %>%
#     ungroup() %>%
#     dplyr::select(-diferenca, -proporcao) %>%
#     rename(proporcao = proporcao_ajustada)
#   
#   # Ordem específica das tribos
#   ordem_tribos <- c(
#     "Brassolini", "Morphini", "Haeterini", 
#     "Preponini", "Melanitini", "Anaeini", 
#     "Epicaliini","Epiphilini", "Coeini",
#     "Satyrini",
#     "Callicorini", "Biblidini","Ageroniini"
#   )
#   
#   # Cores correspondentes às tribos - BLINDSAFE colors (3 categorias de verde, 7 categorias de cinza e 3 categorias de marrom)
#   cores_tribos <- c(
#     "Brassolini" = "#35978f", "Morphini" = "#80cdc1", "Haeterini" = "#c7eae5", 
#     "Preponini" = "gray65", "Melanitini" = "gray70", "Anaeini" = "gray75", 
#     "Epicaliini" = "gray80", "Epiphilini" = "gray85", "Coeini" = "gray90",
#     "Satyrini" = "gray95",
#     "Callicorini" = "#f6e8c3", "Biblidini" = "#dfc27d","Ageroniini" = "#bf812d"
#   )
#   
#   # Ajustar a ordem e as cores das tribos com base nas tribos presentes
#   cores_tribos <- cores_tribos[ordem_tribos]
#   
#   # Assegurar que a coluna 'tribo_clean' respeite a ordem definida
#   dados_agregados$tribo <- factor(dados_agregados$tribo, levels = ordem_tribos)
#   
#   # Criar um data frame com a frequência agregada por tribo
#   frequencias_por_tribo_ano <- aggregate(frequencia ~ tribo, dados_agregados, sum)
#   
#   # Criar uma função para determinar se um asterisco deve ser adicionado ao nome da tribo
#   adicionar_asterisco <- function(nome_tribo) {
#     # Verificar se existe alguma frequência igual a zero para essa tribo em qualquer ano
#     if (any(frequencias_por_tribo_ano$tribo == nome_tribo & frequencias_por_tribo_ano$frequencia == 0)) {
#       return(paste0(nome_tribo, "*"))
#     } else {
#       return(nome_tribo)
#     }
#   }
#   
#   # Aplicar a função a cada tribo para criar o vetor de rótulos
#   labels_tribos <- sapply(ordem_tribos, adicionar_asterisco)
#   
#   # Criar um data frame com o número único de 'uc_ea' por ano
#   numero_ea_por_ano <- dados_regiao %>%
#     distinct(ano, uc_ea) %>%
#     group_by(ano) %>%
#     summarize(num_ea = n_distinct(uc_ea))
#   
#   # Construir o gráfico
#   gg <- ggplot() +
#     geom_bar(data = dados_agregados, aes(x = ano, y = proporcao, fill = tribo), stat = "identity", position = position_stack(reverse = FALSE)) +
#     geom_text(data = total_individuos_por_ano, aes(x = ano, y = 100, label = total), vjust = -0.5, size = 3, hjust = 0.5)+
#     geom_text(data = numero_ea_por_ano, aes(x = ano, y = 0, label = paste0("(", num_ea, ")")), vjust = 1.5, size = 3, hjust = 0.5, color = "gray40") +
#     scale_y_continuous(labels = scales::number_format(scale = 1, accuracy = 1), limits = c(0, 100))+
#     scale_x_discrete(expand = c(0, 0)) +
#     scale_fill_manual(values = cores_tribos, 
#                       labels = labels_tribos,
#                       breaks = ordem_tribos) +
#     labs(title = titulo,
#          x = "",
#          y = "Frequência relativa de ocorrência (%)",
#          fill = "Tribo") +
#     theme_minimal() +
#     theme(legend.position = "right", 
#           legend.title = element_text(size = 12), 
#           legend.text = element_text(size = 10), 
#           plot.title = element_text(hjust = 0.5, size = 16), 
#           plot.subtitle = element_text(hjust = 0.5, size = 14),
#           axis.ticks.y = element_line(color = "black"),
#           axis.text = element_text(size = 10), 
#           axis.title = element_text(size = 10),
#           axis.line = element_line(colour = "gray40"),
#           axis.line.x = element_blank()) +
#     guides(fill = guide_legend(title = "Tribos", reverse = FALSE))
#   
#   # Exibir o gráfico
#   print(gg)
# }
# 
# # Carregar e preparar os dados
# resultado_final <- read.csv("dados/borboletas/resultado_final.csv", header = TRUE)
# resultado_final$ano <- factor(resultado_final$ano)
# resultado_final$tribo <- gsub("\\*", "", resultado_final$tribo)



```




### Amazônia 


</br>


Na região climática Sudoeste amazônica foram amostradas 36.918 borboletas frugívoras, sendo 354 delas não identificadas e desconsideradas nas análises. Assim, 36.564 indivíduos foram identificados em nível de tribo, sendo as mais abundantes: Satyrini (48%), Brassolini (11%), Epicaliini (9%) e Ageroniiini (9%). A região Sudoeste apresentou a maior proporção de tribos indicadoras de florestas abertas/perturbadas dentre as regiões da Amazônia. No caso, a tribo Ageroniini a foi responsável por esse padrão, especialmente em 2019. É importante salientar que, apesar da tribo Ageroniini ser classificada como uma tribo indicadora de florestas abertas/perturbadas, algumas espécies do gênero *Hamadryas* (e.g., *Hamadryas alicia*, *H. belladonna*, *H. velutina*) e do gênero Batesia estão geralmente presentes em florestas maduras e bem conservadas, como ocorre na RESEX Arapixi e UCs da região. Dessa forma, torna-se ainda mais necessária a aplicação do protocolo avançado nas UCs para que, com as fotografias dos indivíduos, seja possível separar espécies nas tribos que utilizam regularmente florestas abertas/perturbadas, como por exemplo *Hamadryas februa*, *H. feronia*, *H. amphinome*, *H. arinome* e *Ectima iona*, das espécies anteriormente citadas, habitantes de florestas fechadas/preservadas (@Jenkins_1983). 

Seguindo os padrões de diversidade da fauna e flora amazônicas (@Ribas_2019; @Luize_2024), a região Sudoeste apresentou os maiores valores de números de indivíduos por esforço amostral. Apesar de tratar-se de contagem de indivíduos, é de se esperar que a riqueza e diversidade de espécies acompanhem este padrão (@DeVries_2016). O esforço realizado entre 2014 e 2016 nesta região foi inferior ao considerado adequado para caracterizar a abundância relativa de tribos, tendo este atingido a suficiência amostral somente a partir de 2017 (@fig-regiao-climatica-sudoeste-amazonica). 

</br>

```{r grafico regiao-climatica-sudoeste-amazonica}
#| label: fig-regiao-climatica-sudoeste-amazonica
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Abundância relativa de tribos de borboletas frugívoras de 2014 a 2022 na região climática Sudoeste. Os números sobre as barras indicam indivíduos registrados e os números entre parênteses sob as barras se referem ao número de campanhas realizadas naquele ano."

# # Definir a região de interesse - colocar as regiões 'norte', 'sudoeste', 'sudeste', 'leste', 'central'
# regiao_interesse <- "sudoeste"
# 
# # Gerar o gráfico para a região de interesse
# gerar_grafico_por_regiao(resultado_final, regiao_interesse)
# 
# # Salvar a imagem usando ggsave()
# ggsave(filename = "bo_regional_sudoeste.jpg",  # Escolha um nome adequado para o arquivo
#        #plot = gg,  # O objeto ggplot
#        device = "png",  # Pode ser "jpeg", "tiff", etc.
#        path = "imagens/cap04/",  # Especifique o diretório onde você deseja salvar o gráfico
#        dpi = 300,  # Define a resolução (DPI)
#        width = 10, height =8, units = "in")  # Define o tamanho da imagem


knitr::include_graphics("imagens/cap04/bo_regional_sudoeste.png")

```



</br>

Na região climática central amazônica 23.088 borboletas frugívoras foram amostradas de 2014 a 2022. Visto que 174 não foram identificadas em nível de tribo, 22.914 indivíduos foram considerados nas análises. Desses, 41% pertencem à tribo Satyrini, a mais abundante da região, seguidos por 16% de Brassolini e 10% de Coeini. Os anos 2014 e 2020 tiveram um esforço amostral inferior àquele definido como mínimo aceitável para a região (i.e., menor que 18 campanhas = 1.728 armadilhas-dia). Assim, a interpretação dos resultados nesses anos deve ser feita com cautela.  

As tribos Satyrini e Brassolini foram predominantes em praticamente todos os anos amostrados na região climática central amazônica. No entanto, em 2017 houve um aumento no número de Coeini, que foi a segunda tribo mais abundante (@fig-regiao-climatica-central-amazonica). As tribos indicadoras de áreas abertas/perturbadas tiveram baixíssima representação (@fig-regiao-climatica-central-amazonica). 



</br>


```{r grafico regiao-climatica-central-amazonica}
#| label: fig-regiao-climatica-central-amazonica
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Abundância relativa de tribos de borboletas frugívoras de 2014 a 2022 na região climática Central. Os números sobre as barras indicam indivíduos registrados e os números entre parênteses sob as barras se referem ao número de campanhas realizadas naquele ano."

# # Definir a região de interesse - colocar as regiões 'norte', 'sudoeste', 'sudeste', 'leste', 'central'
# regiao_interesse <- "central"
# 
# # Gerar o gráfico para a região de interesse
# gerar_grafico_por_regiao(resultado_final, regiao_interesse)
# 
# 
# #Salvar a imagem usando ggsave()
# ggsave(filename = "bo_regional_central.jpg",  # Escolha um nome adequado para o arquivo
#        #plot = gg,  # O objeto ggplot
#        device = "png",  # Pode ser "jpeg", "tiff", etc.
#        path = "/imagens/cap04/",  # Especifique o diretório onde você deseja salvar o gráfico
#        dpi = 300,  # Define a resolução (DPI)
#        width = 10, height =8, units = "in")  # Define o tamanho da imagem


knitr::include_graphics("imagens/cap04/bo_regional_central.png")

```

</br>



Na região climática leste amazônica foram amostradas 7.969 borboletas frugívoras, com 67 indivíduos não identificados em nível de tribo. Assim, dos 7.902 indivíduos de borboletas frugívoras identificados na região leste da Amazônia, 46% corresponderam à tribo Satyrini, a mais representativa, seguida por Brassolini (15%) e Morphini (11%). Os anos 2016, 2017 e 2020 tiveram amostragens abaixo do esforço adequado para representar a região.  Apesar disso, o padrão da proporção da abundância das tribos foi bastante estável, com pouca variação entre anos (@fig-regiao-climatica-leste-amazonica).



```{r grafico regiao-climatica-leste-amazonica}
#| label: fig-regiao-climatica-leste-amazonica
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Abundância relativa de tribos de borboletas frugívoras de 2014 a 2022 na região climática Leste. Os números sobre as barras indicam indivíduos registrados e os números entre parênteses sob as barras se referem ao número de campanhas realizadas naquele ano."

# # Definir a região de interesse - colocar as regiões 'norte', 'sudoeste', 'sudeste', 'leste', 'central'
# regiao_interesse <- "leste"
# 
# # Gerar o gráfico para a região de interesse
# gerar_grafico_por_regiao(resultado_final, regiao_interesse)
# 
# # Salvar a imagem usando ggsave()
# ggsave(filename = "bo_regional_leste.png",  # Escolha um nome adequado para o arquivo
#        #plot = gg,  # O objeto ggplot
#        device = "png",  # Pode ser "jpeg", "tiff", etc.
#        path = "imagens/cap04/",  # Especifique o diretório onde você deseja salvar o gráfico
#        dpi = 300,  # Define a resolução (DPI)
#        width = 10, height =8, units = "in")  # Define o tamanho da imagem


knitr::include_graphics("imagens/cap04/bo_regional_leste.png")

```

</br>



Na região climática sudeste amazônica a amostragem não atingiu o valor mínimo do esforço amostral estabelecido para as análises. Esta é uma região com somente duas UCs, PARNA do Juruena e REBIO do Tapirapé, aplicando o protocolo de borboletas frugívoras e se faz necessário o aumento no número de UCs participantes.  


Ao todo, foram amostrados 5.042 indivíduos de borboletas frugívoras na região sudeste amazônica. Desses, 48 indivíduos foram descartados na análise por não terem sido identificados. Assim, 4.994 borboletas frugívoras foram identificadas em nível de tribo. Dentre as mais abundantes destacaram-se Satyrini (58%), Epicaliini (11%) e Morphini (11%). O padrão da proporção das tribos ao longo dos anos variou pouco de 2017 a 2022 (@fig-regiao-climatica-sudeste-amazonica), provavelmente pelo baixo número de UCs, visto que amostragens em diferentes UCs tendem a capturar diferentes padrões, mesmo numa mesma região (e.g., região sudoeste).  


</br>

```{r grafico regiao-climatica-sudeste-amazonica}
#| label: fig-regiao-climatica-sudeste-amazonica
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Abundância relativa de tribos de borboletas frugívoras de 2014 a 2022 na região climática Sudeste. Os números sobre as barras indicam indivíduos registrados e os números entre parênteses sob as barras se referem ao número de campanhas realizadas naquele ano."

# # Definir a região de interesse - colocar as regiões 'norte', 'sudoeste', 'sudeste', 'leste', 'central'
# regiao_interesse <- "sudeste"
# 
# # Gerar o gráfico para a região de interesse
# gerar_grafico_por_regiao(resultado_final, regiao_interesse)
# 
# # Salvar a imagem usando ggsave()
# ggsave(filename = "regional_sudeste.png",  # Escolha um nome adequado para o arquivo
#        #plot = gg,  # O objeto ggplot
#        device = "png",  # Pode ser "jpeg", "tiff", etc.
#        path = "imagens/cap04/",  # Especifique o diretório onde você deseja salvar o gráfico
#        dpi = 300,  # Define a resolução (DPI)
#        width = 10, height =8, units = "in")  # Define o tamanho da imagem


knitr::include_graphics("imagens/cap04/bo_regional_sudeste.png")

```

</br>


Na região climática norte amazônica o esforço mínimo para a representação da comunidade de borboletas frugívoras não foi atingido em nenhum ano. Uma das razões é a complexidade logística para a amostragem em algumas UCs do norte da Amazônia. Por exemplo, as amostragens no PARNA do Monte Roraima precisam ser feitas na forma de expedições, devido às dificuldades de acesso através da Terra indígena Raposa Serra do Sol, levando dias por terra ou com um alto custo utilizando aviões monomotores. Outro fator que influenciou a diminuição do número de EAs amostradas foi a invasão da ESEC Maracá por garimpeiros em 2019, com ameaças e roubo de equipamentos da UC. A ESEC Maracá era a única UC consolidada nao região Norte. Assim, é necessário se reestabelecer a amostragem na ESEC Maracá e aumentar o número de EAs implementadas no PARNA da Serra da Mocidade, na ESEC de Niquiá e no PARNA do Viruá. 

Ao todo, foram amostradas 3.303 borboletas frugívoras nessa região. Dessas, 190 não foram identificadas em nível de tribo, tendo sido descartadas, de forma que 3.113 indivíduos identificados foram considerados na análise. Dentre as tribos mais abundantes destacam-se Satyrini, Brassolini e Preponini, com 55%, 15% e 6%, respectivamente. 

O padrão da assinatura das tribos variou de 2017 a 2019, tendo se estabilizado de 2020 a 2022. Porém, a abundância de borboletas foi bastante influenciada pelo número insuficiente de estações amostrais, o que limita potenciais conclusões  (@fig-regiao-climatica-norte-amazonica). 

</br>

```{r grafico regiao-climatica-norte-amazonica}
#| label: fig-regiao-climatica-norte-amazonica
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Abundância relativa de tribos de borboletas frugívoras de 2014 a 2022 na região climática Norte. Os números sobre as barras indicam indivíduos registrados e os números entre parênteses sob as barras se referem ao número de campanhas realizadas naquele ano."

# # Definir a região de interesse - colocar as regiões 'norte', 'sudoeste', 'sudeste', 'leste', 'central'
# regiao_interesse <- "norte"
# 
# # Gerar o gráfico para a região de interesse
# gerar_grafico_por_regiao(resultado_final, regiao_interesse)
# 
# # Salvar a imagem usando ggsave()
# ggsave(filename = "regional_norte.png",  # Escolha um nome adequado para o arquivo
#        #plot = gg,  # O objeto ggplot
#        device = "png",  # Pode ser "jpeg", "tiff", etc.
#        path = "imagens/cap04/",  # Especifique o diretório onde você deseja salvar o gráfico
#        dpi = 300,  # Define a resolução (DPI)
#        width = 10, height =8, units = "in")  # Define o tamanho da imagem


knitr::include_graphics("imagens/cap04/bo_regional_norte.png")

```

</br>


### Cerrado e Mata Atlântica  

</br>

Até o momento, poucas UCs dos biomas Cerrado e Mata Atlântica aplicaram o protocolo de amostragem de borboletas frugívoras. Dessa forma, os resultados apresentados aqui requerem cautela na interpretação. 

No Cerrado foram amostrados 6.378 indivíduos (67 deles não identificados em nível de tribo), sendo 6.311 considerados nas análises. As tribos mais representativas no Cerrado foram Satyrini, Ageroniini e Biblidini com 40%, 14% e 8%, respectivamente. É importante ressaltar que as amostragens no Cerrado foram feitas em ambientes mésicos, ou seja, em ambientes florestais úmidos imersos no ambiente savânico. Estes ambientes podem ser capões de mata ou matas ripárias. Dessa forma, é de se esperar que tribos indicadoras tanto de florestas fechadas quanto de florestas abertas sejam representadas.

Os padrões anuais apresentaram grandes variações na proporção das tribos indicadoras, especialmente de Brassolini, Morphini, Biblidini e Ageroniini (@fig-regiao-cerrado). 

 

</br>

```{r assinatura cerrado}
#| label: fig-regiao-cerrado
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Abundância relativa de tribos de borboletas frugívoras de 2014 a 2022 no Cerrado. Não houve amostragem em 2020. Os números sobre as barras indicam indivíduos registrados e os números entre parênteses sob as barras se referem ao número de estações amostrais inspecionadas naquele ano. O asterisco indica tribo ausente na amostragem."

# Gráficos de dados Borboletas - Protocolo básico - Cerrado -
### Tribos com asterisco estão ausentes nos dados
## Script: Isabela Freitas Oliveira

# library(ggplot2)
# library(dplyr)
# library(scales)
# library(tools)
# 
# 
# # Função auxiliar para ajustar o título
# ajustar_titulo <- function(titulo) {
#   palavras <- strsplit(titulo, " ")[[1]]
#   
#   # Palavras que necessitam de correção de acentuação
#   #correcoes <- list(
#    # "Cerrado" = "Cerrado")
#   
# }
# 
# # Função para gerar o gráfico para cada unidade de conservação
# gerar_grafico_por_bioma <- function(dados, nome_bioma) {
#   # Preparar o título com as novas regras
#   titulo <- gsub("_", " ", nome_bioma)
#   titulo <- ajustar_titulo(titulo)  # Utilizando a função de ajuste de título aqui
#   
#   # Filtrar os dados para a unidade de conservação atual
#   dados_bioma <- subset(dados, bioma == nome_bioma & bioma == "Cerrado")
#   dados_bioma <- dados_bioma[!is.na(dados_bioma$tribo), ] #tirar os dados 'NA' que estão na tribo
#   
#   # Calcular o total de indivíduos por ano para a região atual
#   total_individuos_por_ano <- dados_bioma %>%
#     group_by(ano) %>%
#     summarise(total = sum(soma_individuos), .groups = 'drop')
#   
#   # Agregar dados por ano e tribo
#   dados_agregados <- dados_bioma %>%
#     group_by(ano, tribo) %>%
#     summarize(frequencia = sum(soma_individuos), .groups = 'drop')
#   
#   # Calcular totais e proporções
#   total_por_ano <- dados_agregados %>%
#     group_by(ano) %>%
#     summarize(total = sum(frequencia), .groups = 'drop')
#   
#   dados_agregados <- left_join(dados_agregados, total_por_ano, by = "ano") %>%
#     mutate(proporcao = frequencia / total * 100)
#   
#   # Ajustar proporções
#   dados_agregados <- dados_agregados %>%
#     group_by(ano) %>%
#     mutate(diferenca = 100 - sum(proporcao),
#            proporcao_ajustada = ifelse(proporcao == max(proporcao), proporcao + diferenca, proporcao)) %>%
#     ungroup() %>%
#     dplyr::select(-diferenca, -proporcao) %>%
#     rename(proporcao = proporcao_ajustada)
#   
#   # Ordem específica das tribos
#   ordem_tribos <- c(
#     "Brassolini", "Morphini", "Haeterini", 
#     "Preponini", "Melanitini", "Anaeini", 
#     "Epicaliini","Epiphilini", "Coeini",
#     "Satyrini",
#     "Callicorini", "Biblidini","Ageroniini"
#   )
#   
#   # Cores correspondentes às tribos - BLINDSAFE colors (3 categorias de verde, 7 categorias de cinza e 3 categorias de marrom)
#   cores_tribos <- c(
#     "Brassolini" = "#35978f", "Morphini" = "#80cdc1", "Haeterini" = "#c7eae5", 
#     "Preponini" = "gray65", "Melanitini" = "gray70", "Anaeini" = "gray75", 
#     "Epicaliini" = "gray80", "Epiphilini" = "gray85", "Coeini" = "gray90",
#     "Satyrini" = "gray95",
#     "Callicorini" = "#f6e8c3", "Biblidini" = "#dfc27d","Ageroniini" = "#bf812d"
#   )
#   
#   # Ajustar a ordem e as cores das tribos com base nas tribos presentes
#   cores_tribos <- cores_tribos[ordem_tribos]
#   
#   # Assegurar que a coluna 'tribo_clean' respeite a ordem definida
#   dados_agregados$tribo <- factor(dados_agregados$tribo, levels = ordem_tribos)
#   
#   # Criar um data frame com a frequência agregada por tribo
#   frequencias_por_tribo_ano <- aggregate(frequencia ~ tribo, dados_agregados, sum)
#   
#   # Criar uma função para determinar se um asterisco deve ser adicionado ao nome da tribo
#   adicionar_asterisco <- function(nome_tribo) {
#     # Verificar se existe alguma frequência igual a zero para essa tribo em qualquer ano
#     if (any(frequencias_por_tribo_ano$tribo == nome_tribo & frequencias_por_tribo_ano$frequencia == 0)) {
#       return(paste0(nome_tribo, "*"))
#     } else {
#       return(nome_tribo)
#     }
#   }
#   
#   # Aplicar a função a cada tribo para criar o vetor de rótulos
#   labels_tribos <- sapply(ordem_tribos, adicionar_asterisco)
#   
#   # Criar um data frame com o número único de 'uc_ea' por ano
#   numero_ea_por_ano <- dados_bioma %>%
#     distinct(ano, uc_ea) %>%
#     group_by(ano) %>%
#     summarize(num_ea = n_distinct(uc_ea))
#   
#   # Construir o gráfico
#   gg <- ggplot() +
#     geom_bar(data = dados_agregados, aes(x = ano, y = proporcao, fill = tribo), stat = "identity", position = position_stack(reverse = FALSE)) +
#     geom_text(data = total_individuos_por_ano, aes(x = ano, y = 100, label = total), vjust = -0.5, size = 3, hjust = 0.5)+
#     geom_text(data = numero_ea_por_ano, aes(x = ano, y = 0, label = paste0("(", num_ea, ")")), vjust = 1.5, size = 3, hjust = 0.5, color = "gray40") +
#     scale_y_continuous(labels = scales::number_format(scale = 1, accuracy = 1), limits = c(0, 100))+
#     scale_x_discrete(expand = c(0, 0)) +
#     scale_fill_manual(values = cores_tribos, 
#                       labels = labels_tribos,
#                       breaks = ordem_tribos) +
#     labs(title = titulo,
#          x = " ",
#          y = "Frequência relativa de ocorrência (%)",
#          fill = "Tribo") +
#     theme_minimal() +
#     theme(legend.position = "right", 
#           legend.title = element_text(size = 12), 
#           legend.text = element_text(size = 10), 
#           plot.title = element_text(hjust = 0.5, size = 16), 
#           plot.subtitle = element_text(hjust = 0.5, size = 14),
#           axis.ticks.y = element_line(color = "black"),
#           axis.text = element_text(size = 10), 
#           axis.title = element_text(size = 10),
#           axis.line = element_line(colour = "gray40"),
#           axis.line.x = element_blank()) +
#     guides(fill = guide_legend(title = "Tribos", reverse = FALSE))
#   
#   
#   # Exibir o gráfico
#   print(gg)
#   
#   # Retorna o gráfico para que possa ser salvo externamente
#   return(gg)
#   
# }
# 
# # Carregar e preparar os dados
# resultado_final <- read.csv("dados/borboletas/resultado_final.csv", header = TRUE)
# resultado_final$ano <- factor(resultado_final$ano)
# resultado_final$tribo <- gsub("\\*", "", resultado_final$tribo)
# 
# # Obter todas as UC's do bioma Cerrado
# biomas <- unique(resultado_final$bioma[resultado_final$bioma == "Cerrado"])
# 
# # Aplicar a função
# graficos <- lapply(biomas, function(bioma) gerar_grafico_por_bioma(resultado_final, bioma))

# Salvar a imagem usando ggsave()
# ggsave(filename = "bo_cerrado.png",  # Escolha um nome adequado para o arquivo
#        plot = graficos[[1]],  # Especifique qual gráfico da lista deseja salvar
#        device = "png",  # Pode ser "jpeg", "tiff", etc.
#        path = "/imagens/cap04",  # Especifique o diretório onde você deseja salvar o gráfico
#        dpi = 300,  # Define a resolução (DPI)
#        width = 10, height = 8, units = "in")  # Define o tamanho da imagem


knitr::include_graphics("imagens/cap04/bo_cerrado.png")


```

</br>

Na Mata Atlântica 2.700 borboletas frugívoras foram amostradas. Dessas, 16 não foram identificadaos no nível de tribo, de modo que 2.684 indivíduos amostrados foram considerados na análise. A tribo Satyrini foi a mais representativa, com 27% dos indivíduos, seguida por Anaeini, com 24% e Epicaliini, com 14%. 

Houve uma grande variação das tribos entre anos, especialmente de Brassolini, Anaeini, Coeini e Satyrini (@fig-regiao-mata-atlantica). Verificou-se também grande variação no número de indivíduos, mesmo quando com um mesmo esforço amostral, indicando haver de fato diferenças na abundância entre regiões no bioma. O padrão das tribos do bioma reflete, principalmente, o padrão registrado no Parque Nacional do Iguaçu. Assim, é de extrema importância que as amostragens sejam feitas continuamente nas mesmas UCs e que, com a adesão de novas unidades de conservação da região ao programa de monitoramento, as amostragens nas UCs com protocolo de borboletas frugívoras já implementado sejam mantidas. 



</br>


```{r assinatura mata atlântica}
#| label: fig-regiao-mata-atlantica
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Abundância relativa de tribos de borboletas frugívoras de 2015 a 2022 na Mata Atlântica. Não houve amostragem em 2020. Os números sobre as barras indicam indivíduos registrados e os números entre parênteses sob as barras se referem ao número de estações amostrais inspecionadas naquele ano. O asterisco indica tribo ausente na amostragem."


##### Gráficos de dados Borboletas - Protocolo básico - Mata Atlantica
### Tribos com asterisco estão ausentes no gráfico
## Script: Isabela Freitas Oliveira

# # Carregar bibliotecas
# library(ggplot2)
# library(dplyr)
# library(scales)
# library(tools)
# 
# 
# 
# # Função auxiliar para ajustar o título
# ajustar_titulo <- function(titulo) {
#   palavras <- strsplit(titulo, " ")[[1]]
#   
#   # Palavras que necessitam de correção de acentuação
#   correcoes <- list(
#     "Mata_Atlantica" = "Mata Atlântica")
#   
# }
# 
# # Função para gerar o gráfico para cada unidade de conservação
# gerar_grafico_por_bioma <- function(dados, nome_bioma) {
#   # Preparar o título com as novas regras
#   titulo <- gsub("_", " ", nome_bioma)
#   titulo <- ajustar_titulo(titulo)  # Utilizando a função de ajuste de título aqui
#   
#   # Filtrar os dados para a unidade de conservação atual
#   dados_bioma <- subset(dados, bioma == nome_bioma & bioma == "Mata_Atlantica")
#   dados_bioma <- dados_bioma[!is.na(dados_bioma$tribo), ] #tirar os dados 'NA' que estão na tribo
#   
#   # Calcular o total de indivíduos por ano para a região atual
#   total_individuos_por_ano <- dados_bioma %>%
#     group_by(ano) %>%
#     summarise(total = sum(soma_individuos), .groups = 'drop')
#   
#   # Agregar dados por ano e tribo
#   dados_agregados <- dados_bioma %>%
#     group_by(ano, tribo) %>%
#     summarize(frequencia = sum(soma_individuos), .groups = 'drop')
#   
#   # Calcular totais e proporções
#   total_por_ano <- dados_agregados %>%
#     group_by(ano) %>%
#     summarize(total = sum(frequencia), .groups = 'drop')
#   
#   dados_agregados <- left_join(dados_agregados, total_por_ano, by = "ano") %>%
#     mutate(proporcao = frequencia / total * 100)
#   
#   # Ajustar proporções
#   dados_agregados <- dados_agregados %>%
#     group_by(ano) %>%
#     mutate(diferenca = 100 - sum(proporcao),
#            proporcao_ajustada = ifelse(proporcao == max(proporcao), proporcao + diferenca, proporcao)) %>%
#     ungroup() %>%
#     dplyr::select(-diferenca, -proporcao) %>%
#     rename(proporcao = proporcao_ajustada)
#   
#   # Ordem específica das tribos
#   ordem_tribos <- c(
#     "Brassolini", "Morphini", "Haeterini", 
#     "Preponini", "Melanitini", "Anaeini", 
#     "Epicaliini","Epiphilini", "Coeini",
#     "Satyrini",
#     "Callicorini", "Biblidini","Ageroniini"
#   )
#   
#   # Cores correspondentes às tribos - BLINDSAFE colors (3 categorias de verde, 7 categorias de cinza e 3 categorias de marrom)
#   cores_tribos <- c(
#     "Brassolini" = "#35978f", "Morphini" = "#80cdc1", "Haeterini" = "#c7eae5", 
#     "Preponini" = "gray65", "Melanitini" = "gray70", "Anaeini" = "gray75", 
#     "Epicaliini" = "gray80", "Epiphilini" = "gray85", "Coeini" = "gray90",
#     "Satyrini" = "gray95",
#     "Callicorini" = "#f6e8c3", "Biblidini" = "#dfc27d","Ageroniini" = "#bf812d"
#   )
#   
#   # Ajustar a ordem e as cores das tribos com base nas tribos presentes
#   cores_tribos <- cores_tribos[ordem_tribos]
#   
#   # Assegurar que a coluna 'tribo_clean' respeite a ordem definida
#   dados_agregados$tribo <- factor(dados_agregados$tribo, levels = ordem_tribos)
#   
#   # Criar um data frame com a frequência agregada por tribo
#   frequencias_por_tribo_ano <- aggregate(frequencia ~ tribo, dados_agregados, sum)
#   
#   # Criar uma função para determinar se um asterisco deve ser adicionado ao nome da tribo
#   adicionar_asterisco <- function(nome_tribo) {
#     # Verificar se existe alguma frequência igual a zero para essa tribo em qualquer ano
#     if (any(frequencias_por_tribo_ano$tribo == nome_tribo & frequencias_por_tribo_ano$frequencia == 0)) {
#       return(paste0(nome_tribo, "*"))
#     } else {
#       return(nome_tribo)
#     }
#   }
#   
#   # Aplicar a função a cada tribo para criar o vetor de rótulos
#   labels_tribos <- sapply(ordem_tribos, adicionar_asterisco)
#   
#   # Criar um data frame com o número único de 'uc_ea' por ano
#   numero_ea_por_ano <- dados_bioma %>%
#     distinct(ano, uc_ea) %>%
#     group_by(ano) %>%
#     summarize(num_ea = n_distinct(uc_ea))
#   
#   # Construir o gráfico
#   gg <- ggplot() +
#     geom_bar(data = dados_agregados, aes(x = ano, y = proporcao, fill = tribo), stat = "identity", position = position_stack(reverse = FALSE)) +
#     geom_text(data = total_individuos_por_ano, aes(x = ano, y = 100, label = total), vjust = -0.5, size = 3, hjust = 0.5)+
#     geom_text(data = numero_ea_por_ano, aes(x = ano, y = 0, label = paste0("(", num_ea, ")")), vjust = 1.5, size = 3, hjust = 0.5, color = "gray40") +
#     scale_y_continuous(labels = scales::number_format(scale = 1, accuracy = 1), limits = c(0, 100))+
#     scale_x_discrete(expand = c(0, 0)) +
#     scale_fill_manual(values = cores_tribos, 
#                       labels = labels_tribos,
#                       breaks = ordem_tribos) +
#     labs(title = titulo,
#          x = " ",
#          y = "Frequência relativa de ocorrência (%)",
#          fill = "Tribo") +
#     theme_minimal() +
#     theme(legend.position = "right", 
#           legend.title = element_text(size = 12), 
#           legend.text = element_text(size = 10), 
#           plot.title = element_text(hjust = 0.5, size = 16), 
#           plot.subtitle = element_text(hjust = 0.5, size = 14),
#           axis.ticks.y = element_line(color = "black"),
#           axis.text = element_text(size = 10), 
#           axis.title = element_text(size = 10),
#           axis.line = element_line(colour = "gray40"),
#           axis.line.x = element_blank()) +
#     guides(fill = guide_legend(title = "Tribos", reverse = FALSE))
#   
#   # Exibir o gráfico
#   print(gg)
# }
# 
# # Carregar e preparar os dados
# resultado_final <- read.csv("dados/borboletas/resultado_final.csv", header = TRUE)
# resultado_final$ano <- factor(resultado_final$ano)
# resultado_final$tribo <- gsub("\\*", "", resultado_final$tribo)
# 
# # Obter todas as UC's do bioma Mata Atlântica
# biomas <- unique(resultado_final$bioma[resultado_final$bioma == "Mata_Atlantica"])
# 
# # Aplicar a função
# graficos <- lapply(biomas, function(bioma) gerar_grafico_por_bioma(resultado_final, bioma))

# Salvar a imagem usando ggsave()
# ggsave(filename = "mata_atlantica.png",  # Escolha um nome adequado para o arquivo
#        plot = graficos[[1]],  # Especifique qual gráfico da lista deseja salvar
#        device = "png",  # Pode ser "jpeg", "tiff", etc.
#        path = "/imagens/cap04",  # Especifique o diretório onde você deseja salvar o gráfico
#        dpi = 300,  # Define a resolução (DPI)
#        width = 10, height = 8, units = "in")  # Define o tamanho da imagem



knitr::include_graphics("imagens/cap04/bo_mata_atlantica.png")


```

</br>


#### Abundância relativa por região  


Cada região amostrada apresentou um padrão de assinatura de tribos de borboletas. De maneira geral, dentre as tribos indicadoras, o Cerrado apresentou uma proporção maior de borboletas indicadoras de florestas abertas/perturbadas, seguido por Mata Atlântica, sudoeste e norte da Amazônia (Figura 4.12). Como esperado, todas as regiões climáticas da Amazônia, tiveram uma proporção maior de borboletas indicadoras de florestas fechadas/preservadas (Figura 4.12).  

</br>


```{r grafico da abundância relativa por região - total}
#| label: fig-abundancia-regiao-total
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '75%'
#| fig-cap: "Abundância relativa das tribos de borboletas frugívoras. Os números sobre as barras indicam a total de indivíduos amostrados em cada região de 2014 a 2022."

knitr::include_graphics("imagens/cap04/bo_regioes_totais.png")

```



</br>



### Índices de abundância de tribos  

</br>

O uso de índices de abundância em ecologia e conservação visa gerar medidas que possam ser utilizadas na ausência de estimativas populacionais mais precisas.  Geralmente, usam informações quantitativas derivadas de amostragens por área, transecções lineares ou por um certo esforço de captura, sendo uma poderosa ferramenta para se verificar o estado de conservação e acompanhar mudanças populacionais de espécies.  

O programa de inventário e monitoramento de borboletas do Reino Unido, por exemplo, utiliza uma ficha de registros de ocorrências de borboletas focada nas espécies ameaçadas ou raras em sua área de ocorrência. Um objetivo chave deste programa é servir como sistema de alerta prévio, ao nível local, sobre as ameaças aos sítios importantes de ocorrência de populações de borboletas (@Harding_1995). A proposta original, iniciada em 1976, deveria durar cinco anos, porém, permanece ativa ainda hoje (@Middlebrook_2023).  

O tradicional método conhecido como “Caminhada de Pollard” faz uso de transectos lineares para amostrar borboletas. O protocolo original consiste na caminhada ao longo de trilhas para a contagem padronizada de borboletas e cálculo de um índice simples, equivalente à soma da média das contagens semanais das espécies ao longo da estação de voo (@Pollard_1975; @Pollard_1977). Esse método é adotado em monitoramentos de borboletas em vários países europeus (Van_Swaay_2022) e em projetos específicos nos EUA (@Mattoni_2001).  

No Programa Monitora, para avaliar flutuações na abundância das tribos de borboletas ao longo dos anos, foi usado um índice considerando somente as tribos indicadoras de florestas fechadas/preservadas e abertas/perturbadas. Para isso, os indivíduos das tribos Brassolini, Morphini e Haeterini registrados em cada ano foram somados, com os totais resultantes representando conjuntamente as borboletas de florestas fechadas/preservadas. O mesmo procedimento foi feito para as borboletas de florestas abertas/perturbadas: Callicorini, Biblidini e Ageroniini.   


</br>

#### Cálculo dos índices 

</br>

Neste relatório, foram adotadas duas abordagens no cálculo dos índices de abundância. Na primeira, o índice de tendência populacional segue o princípio do Living Planet Index (LPI), no qual oscilações “populacionais” podem ser detectadas comparando-se o valor do índice de um dado ano ao valor do primeiro ano de ocorrência da “população” sob análise. Na segunda, o índice de variação populacional instantânea possibilita a detecção de flutuações de abundância de um ano em relação ao ano anterior.  


O índice de abundância *(i)* tem como base o número acumulado de indivíduos (*n*) de cada tribo em cada ano *(t)* numa dada área. A partir do número de indivíduos registrados por ano *(n~t~)* para cada grupo de borboletas indicadoras, é feita uma correção, somando-se um valor muito pequeno para evitar a presença de zeros na matriz. Desta forma, é obtida a frequência absoluta corrigida *(f~t~)* = *n~t~* + 0,00001. Em seguida, para obtenção de um valor padronizado *(fe)*, a frequência absoluta corrigida é dividida pelo esforço amostral (número de armadilhas * número de dias de amostragem). O índice de abundância *(i~t~)* é calculado por meio da divisão da fe do ano específico *(fe~t~)* pelo valor da *fe* do primeiro ano em que a "população" sob análise foi registrada ou primeira ocorrência *(fe~0~)*. Considerando que a frequência corrigida apresenta grandes variações de abundância e esforço amostral entre anos, aplicou-se uma transformação logarítmica (log~10~ + 1).  


**Índice de tendência populacional** - Considerou-se primeira ocorrência quando a abundância da “população” no ano foi ≥ 20 indivíduos. O índice de abundância da primeira ocorrência *(i~0~)* é padronizado como 1,0. Dessa forma, valores acima de 1,0 indicam um aumento e abaixo de 1,0 uma redução "populacional” em relação ao primeiro ano de ocorrência.  

A seguir, um exemplo do cálculo desse índice de abundância para o terceiro ano de amostragem: 


$$f_{3} = n_{3} + 0,00001$$ 


$$fe_{3} = f_{3} / \text{esforço} \, \text{anual}$$ 

$$i_{3} = log_{10} (fe_{3} / fe_{0}) + 1$$  


Flutuações "populacionais" detectadas por meio dessa abordagem são apresentadas na @fig-ind-abund-regioes-climaticas-combinado a @fig-ind-abund-cerrado. 



**Índice de variação populacional instantânea** - Na segunda abordagem, o índice de abundância de um dado ano *(i~t~)* é calculado por meio da divisão da *fe* do ano específico *(fe~t~)* pelo valor da *fe* do ano anterior *(fe~t-1~)*, seguida também de uma transformação logarítmica (log10 + 1).  

Exemplo da aplicação desse índice de abundância para o terceiro ano de amostragem: 


$$f_{3} = n_{3} + 0,00001$$ 
$$fe_{3} = f_{3} / \text{esforço} \, \text{anual}$$ 
$$i_{3} = log_{10} (fe_{3} / fe_{2}) + 1$$ 


Esta abordagem pode revelar, por exemplo, o quanto uma "população" está se 'recuperando' de um declínio no ano anterior (@fig-IA2-regioes-amazonia a @fig-IA2-mata-atlantica).  

Portanto, os resultados apresentados a seguir expressam a variação da abundância das borboletas frugívoras considerada de forma combinada, com algumas tribos sendo tratadas em conjunto, como um grupo indicador de cada tipo de ambiente: florestas preservadas e alteradas. Valores dos índices de abundância específicos para cada tribo por ano são apresentados no Apêndice G.  


</br>


#### Região Amazônica 

</br>

Na primeira abordagem utilizada, os resultados obtidos para os grupos de borboletas indicadoras não foram uniformes nas diferentes regiões climáticas da Amazônia ao longo dos anos (@fig-ind-abund-regioes-climaticas-combinado). Os resultados obtidos para os grupos de borboletas indicadoras não foram uniformes nas diferentes regiões climáticas da Amazônia ao longo dos anos. Enquanto nas regiões central, sudoeste e norte o índice de abundância indicou um aumento ou estabilidade na abundância das borboletas de florestas fechadas/preservadas, uma diminuição "populacional" foi indicada nas regiões leste e sudeste. Este é um resultado interessante, visto que as regiões sudeste e leste da Amazônia fazem parte do chamado "arco do desmatamento" e sofrem com os avanços de intervenções humanas como a pecuária, plantações de soja, construções de barragens, hidrelétricas e estradas (@Fearnside_2022; @Nickerson_2022; @Jakimow_2023; @Levy_2023). Dessa forma, a diminuição de borboletas indicadoras de florestas fechadas/preservadas nessas regiões pode ser um indicativo da diminuição da cobertura florestal em  nível regional, visto que as amostragens são executadas em UCs que não sofrem diretamente com estas ameaças. Porém, para que esta hipótese seja avaliada adequadamente faz-se necessário obter e incluir em futuras análises dados ambientais e climáticos na escala da região.  


As tribos indicadoras de florestas abertas/perturbadas apresentaram, em sua maioria, redução "populacional", especialmente após de 2020. Os únicos picos de aumento "populacional" deste grupo ocorreram em 2019, na região sudoeste da Amazônia, e em 2021, na região central. As regiões norte, leste e sudoeste (a partir de 2020) se destacaram pelas reduções e na região sudeste não foi obtido o número mínimo de 20 indivíduos para o cálculo do índice. Para entender este resultado serão necessárias análises mais refinadas utilizando imagens de satélite, dados climáticos e ambientais. No entanto, a diminuição populacional desse grupo deve, idealmente, ser avaliada num nível taxonômico mais fino, preferencialmente de espécie, para que a interpretação seja mais adequada, especialmente em relação à tribo Ageroniini.  

 

</br>


```{r graficos IA-regiões_climaticas_amazonia_calculos}
#| label: fig-regioes-amazonia
#| echo: false
#| message: false
#| warning: false
#| include: false
#| cache: true


##### Índices de abundância de tribos ao longo dos anos - Cinco regiões Amazônicas 
##Script: Isabela Freitas Oliveira

# library(dplyr)
# library(tidyr)
# library(ggplot2)
# 
# #########################################################
# ######### Região Central Amazônica
# #########################################################
# 
# # # Definir o diretório de trabalho
# #setwd("~/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela")
# df_indice <-read.csv("dados/borboletas/resultado_final_com_esforco.csv", header=T, sep = ';')
# df_indice <- df_indice[!is.na(df_indice$tribo), ]
# 
# dados_regiao_especifica <- df_indice %>%
#   filter(bioma == "Amazonia", regiao == "central")
# 
# # Agregar soma_individuos por tribo e ano
# soma_individuos_por_tribo_ano <- dados_regiao_especifica %>%
#   group_by(tribo, ano) %>%
#   summarize(soma_individuos = sum(soma_individuos, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Verificar o esforço individual por uc_ea e expedicao
# esforco_individual <- dados_regiao_especifica %>%
#   group_by(uc, uc_ea, ano, expedicao) %>%
#   summarize(esforco_individual = unique(esforco_amostral), na.rm = TRUE) %>%
#   ungroup()
# 
# # Somar os esforços por expedicao
# esforco_por_expedicao <- esforco_individual %>%
#   group_by(uc, ano, expedicao) %>%
#   summarize(esforco_total_expedicao = sum(esforco_individual, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Calcular o esforço total anual para cada ano
# esforco_total_anual <- esforco_por_expedicao %>%
#   group_by(ano) %>%
#   summarize(esforco_total_anual = sum(esforco_total_expedicao, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Juntar com soma_individuos_por_tribo_ano
# df_agregado <- soma_individuos_por_tribo_ano %>%
#   left_join(esforco_total_anual, by = "ano") %>%
#   ungroup()
# 
# # Somando os grupos de borboletas_fechadas
# borboletas_fechadas <- df_agregado %>%
#   filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_fechadas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Somando os grupos de borboletas_abertas
# borboletas_abertas <- df_agregado %>%
#   filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_abertas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Adicionando as linhas de Borboletas_fechadas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_fechadas)
# 
# # Adicionando as linhas de Borboletas_abertas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_abertas)
# 
# #################################
# # Calcular o índice de abundância referente ao ano anterior
# df_agregado_1 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          # log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1,
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_,
#                                              log10(frequencia_corrigida /lag(frequencia_corrigida))+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_1, "df_completo_central_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_1 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo
# df_tribo_ano_largo <- df_agregado_1 %>%
#   select(tribo, ano, indice_abundancia) %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Tabela de índices de abundancia para o relatório
# tab_boneco_central <- df_agregado_1 %>%
#   filter(!(row_number() %in% 28:45))
# 
# df_tribo_ano_largo_tab <- tab_boneco_central %>%
#   select(tribo, ano, indice_abundancia) %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# df_tribo_ano_largo_tab <- df_tribo_ano_largo_tab %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Salvar
# #write.table(df_tribo_ano_largo_tab, "indice_abundancia_central_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Filtrar as linhas desejadas - borboletas indicadoras
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo %>%
#   filter(row_number() %in% c(4, 5))
# 
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo_filtrado %>%
#   mutate(tribo = ifelse(row_number() == 1, "Borboletas de florestas abertas/perturbadas",
#                         ifelse(row_number() == 2, "Borboletas de florestas fechadas/preservadas", tribo)))
# 
# ## Tabela para colocar no relatório (índice referente aos valores do ano anterior)
# #write.table(df_tribo_ano_largo_filtrado, "indice_abundancia_central_tab_indicadoras_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# ##################################
# # Calcular o índice de abundância referente ao ano de primeira ocorrencia
# df_agregado_2 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          #log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1,
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_,
#                                              log10(frequencia_corrigida / frequencia_corrigida[primeira_ocorrencia])+1))) %>%
# ungroup() %>%
# select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_2, "df_completo_central_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_2 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo
# df_tribo_ano_largo <- df_agregado_2 %>%
#   select(tribo, ano, indice_abundancia) %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# # Salvar
# #write.table(df_tribo_ano_largo, "indice_abundancia_central_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# ########################
# ####### Gráfico #######
# 
# # Definir as cores e tipos de linha para cada tribo
# cores_linhas <- c("Borboletas_fechadas" = "#23867E", "Borboletas_abertas" = "#CFA154")
# tipos_linhas <- c("Borboletas_fechadas" = "solid","Borboletas_abertas" = "dashed")
# 
# dados_longos <- df_agregado_2 %>%
#   filter(tribo %in% c('Borboletas_fechadas', 'Borboletas_abertas'))
# 
# # Criar uma sequência completa de anos
# anos_completos <- factor(seq(min(dados_longos$ano), max(dados_longos$ano)))
# 
# # Grafico - referente ao primeiro ano de ocorrencia
# gg_grafico_primeira_ocorrencia_central <- ggplot(dados_longos, aes(x = as.factor(ano), y = indice_abundancia, color = tribo, linetype = tribo)) +
#   geom_line(aes(group = tribo), size = 1) +
#   geom_hline(yintercept = 1, linetype = "dashed", color = "black", size = 0.5) +
#   scale_color_manual(values = cores_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                        "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   scale_linetype_manual(values = tipos_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                           "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   theme_minimal() +
#   labs(title = "Região Climática Central Amazônica",
#        x = "",
#        y = expression("Índice de Abundância (" * italic("i") * ")"),
#        color = NULL,
#        linetype = NULL) +
#   theme(plot.title = element_text(hjust = 0.5, size = 20),
#         axis.title = element_text(size = 18),
#         axis.text = element_text(size = 14),
#         legend.title = element_text(size = 16),
#         legend.text = element_text(size = 12),
#         axis.line = element_line(color = "black"),
#         axis.line.x = element_blank(),
#         legend.position = "bottom",
#         axis.text.x = element_text(hjust = 0.5)) +
#   scale_x_discrete(labels = as.character(anos_completos))+
#   coord_cartesian(ylim = c(0, 2))
# 
# # Exibir o gráfico
# print(gg_grafico_primeira_ocorrencia_central)
# 
# # Salvar o gráfico em formato PNG
# #ggsave("indice_abundancia_central.png",
#  #      gg_grafico_primeira_ocorrencia_central,
#   #     width = 12,
#    #    height = 10,
#     #   units = "in")
# 
# 
# #########################################################
# ######### Região Sudoeste Amazônica
# #########################################################
# 
# # Definir o diretório de trabalho
# # setwd("~/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela")
# df_indice<-read.csv("dados/borboletas/resultado_final_com_esforco.csv", header=T, sep = ';')
# df_indice <- df_indice[!is.na(df_indice$tribo), ]
# 
# dados_regiao_especifica <- df_indice %>%
#   filter(bioma == "Amazonia", regiao == "sudoeste")
# 
# # Agregar soma_individuos por tribo e ano
# soma_individuos_por_tribo_ano <- dados_regiao_especifica %>%
#   group_by(tribo, ano) %>%
#   summarize(soma_individuos = sum(soma_individuos, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Verificar o esforço individual por uc_ea e expedicao
# esforco_individual <- dados_regiao_especifica %>%
#   group_by(uc, uc_ea, ano, expedicao) %>%
#   summarize(esforco_individual = unique(esforco_amostral), na.rm = TRUE) %>%
#   ungroup()
# 
# # Somar os esforços por expedicao
# esforco_por_expedicao <- esforco_individual %>%
#   group_by(uc, ano, expedicao) %>%
#   summarize(esforco_total_expedicao = sum(esforco_individual, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Calcular o esforço total anual para cada ano
# esforco_total_anual <- esforco_por_expedicao %>%
#   group_by(ano) %>%
#   summarize(esforco_total_anual = sum(esforco_total_expedicao, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Juntar com soma_individuos_por_tribo_ano
# df_agregado <- soma_individuos_por_tribo_ano %>%
#   left_join(esforco_total_anual, by = "ano") %>%
#   ungroup()
# 
# # Somando os grupos de borboletas_fechadas
# borboletas_fechadas <- df_agregado %>%
#   filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_fechadas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Somando os grupos de borboletas_abertas
# borboletas_abertas <- df_agregado %>%
#   filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_abertas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Adicionando as linhas de Borboletas_fechadas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_fechadas)
# 
# # Adicionando as linhas de Borboletas_abertas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_abertas)
# 
# #################################
# # Calcular o índice de abundância referente ao ano anterior
# df_agregado_3 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          # log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1,
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_,
#                                              log10(frequencia_corrigida /lag(frequencia_corrigida))+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_3, "df_completo_sudoeste_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_3 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo # tabela geral dos índices
# df_tribo_ano_largo <- df_agregado_3 %>%
#   select(tribo, ano, indice_abundancia) %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Tabela de índices de abundancia para o relatório
# tab_boneco_sudoeste <- df_agregado_3 %>%
#   filter(!(row_number() %in% 28:45))
# 
# df_tribo_ano_largo_tab <- tab_boneco_sudoeste %>%
#   select(tribo, ano, indice_abundancia) %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# df_tribo_ano_largo_tab <- df_tribo_ano_largo_tab %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Salvar
# #write.table(df_tribo_ano_largo_tab, "indice_abundancia_sudoeste_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Filtrar as linhas desejadas - borboletas indicadoras
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo %>%
#   filter(row_number() %in% c(4, 5))
# 
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo_filtrado %>%
#   mutate(tribo = ifelse(row_number() == 1, "Borboletas de florestas abertas/perturbadas",
#                         ifelse(row_number() == 2, "Borboletas de florestas fechadas/preservadas", tribo)))
# 
# # Tabela para colocar no relatório (índice referente aos valores do ano anterior)
# #write.table(df_tribo_ano_largo_filtrado, "indice_abundancia_sudoeste_tab_indicadoras_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# #################################
# # Calcular o índice de abundância referente ao ano de primeira ocorrencia
# df_agregado_4 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          #log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1,
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_,
#                                              log10(frequencia_corrigida / frequencia_corrigida[primeira_ocorrencia])+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_4, "df_completo_sudoeste_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_4 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo
# df_tribo_ano_largo <- df_agregado_4 %>%
#   select(tribo, ano, indice_abundancia) %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# # Salvar
# #write.table(df_tribo_ano_largo, "indice_abundancia_sudoeste_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# ########################
# ####### Gráfico #######
# 
# # Definir as cores e tipos de linha para cada tribo
# cores_linhas <- c("Borboletas_fechadas" = "#23867E", "Borboletas_abertas" = "#CFA154")
# tipos_linhas <- c("Borboletas_fechadas" = "solid","Borboletas_abertas" = "dashed")
# 
# dados_longos <- df_agregado_4 %>%
#   filter(tribo %in% c('Borboletas_fechadas', 'Borboletas_abertas'))
# 
# # Criar uma sequência completa de anos
# anos_completos <- factor(seq(min(dados_longos$ano), max(dados_longos$ano)))
# 
# # Criar o gráfico com duas linhas
# gg_grafico_primeira_ocorrencia_sudoeste <- ggplot(dados_longos, aes(x = as.factor(ano), y = indice_abundancia, color = tribo, linetype = tribo)) +
#   geom_line(aes(group = tribo), size = 1) +
#   geom_hline(yintercept = 1, linetype = "dashed", color = "black", size = 0.5) +
#   scale_color_manual(values = cores_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                        "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   scale_linetype_manual(values = tipos_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                           "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   theme_minimal() +
#   labs(title = "Região Climática Sudoeste Amazônica",
#        x = "",
#        y = expression("Índice de Abundância (" * italic("i") * ")"),
#        color = NULL,
#        linetype = NULL) +
#   theme(plot.title = element_text(hjust = 0.5, size = 20),
#         axis.title = element_text(size = 18),
#         axis.text = element_text(size = 14),
#         legend.title = element_text(size = 16),
#         legend.text = element_text(size = 12),
#         axis.line = element_line(color = "black"),
#         axis.line.x = element_blank(),
#         legend.position = "bottom",
#         axis.text.x = element_text(hjust = 0.5)) +
#   scale_x_discrete(labels = as.character(anos_completos))+
#   coord_cartesian(ylim = c(0, 2))
# 
# # Exibir o gráfico
# print(gg_grafico_primeira_ocorrencia_sudoeste)
# 
# # Salvar o gráfico em formato PNG
# #ggsave("indice_abundancia_sudoeste.png",
#  #      gg_grafico_primeira_ocorrencia_sudoeste,
#   #     width = 12,
#    #    height = 10,
#     #   units = "in")
# 
# #########################################################
# ######### Região Leste Amazônica
# #########################################################
# 
# # Definir o diretório de trabalho
# #setwd("~/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela")
# df_indice<-read.csv("dados/borboletas/resultado_final_com_esforco.csv", header=T, sep = ';')
# df_indice <- df_indice[!is.na(df_indice$tribo), ]
# 
# dados_regiao_especifica <- df_indice %>%
#   filter(bioma == "Amazonia", regiao == "leste")
# 
# # Agregar soma_individuos por tribo e ano
# soma_individuos_por_tribo_ano <- dados_regiao_especifica %>%
#   group_by(tribo, ano) %>%
#   summarize(soma_individuos = sum(soma_individuos, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Verificar o esforço individual por uc_ea e expedicao
# esforco_individual <- dados_regiao_especifica %>%
#   group_by(uc, uc_ea, ano, expedicao) %>%
#   summarize(esforco_individual = unique(esforco_amostral), na.rm = TRUE) %>%
#   ungroup()
# 
# # Somar os esforços por expedicao
# esforco_por_expedicao <- esforco_individual %>%
#   group_by(uc, ano, expedicao) %>%
#   summarize(esforco_total_expedicao = sum(esforco_individual, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Calcular o esforço total anual para cada ano
# esforco_total_anual <- esforco_por_expedicao %>%
#   group_by(ano) %>%
#   summarize(esforco_total_anual = sum(esforco_total_expedicao, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Juntar com soma_individuos_por_tribo_ano
# df_agregado <- soma_individuos_por_tribo_ano %>%
#   left_join(esforco_total_anual, by = "ano") %>%
#   ungroup()
# 
# # Somando os grupos de borboletas_fechadas
# borboletas_fechadas <- df_agregado %>%
#   filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_fechadas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Somando os grupos de borboletas_abertas
# borboletas_abertas <- df_agregado %>%
#   filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_abertas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Adicionando as linhas de Borboletas_fechadas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_fechadas)
# 
# # Adicionando as linhas de Borboletas_abertas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_abertas)
# 
# #################################
# # Calcular o índice de abundância referente ao ano anterior
# df_agregado_5 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          # log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1,
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_,
#                                              log10(frequencia_corrigida /lag(frequencia_corrigida))+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_5, "df_completo_leste_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_5 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo # tabela geral dos índices
# df_tribo_ano_largo <- df_agregado_5 %>%
#   select(tribo, ano, indice_abundancia) %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Tabela de índices de abundancia para o relatório
# tab_boneco_leste <- df_agregado_5 %>%
#   filter(!(row_number() %in% 28:45))
# 
# df_tribo_ano_largo_tab <- tab_boneco_leste %>%
#   select(tribo, ano, indice_abundancia) %>% # Selecionar as colunas relevantes
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# df_tribo_ano_largo_tab <- df_tribo_ano_largo_tab %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Salvar
# #write.table(df_tribo_ano_largo_tab, "indice_abundancia_leste_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Filtrar as linhas desejadas
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo %>%
#   filter(row_number() %in% c(4, 5))
# 
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo_filtrado %>%
#   mutate(tribo = ifelse(row_number() == 1, "Borboletas de florestas abertas/perturbadas",
#                         ifelse(row_number() == 2, "Borboletas de florestas fechadas/preservadas", tribo)))
# 
# ## Tabela para colocar no relatório (índice referente aos valores do ano anterior)
# #write.table(df_tribo_ano_largo_filtrado, "indice_abundancia_leste_tab_indicadoras_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# #################################
# # Calcular o índice de abundância referente ao ano de primeira ocorrencia
# df_agregado_6 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          #log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1,
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_,
#                                              log10(frequencia_corrigida / frequencia_corrigida[primeira_ocorrencia])+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_6, "df_completo_leste_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_6 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo
# df_tribo_ano_largo <- df_agregado_6 %>%
#   select(tribo, ano, indice_abundancia) %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# # Salvar
# #write.table(df_tribo_ano_largo, "indice_abundancia_leste_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# ########################
# ####### Gráfico #######
# 
# # Definir as cores e tipos de linha para cada tribo
# cores_linhas <- c("Borboletas_fechadas" = "#23867E", "Borboletas_abertas" = "#CFA154")
# tipos_linhas <- c("Borboletas_fechadas" = "solid","Borboletas_abertas" = "dashed")
# 
# dados_longos <- df_agregado_6 %>%
#   filter(tribo %in% c('Borboletas_fechadas', 'Borboletas_abertas'))
# 
# # Criar uma sequência completa de anos, incluindo os anos sem dados (2014, 2015, 2020)
# anos_completos <- factor(c(2014:2022, max(dados_longos$ano)))
# 
# dados_longos <- dados_longos %>%
#   bind_rows(data.frame(tribo = rep(unique(dados_longos$tribo), 2),
#                        ano = rep(c(2014, 2015), each = length(unique(dados_longos$tribo))),
#                        indice_abundancia = NA))
# 
# # Grafico - referente ao primeiro ano de ocorrencia
# gg_grafico_primeira_ocorrencia_leste <- ggplot(dados_longos, aes(x = as.factor(ano), y = indice_abundancia, color = tribo, linetype = tribo)) +
#   geom_line(aes(group = tribo), size = 1) +
#   geom_hline(yintercept = 1, linetype = "dashed", color = "black", size = 0.5) +
#   scale_color_manual(values = cores_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                        "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   scale_linetype_manual(values = tipos_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                           "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   theme_minimal() +
#   labs(title = "Região Climática Leste Amazônica",
#        x = "",
#        y = expression("Índice de Abundância (" * italic("i") * ")"),
#        color = NULL,
#        linetype = NULL) +
#   theme(plot.title = element_text(hjust = 0.5, size = 20),
#         axis.title = element_text(size = 18),
#         axis.text = element_text(size = 14),
#         legend.title = element_text(size = 16),
#         legend.text = element_text(size = 12),
#         axis.line = element_line(color = "black"),
#         axis.line.x = element_blank(),
#         legend.position = "bottom",
#         axis.text.x = element_text(hjust = 0.5)) +
#   scale_x_discrete(labels = as.character(anos_completos))+
#   coord_cartesian(ylim = c(0, 2))
# 
# print(gg_grafico_primeira_ocorrencia_leste)
# 
# # Salvar o gráfico em formato PNG
# #ggsave("indice_abundancia_leste.png",
#  #      gg_grafico_primeira_ocorrencia_leste,
#   #     width = 12,
#    #    height = 10,
#     #   units = "in")
# 
# #########################################################
# ######### Região Sudeste Amazônica
# #########################################################
# 
# #setwd("~/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela")
# df_indice<-read.csv("dados/borboletas/resultado_final_com_esforco.csv", header=T, sep = ';')
# df_indice <- df_indice[!is.na(df_indice$tribo), ]
# 
# dados_regiao_especifica <- df_indice %>%
#   filter(bioma == "Amazonia", regiao == "sudeste")
# 
# # Agregar soma_individuos por tribo e ano
# soma_individuos_por_tribo_ano <- dados_regiao_especifica %>%
#   group_by(tribo, ano) %>%
#   summarize(soma_individuos = sum(soma_individuos, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Verificar o esforço individual por uc_ea e expedicao
# esforco_individual <- dados_regiao_especifica %>%
#   group_by(uc, uc_ea, ano, expedicao) %>%
#   summarize(esforco_individual = unique(esforco_amostral), na.rm = TRUE) %>%
#   ungroup()
# 
# # Somar os esforços por expedicao
# esforco_por_expedicao <- esforco_individual %>%
#   group_by(uc, ano, expedicao) %>%
#   summarize(esforco_total_expedicao = sum(esforco_individual, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Calcular o esforço total anual para cada ano
# esforco_total_anual <- esforco_por_expedicao %>%
#   group_by(ano) %>%
#   summarize(esforco_total_anual = sum(esforco_total_expedicao, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Juntar com soma_individuos_por_tribo_ano
# df_agregado <- soma_individuos_por_tribo_ano %>%
#   left_join(esforco_total_anual, by = "ano") %>%
#   ungroup()
# 
# # Somando os grupos de borboletas_fechadas
# borboletas_fechadas <- df_agregado %>%
#   filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_fechadas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Somando os grupos de borboletas_abertas
# borboletas_abertas <- df_agregado %>%
#   filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_abertas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Adicionando as linhas de Borboletas_fechadas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_fechadas)
# 
# # Adicionando as linhas de Borboletas_abertas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_abertas)
# 
# #####################
# # Calcular o índice de abundância referente ao ano anterior
# df_agregado_7 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          # log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1,
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_,
#                                              log10(frequencia_corrigida /lag(frequencia_corrigida))+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_7, "df_completo_sudeste_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_7 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo
# df_tribo_ano_largo <- df_agregado_7 %>%
#   select(tribo, ano, indice_abundancia) %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Tabela de índices de abundancia para o relatório
# tab_boneco_sudeste <- df_agregado_7 %>%
#   filter(!(row_number() %in% 28:45))
# 
# df_tribo_ano_largo_tab <- tab_boneco_sudeste %>%
#   select(tribo, ano, indice_abundancia) %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# df_tribo_ano_largo_tab <- df_tribo_ano_largo_tab %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Salvar
# #write.table(df_tribo_ano_largo_tab, "indice_abundancia_sudeste_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Filtrar as linhas desejadas
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo %>%
#   filter(row_number() %in% c(4, 5))
# 
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo_filtrado %>%
#   mutate(tribo = ifelse(row_number() == 1, "Borboletas de florestas abertas/perturbadas",
#                         ifelse(row_number() == 2, "Borboletas de florestas fechadas/preservadas", tribo)))
# 
# ## Tabela para colocar no relatório (índice referente aos valores do ano anterior)
# #write.table(df_tribo_ano_largo_filtrado, "indice_abundancia_sudeste_tab_indicadoras_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# ################################
# # Calcular o índice de abundância referente ao ano de primeira ocorrencia
# df_agregado_8 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          #log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1,
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_,
#                                              log10(frequencia_corrigida / frequencia_corrigida[primeira_ocorrencia])+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_8, "df_completo_sudeste_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_8 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo
# df_tribo_ano_largo <- df_agregado_8 %>%
#   select(tribo, ano, indice_abundancia) %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# # Salvar
# #write.table(df_tribo_ano_largo, "indice_abundancia_sudeste_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# ########################
# ####### Gráfico #######
# 
# # Definir as cores e tipos de linha para cada tribo
# cores_linhas <- c("Borboletas_fechadas" = "#23867E", "Borboletas_abertas" = "#CFA154")
# tipos_linhas <- c("Borboletas_fechadas" = "solid","Borboletas_abertas" = "dashed")
# 
# dados_longos <- df_agregado_8 %>%
#   filter(tribo %in% c('Borboletas_fechadas', 'Borboletas_abertas'))
# 
# # Criar uma sequência completa de anos, incluindo os anos sem dados (2014, 2015, 2020)
# anos_completos <- factor(c(2014:2022, max(dados_longos$ano)))
# 
# dados_longos <- dados_longos %>%
#   bind_rows(data.frame(tribo = rep(unique(dados_longos$tribo), 3),
#                        ano = rep(c(2014, 2015, 2020), each = length(unique(dados_longos$tribo))),
#                        indice_abundancia = NA))
# 
# # Grafico - referente ao primeiro ano de ocorrencia
# gg_grafico_primeira_ocorrencia_sudeste <- ggplot(dados_longos, aes(x = as.factor(ano), y = indice_abundancia, color = tribo, linetype = tribo)) +
#   geom_line(aes(group = tribo), size = 1) +
#   geom_hline(yintercept = 1, linetype = "dashed", color = "black", size = 0.5) +
#   geom_point(data = filter(dados_longos, tribo == "Borboletas_abertas" & ano == 2019), aes(x = as.factor(ano), y = indice_abundancia), color = "#CFA154", size = 3) +
#   scale_color_manual(values = cores_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                        "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   scale_linetype_manual(values = tipos_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                           "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   theme_minimal() +
#   labs(title = "Região Climática Sudeste Amazônica",
#        x = "",
#        y = expression("Índice de Abundância (" * italic("i") * ")"),
#        color = NULL,
#        linetype = NULL) +
#   theme(plot.title = element_text(hjust = 0.5, size = 20),
#         axis.title = element_text(size = 18),
#         axis.text = element_text(size = 14),
#         legend.title = element_text(size = 16),
#         legend.text = element_text(size = 12),
#         axis.line = element_line(color = "black"),
#         axis.line.x = element_blank(),
#         legend.position = "bottom",
#         axis.text.x = element_text(hjust = 0.5)) +
#   scale_x_discrete(labels = as.character(anos_completos))+
#   coord_cartesian(ylim = c(0, 2))
# 
# # Exibir o gráfico
# print(gg_grafico_primeira_ocorrencia_sudeste)
# 
# # Salvar o gráfico em formato PNG
# #ggsave("indice_abundancia_sudeste.png",
#  #      gg_grafico_primeira_ocorrencia_sudeste,
#   #     width = 12,
#    #    height = 10,
#     #   units = "in")
# 
# #########################################################
# ######### Região Norte Amazônica
# #########################################################
# 
# # Definir o diretório de trabalho
# #setwd("~/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela")
# df_indice<-read.csv("dados/borboletas/resultado_final_com_esforco.csv", header=T, sep = ';')
# df_indice <- df_indice[!is.na(df_indice$tribo), ]
# 
# dados_regiao_especifica <- df_indice %>%
#   filter(bioma == "Amazonia", regiao == "norte")
# 
# # Agregar soma_individuos por tribo e ano
# soma_individuos_por_tribo_ano <- dados_regiao_especifica %>%
#   group_by(tribo, ano) %>%
#   summarize(soma_individuos = sum(soma_individuos, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Verificar o esforço individual por uc_ea e expedicao
# esforco_individual <- dados_regiao_especifica %>%
#   group_by(uc, uc_ea, ano, expedicao) %>%
#   summarize(esforco_individual = unique(esforco_amostral), na.rm = TRUE) %>%
#   ungroup()
# 
# # Somar os esforços por expedicao
# esforco_por_expedicao <- esforco_individual %>%
#   group_by(uc, ano, expedicao) %>%
#   summarize(esforco_total_expedicao = sum(esforco_individual, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Calcular o esforço total anual para cada ano
# esforco_total_anual <- esforco_por_expedicao %>%
#   group_by(ano) %>%
#   summarize(esforco_total_anual = sum(esforco_total_expedicao, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Juntar com soma_individuos_por_tribo_ano
# df_agregado <- soma_individuos_por_tribo_ano %>%
#   left_join(esforco_total_anual, by = "ano") %>%
#   ungroup()
# 
# # Somando os grupos de borboletas_fechadas
# borboletas_fechadas <- df_agregado %>%
#   filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_fechadas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Somando os grupos de borboletas_abertas
# borboletas_abertas <- df_agregado %>%
#   filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_abertas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Adicionando as linhas de Borboletas_fechadas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_fechadas)
# 
# # Adicionando as linhas de Borboletas_abertas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_abertas)
# 
# #################################
# # Calcular o índice de abundância referente ao ano anterior
# df_agregado_9 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          # log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1,
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_,
#                                              log10(frequencia_corrigida /lag(frequencia_corrigida))+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_9, "df_completo_norte_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_9 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo # tabela geral dos índices
# df_tribo_ano_largo <- df_agregado_9 %>%
#   select(tribo, ano, indice_abundancia) %>% # Selecionar as colunas relevantes
#   pivot_wider(names_from = ano, values_from = indice_abundancia) # Transformar para o formato largo
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Tabela de índices de abundancia para o relatório
# tab_boneco_norte <- df_agregado_9 %>%
#   filter(!(row_number() %in% 28:45))
# 
# df_tribo_ano_largo_tab <- tab_boneco_norte %>%
#   select(tribo, ano, indice_abundancia) %>% # Selecionar as colunas relevantes
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# df_tribo_ano_largo_tab <- df_tribo_ano_largo_tab %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Salvar
# #write.table(df_tribo_ano_largo_tab, "indice_abundancia_norte_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Filtrar as linhas desejadas
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo %>%
#   filter(row_number() %in% c(4, 5))
# 
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo_filtrado %>%
#   mutate(tribo = ifelse(row_number() == 1, "Borboletas de florestas abertas/perturbadas",
#                         ifelse(row_number() == 2, "Borboletas de florestas fechadas/preservadas", tribo)))
# 
# ## Tabela para colocar no relatório (índice referente aos valores do ano anterior)
# #write.table(df_tribo_ano_largo_filtrado, "indice_abundancia_norte_tab_indicadoras_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# #################################
# # Calcular o índice de abundância referente ao ano de primeira ocorrencia
# df_agregado_10 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          #log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1,
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_,
#                                              log10(frequencia_corrigida / frequencia_corrigida[primeira_ocorrencia])+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_10, "df_completo_norte_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_10 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo
# df_tribo_ano_largo <- df_agregado_10 %>%
#   select(tribo, ano, indice_abundancia) %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# # Salvar o dataframe em um arquivo de texto
# #write.table(df_tribo_ano_largo, "indice_abundancia_norte_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# ########################
# ####### Gráfico #######
# 
# # Definir as cores e tipos de linha para cada tribo
# cores_linhas <- c("Borboletas_fechadas" = "#23867E", "Borboletas_abertas" = "#CFA154")
# tipos_linhas <- c("Borboletas_fechadas" = "solid","Borboletas_abertas" = "dashed")
# 
# dados_longos <- df_agregado_10 %>%
#   filter(tribo %in% c('Borboletas_fechadas', 'Borboletas_abertas'))
# 
# # Criar uma sequência completa de anos, incluindo os anos sem dados (2014, 2015)
# anos_completos <- factor(c(2014:2022))
# 
# dados_longos <- dados_longos %>%
#   bind_rows(data.frame(tribo = rep(unique(dados_longos$tribo), 2),
#                        ano = rep(c(2014, 2015), each = length(unique(dados_longos$tribo))),
#                        indice_abundancia = NA))
# 
# # Grafico - referente ao primeiro ano de ocorrencia
# gg_grafico_primeira_ocorrencia_norte <- ggplot(dados_longos, aes(x = as.factor(ano), y = indice_abundancia, color = tribo, linetype = tribo)) +
#   geom_line(data = subset(dados_longos, ano >= 2018), aes(group = tribo), size = 1) +  #tava dando erro, pois os dados tavam comecando em 2017,mas é para começar em 2018
#   geom_hline(yintercept = 1, linetype = "dashed", color = "black", size = 0.5) +
#   scale_color_manual(values = cores_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                        "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   scale_linetype_manual(values = tipos_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                           "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   theme_minimal() +
#   labs(title = "Região Climática Norte Amazônica",
#        x = "",
#        y = expression("Índice de Abundância (" * italic("i") * ")"),
#        color = NULL,
#        linetype = NULL) +
#   theme(plot.title = element_text(hjust = 0.5, size = 20),
#         axis.title = element_text(size = 18),
#         axis.text = element_text(size = 14),
#         legend.title = element_text(size = 16),
#         legend.text = element_text(size = 12),
#         axis.line = element_line(color = "black"),
#         axis.line.x = element_blank(),
#         legend.position = "bottom",
#         axis.text.x = element_text(hjust = 0.5),
#         panel.grid.major = element_line(color = "gray80", size = 0.4),
#         panel.grid.minor = element_blank()) +
#   scale_x_discrete(limits = as.character(2014:2022)) +
#   coord_cartesian(ylim = c(0, 2))
# 
# # print(gg_grafico_primeira_ocorrencia_norte)
# 
# # Salvar o gráfico em formato PNG
# #ggsave("indice_abundancia_norte.png",
#  #      gg_grafico_primeira_ocorrencia_norte,
#   #     width = 12,
#    #    height = 10,
#     #   units = "in")
# 
# ##############################################
# #### Gráficos combinados
# #############################################
# 
# library(gridExtra)
# indice_abu_amazonia <- grid.arrange(
#   gg_grafico_primeira_ocorrencia_central + theme(legend.position = "none",
#                                                  axis.text.x = element_blank(),
#                                                  axis.title = element_text(size = 14),
#                                                  plot.title = element_text(size = 18),
#                                                  panel.spacing = unit(0.5, "lines"),
#                                                  panel.grid.major = element_line(color = "gray80", size = 0.4),
#                                                  axis.ticks.y = element_line(color = "black", size = 0.4)),
#   gg_grafico_primeira_ocorrencia_sudoeste + theme(legend.position = "none",
#                                                   axis.text.x = element_blank(),
#                                                   axis.title = element_text(size = 14),
#                                                   plot.title = element_text(size = 18),
#                                                   panel.spacing = unit(0.5, "lines"),
#                                                   panel.grid.major = element_line(color = "gray80", size = 0.4),
#                                                   axis.ticks.y = element_line(color = "black", size = 0.4)),
#   gg_grafico_primeira_ocorrencia_leste + theme(legend.position = "none",
#                                                axis.text.x = element_blank(),
#                                                axis.title = element_text(size = 14),
#                                                plot.title = element_text(size = 18),
#                                                panel.spacing = unit(0.5, "lines"),
#                                                panel.grid.major = element_line(color = "gray80", size = 0.4),
#                                                axis.ticks.y = element_line(color = "black", size = 0.4)),
#   gg_grafico_primeira_ocorrencia_sudeste + theme(legend.position = "none",
#                                                  axis.text.x = element_blank(),
#                                                  axis.title = element_text(size = 14),
#                                                  plot.title = element_text(size = 18),
#                                                  panel.grid.major = element_line(color = "gray80", size = 0.4),
#                                                  axis.ticks.y = element_line(color = "black", size = 0.4)),
#   gg_grafico_primeira_ocorrencia_norte + theme(legend.position = "bottom",
#                                                axis.text.x = element_text(size = 20),
#                                                axis.title = element_text(size = 14),
#                                                plot.title = element_text(size = 18),
#                                                panel.spacing = unit(0.5, "lines"),
#                                                panel.grid.major = element_line(color = "gray80", size = 0.4),
#                                                axis.ticks.y = element_line(color = "black", size = 0.4),
#                                                legend.text = element_text(size = 20)),
#   nrow = 5,  heights = c(10, 10, 10, 10, 13)
# )
# 
# # Remover os painéis menores
# indice_abu_amazonia$grobs[[1]]$grobs[[1]]$children[[2]]$children[[2]] <- NULL
# indice_abu_amazonia$grobs[[2]]$grobs[[1]]$children[[2]]$children[[2]] <- NULL
# indice_abu_amazonia$grobs[[3]]$grobs[[1]]$children[[2]]$children[[2]] <- NULL
# indice_abu_amazonia$grobs[[4]]$grobs[[1]]$children[[2]]$children[[2]] <- NULL
# indice_abu_amazonia$grobs[[5]]$grobs[[1]]$children[[2]]$children[[2]] <- NULL
# 
# # Exibir a imagem
# print(indice_abu_amazonia)
# 
# # Salvar o gráfico em formato PNG
# 
# ggsave("imagens/cap04/indice_abundancia_combinado_amazonia.png",
#        indice_abu_amazonia,
#        width = 16,
#        height = 16,
#        units = "in")


```

</br>


```{r grafico IA-regiões_climaticas_amazonia}
#| label: fig-ind-abund-regioes-climaticas-combinado
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Variação no índice de tendência populacional analisando a abundância das tribos de borboletas frugívoras do bioma Amazônico em relação ao primeiro ano de ocorrência. Tribos de borboletas indicadoras de florestas fechadas/preservadas (Brassolini, Morphini e Haeterini) estão somadas e representadas pela linha contínua verde. As tribos de borboletas indicadoras de florestas abertas/perturbadas (Callicorini, Biblidini e Ageroniini) estão somadas e representadas pela linha pontilhada ocre."


knitr::include_graphics("imagens/cap04/indice_abundancia_combinado_amazonia.png")

```


</br>


#### Cerrado 

 

O Cerrado apresenta uma composição de tribos muito distinta dos biomas mais florestais, como Amazônia e Mata Atlântica (@fig-abundancia-regiao-total). Os dados obtidos para este bioma apresentaram grandes variações entre anos (@fig-regiao-cerrado) causados pela grande variação nas unidades de conservação amostradas a cada ano. Isto dificulta a determinação de padrões claros para o bioma.  

O grande aumento observado em todas as populações de borboletas de florestas abertas e fechadas indica que o primeiro ano da série (2014) deve ter sido um ano um tanto atípico, com abundâncias abaixo da média, dado que todas as populações aumentaram nos anos seguintes (fig-ind-abund-cerrado). Alternativamente, é possível que os ciclos observados no Cerrado tenham um pulso mais longo, o que somente poderá ser comprovado com uma série histórica bem mais extensa do que a atual. No entanto, ressaltamos que a bioindicação obtida pela abundância dos grupos associados a florestas fechadas pode não ser a melhor para este bioma, dado que a tribo Haeterini não ocorreu nas amostragens e que as tribos Brassolini e Morphini são naturalmente pouco abundantes em florestas secas, cerradão e cerrado denso. 

 
</br>


```{r grafico IA-cerrado-calculos}
#| label: ind-abund-cerrado-calculos
#| echo: false
#| message: false
#| warning: false
#| include: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'


##### Índices de abundância de tribos ao longo dos anos - Cerrado
##Script: Isabela Freitas Oliveira

# library(dplyr)
# library(tidyr)
# 
# # Definir o diretório de trabalho
# # setwd("~/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela")
# df_indice<-read.csv("dados/borboletas/resultado_final_com_esforco.csv", header=T, sep = ';') 
# df_indice <- df_indice[!is.na(df_indice$tribo), ]
# 
# dados_regiao_especifica <- df_indice %>%
#   filter(bioma == "Cerrado")
# 
# # Agregar soma_individuos por tribo e ano
# soma_individuos_por_tribo_ano <- dados_regiao_especifica %>%
#   group_by(tribo, ano) %>%
#   summarize(soma_individuos = sum(soma_individuos, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Verificar o esforço individual por uc_ea e expedicao
# esforco_individual <- dados_regiao_especifica %>%
#   group_by(uc, uc_ea, ano, expedicao) %>%
#   summarize(esforco_individual = unique(esforco_amostral), na.rm = TRUE) %>%
#   ungroup()
# 
# # Somar os esforços por expedicao
# esforco_por_expedicao <- esforco_individual %>%
#   group_by(uc, ano, expedicao) %>%
#   summarize(esforco_total_expedicao = sum(esforco_individual, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Calcular o esforço total anual para cada ano
# esforco_total_anual <- esforco_por_expedicao %>%
#   group_by(ano) %>%
#   summarize(esforco_total_anual = sum(esforco_total_expedicao, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Juntar com soma_individuos_por_tribo_ano
# df_agregado <- soma_individuos_por_tribo_ano %>%
#   left_join(esforco_total_anual, by = "ano") %>%
#   ungroup()
# 
# # Somando os grupos de borboletas_fechadas
# borboletas_fechadas <- df_agregado %>%
#   filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_fechadas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Somando os grupos de borboletas_abertas
# borboletas_abertas <- df_agregado %>%
#   filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_abertas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Adicionando as linhas de Borboletas_fechadas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_fechadas)
# 
# # Adicionando as linhas de Borboletas_abertas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_abertas)
# 
# #######################
# # Calcular o índice de abundância referente ao ano anterior
# df_agregado_1 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          # log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1, 
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_, 
#                                              log10(frequencia_corrigida /lag(frequencia_corrigida))+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_1, "df_completo_cerrado_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_1 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo
# df_tribo_ano_largo <- df_agregado_1 %>%
#   select(tribo, ano, indice_abundancia) %>% 
#   pivot_wider(names_from = ano, values_from = indice_abundancia) 
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Tabela de índices de abundancia para o relatório
# tab_boneco_cerrado <- df_agregado_1 %>%
#   filter(!(row_number() %in% 28:45))
# 
# df_tribo_ano_largo_tab <- tab_boneco_cerrado %>%
#   select(tribo, ano, indice_abundancia) %>% 
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# df_tribo_ano_largo_tab <- df_tribo_ano_largo_tab %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Salvar
# #write.table(df_tribo_ano_largo_tab, "indice_abundancia_cerrado_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Filtrar as linhas desejadas
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo %>%
#   filter(row_number() %in% c(4, 5))
# 
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo_filtrado %>%
#   mutate(tribo = ifelse(row_number() == 1, "Borboletas de florestas abertas/perturbadas", 
#                         ifelse(row_number() == 2, "Borboletas de florestas fechadas/preservadas", tribo)))
# 
# ## Tabela para colocar no relatório (índice referente aos valores do ano anterior)
# #write.table(df_tribo_ano_largo_filtrado, "indice_abundancia_cerrado_tab_indicadoras_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# ######################
# # Calcular o índice de abundância referente ao ano de primeira ocorrencia
# df_agregado_2 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          #log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1, 
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_, 
#                                              log10(frequencia_corrigida / frequencia_corrigida[primeira_ocorrencia])+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_2, "df_completo_cerrado_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_2 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo
# df_tribo_ano_largo <- df_agregado_2 %>%
#   select(tribo, ano, indice_abundancia) %>% 
#   pivot_wider(names_from = ano, values_from = indice_abundancia) 
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# # Salvar
# #write.table(df_tribo_ano_largo, "indice_abundancia_cerrado_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# ############
# #Gráfico
# library(ggplot2)
# 
# # Definir as cores e tipos de linha para cada tribo
# cores_linhas <- c("Borboletas_fechadas" = "#23867E", "Borboletas_abertas" = "#CFA154")
# tipos_linhas <- c("Borboletas_fechadas" = "solid","Borboletas_abertas" = "dashed")
# 
# dados_longos <- df_agregado_2 %>%
#   filter(tribo %in% c('Borboletas_fechadas', 'Borboletas_abertas'))
# 
# # Criar uma sequência completa de anos, incluindo os anos sem dados (2014, 2015, 2020)
# anos_completos <- factor(c(2014:2022, max(dados_longos$ano)))
# 
# dados_longos <- dados_longos %>%
#   bind_rows(data.frame(tribo = rep(unique(dados_longos$tribo), 1),
#                        ano = 2020, each = length(unique(dados_longos$tribo)),
#                        indice_abundancia = NA))
# 
# # Criar uma sequência completa de anos
# anos_completos <- factor(seq(min(dados_longos$ano), max(dados_longos$ano)))
# 
# # Grafico - referente ao primeiro ano de ocorrencia
# gg_grafico_primeira_ocorrencia_cerrado <- ggplot(dados_longos, aes(x = as.factor(ano), y = indice_abundancia, color = tribo, linetype = tribo)) +
#   geom_line(aes(group = tribo), size = 1) +
#   geom_hline(yintercept = 1, linetype = "dashed", color = "black", size = 0.5) +
#   scale_color_manual(values = cores_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                        "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   scale_linetype_manual(values = tipos_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                           "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   theme_minimal() +
#   labs(title = "Cerrado",
#        x = "",
#        y = expression("Índice de Abundância (" * italic("i") * ")"),
#        color = NULL,
#        linetype = NULL) +
#   theme(plot.title = element_text(hjust = 0.5, size = 20),
#         axis.title = element_text(size = 18),
#         axis.text = element_text(size = 16),
#         legend.title = element_text(size = 16),
#         legend.text = element_text(size = 12),
#         axis.line = element_line(color = "black"),
#         axis.line.x = element_blank(),
#         legend.position = "bottom",
#         axis.text.x = element_text(hjust = 0.5)) +
#   scale_x_discrete(labels = as.character(anos_completos))+
#   coord_cartesian(ylim = c(0, 2)) 
# 
# # Exibir o gráfico
# print(gg_grafico_primeira_ocorrencia_cerrado)
# 
# # Salvar o gráfico em formato PNG
# ggsave("imagens/cap04/bo-indice-abundancia-cerrado.png",
#       gg_grafico_primeira_ocorrencia_cerrado,
#      width = 10,
#     height = 5, 
#    units = "in") 


```

</br>


```{r grafico IA-cerrado}
#| label: fig-ind-abund-cerrado
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Variação no índice de tendência populacional analisando a abundância das tribos de borboletas frugívoras do bioma Cerrado em relação ao primeiro ano de ocorrência. Tribos de borboletas indicadoras de florestas fechadas/preservadas (Brassolini, Morphini e Haeterini) estão somadas e representadas pela linha contínua verde. As tribos de borboletas indicadoras de florestas abertas/perturbadas (Callicorini, Biblidini e Ageroniini) estão somadas e representadas pela linha pontilhada ocre."


knitr::include_graphics("imagens/cap04/bo-indice-abundancia-cerrado.png")

```

</br>


#### Mata Atlântica  

</b>

O padrão de bioindicação para a Mata Atlântica é similar àquele observado para as diferentes regiões amazônicas, apesar de haver maior equitabilidade de distribuição das diversas tribos de borboletas (@fig-abundancia-regiao-total). Não foram registradas espécies da tribo Haeterini nas UCs amostradas.  

Os dados obtidos para as UCs da Mata Atlântica são muito influenciados pela alta captura obtida no PARNA do Iguaçu, que contribui com 74% da abundância total observada para o bioma. Unidades de conservação como o PARNA da Serra dos Órgãos, PARNA Serra da Bocaina e PARNA do Superagui têm registrado baixos números de borboletas frugívoras na maior parte dos anos, o que nos alerta para a necessidade de conhecer melhor as variações desta comunidade ao longo do tempo.  

Apesar das UCs deste bioma não terem sido suficientemente amostradas, pode-se observar um aparente declínio na abundância das tribos indicadoras de florestas fechadas/preservadas, que se deu de forma contínua ao longo de todo o período de amostragem. Tal conclusão, no entanto, ainda carece de dados para ser confirmada. Já as tribos indicadoras de florestas abertas/perturbadas apresentaram flutuações drásticas, provavelmente devido a estocasticidade relacionada ao baixo número amostral (@fig-ind-abund-mata-atlantica).  


</br>


```{r IA-mata-atlantica-calculos}
#| label: ind-abund-mata-atlantica-calculos
#| echo: false
#| message: false
#| warning: false
#| include: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'


##### Índices de abundância de tribos ao longo dos anos - Mata Atlântica
##Script: Isabela Freitas Oliveira

# library(dplyr)
# library(tidyr)
# 
# # Definir o diretório de trabalho
# #setwd("~/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela")
# df_indice<-read.csv("dados/borboletas/resultado_final_com_esforco.csv", header=T, sep = ';') 
# df_indice <- df_indice[!is.na(df_indice$tribo), ]
# 
# dados_regiao_especifica <- df_indice %>%
#   filter(bioma == "Mata_Atlantica")
# 
# # Agregar soma_individuos por tribo e ano
# soma_individuos_por_tribo_ano <- dados_regiao_especifica %>%
#   group_by(tribo, ano) %>%
#   summarize(soma_individuos = sum(soma_individuos, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Verificar o esforço individual por uc_ea e expedicao
# esforco_individual <- dados_regiao_especifica %>%
#   group_by(uc, uc_ea, ano, expedicao) %>%
#   summarize(esforco_individual = unique(esforco_amostral), na.rm = TRUE) %>%
#   ungroup()
# 
# # Somar os esforços por expedicao
# esforco_por_expedicao <- esforco_individual %>%
#   group_by(uc, ano, expedicao) %>%
#   summarize(esforco_total_expedicao = sum(esforco_individual, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Calcular o esforço total anual para cada ano
# esforco_total_anual <- esforco_por_expedicao %>%
#   group_by(ano) %>%
#   summarize(esforco_total_anual = sum(esforco_total_expedicao, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Juntar com soma_individuos_por_tribo_ano
# df_agregado <- soma_individuos_por_tribo_ano %>%
#   left_join(esforco_total_anual, by = "ano") %>%
#   ungroup()
# 
# # Somando os grupos de borboletas_fechadas
# borboletas_fechadas <- df_agregado %>%
#   filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_fechadas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Brassolini', 'Morphini', 'Haeterini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Somando os grupos de borboletas_abertas
# borboletas_abertas <- df_agregado %>%
#   filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>%
#   group_by(ano) %>%
#   summarise(soma_individuos = sum(soma_individuos)) %>%
#   ungroup() %>%
#   mutate(tribo = 'Borboletas_abertas') %>%
#   left_join(df_agregado %>% filter(tribo %in% c('Ageroniini', 'Callicorini', 'Biblidini')) %>% select(ano, esforco_total_anual) %>% distinct(), by = "ano")
# 
# # Adicionando as linhas de Borboletas_fechadas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_fechadas)
# 
# # Adicionando as linhas de Borboletas_abertas ao dataframe original
# df_agregado <- bind_rows(df_agregado, borboletas_abertas)
# 
# #######################
# # Calcular o índice de abundância referente ao ano anterior
# df_agregado_1 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          # log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1, 
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_, 
#                                              log10(frequencia_corrigida /lag(frequencia_corrigida))+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_1, "df_completo_mata_atlantica_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_1 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo
# df_tribo_ano_largo <- df_agregado_1 %>%
#   select(tribo, ano, indice_abundancia) %>% 
#   pivot_wider(names_from = ano, values_from = indice_abundancia) 
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Tabela de índices de abundancia para o relatório
# tab_boneco_mata_atlantica <- df_agregado_1 %>%
#   filter(!(row_number() %in% 28:45))
# 
# df_tribo_ano_largo_tab <- tab_boneco_mata_atlantica %>%
#   select(tribo, ano, indice_abundancia) %>% 
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# df_tribo_ano_largo_tab <- df_tribo_ano_largo_tab %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# #Salvar
# #write.table(df_tribo_ano_largo_tab, "indice_abundancia_mata_atlantica_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# # Filtrar as linhas desejadas
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo %>%
#   filter(row_number() %in% c(4, 5))
# 
# df_tribo_ano_largo_filtrado <- df_tribo_ano_largo_filtrado %>%
#   mutate(tribo = ifelse(row_number() == 1, "Borboletas de florestas abertas/perturbadas", 
#                         ifelse(row_number() == 2, "Borboletas de florestas fechadas/preservadas", tribo)))
# 
# ## Tabela para colocar no relatório (índice referente aos valores do ano anterior)
# #write.table(df_tribo_ano_largo_filtrado, "indice_abundancia_mata_atlantica_tab_indicadoras_ano_anterior.txt", sep = "\t", row.names = FALSE)
# 
# ######################
# # Calcular o índice de abundância referente ao ano de primeira ocorrencia
# df_agregado_2 <- df_agregado %>%
#   group_by(tribo) %>%
#   arrange(tribo, ano) %>%
#   mutate(frequencia_corrigida = (soma_individuos + 0.00001) / esforco_total_anual,
#          #log_frequencia_corrigida = log10(frequencia_corrigida),
#          primeira_ocorrencia = which(soma_individuos >= 20)[1],
#          indice_abundancia = if_else(row_number() == primeira_ocorrencia, 1, 
#                                      if_else(row_number() < primeira_ocorrencia, NA_real_, 
#                                              log10(frequencia_corrigida / frequencia_corrigida[primeira_ocorrencia])+1))) %>%
#   ungroup() %>%
#   select(-primeira_ocorrencia)
# 
# #Tabela completa
# #write.table(df_agregado_2, "df_completo_mata_atlantica_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# # Reestruturar para visualização
# df_tribo_ano_largo <- df_agregado_2 %>%
#   pivot_wider(names_from = ano, values_from = indice_abundancia)
# 
# # Reestruturar o dataframe para o formato largo
# df_tribo_ano_largo <- df_agregado_2 %>%
#   select(tribo, ano, indice_abundancia) %>% 
#   pivot_wider(names_from = ano, values_from = indice_abundancia) 
# 
# # Limitar os valores a 3 casas decimais
# df_tribo_ano_largo <- df_tribo_ano_largo %>%
#   mutate_if(is.numeric, ~ round(., 3))
# 
# # Salvar
# #write.table(df_tribo_ano_largo, "indice_abundancia_mata_atlantica_primeiro_ano.txt", sep = "\t", row.names = FALSE)
# 
# ############
# #Gráfico
# library(ggplot2)
# 
# # Definir as cores e tipos de linha para cada tribo
# cores_linhas <- c("Borboletas_fechadas" = "#23867E", "Borboletas_abertas" = "#CFA154")
# tipos_linhas <- c("Borboletas_fechadas" = "solid","Borboletas_abertas" = "dashed")
# 
# dados_longos <- df_agregado_2 %>%
#   filter(tribo %in% c('Borboletas_fechadas', 'Borboletas_abertas'))
# 
# # Criar uma sequência completa de anos, incluindo os anos sem dados (2014, 2015, 2020)
# anos_completos <- factor(c(2014:2022, max(dados_longos$ano)))
# 
# dados_longos <- dados_longos %>%
#   bind_rows(data.frame(tribo = rep(unique(dados_longos$tribo), 1),
#                        ano = 2020, each = length(unique(dados_longos$tribo)),
#                        indice_abundancia = NA))
# 
# # Criar uma sequência completa de anos
# anos_completos <- factor(seq(min(dados_longos$ano), max(dados_longos$ano)))
# 
# # Grafico - referente ao primeiro ano de ocorrencia
# gg_grafico_primeira_ocorrencia_mata_atlantica <- ggplot(dados_longos, aes(x = as.factor(ano), y = indice_abundancia, color = tribo, linetype = tribo)) +
#   geom_line(aes(group = tribo), size = 1) +
#   geom_hline(yintercept = 1, linetype = "dashed", color = "black", size = 0.5) +
#   scale_color_manual(values = cores_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                        "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   scale_linetype_manual(values = tipos_linhas, labels = c("Borboletas_fechadas" = "Borboletas de áreas florestais fechadas/preservadas",
#                                                           "Borboletas_abertas" = "Borboletas de áreas florestais abertas/perturbadas")) +
#   theme_minimal() +
#   labs(title = "Mata Atlântica",
#        x = "",
#        y = expression("Índice de Abundância (" * italic("i") * ")"),
#        color = NULL,
#        linetype = NULL) +
#   theme(plot.title = element_text(hjust = 0.5, size = 20),
#         axis.title = element_text(size = 18),
#         axis.text = element_text(size = 16),
#         legend.title = element_text(size = 16),
#         legend.text = element_text(size = 12),
#         axis.line = element_line(color = "black"),
#         axis.line.x = element_blank(),
#         legend.position = "bottom",
#         axis.text.x = element_text(hjust = 0.5)) +
#   scale_x_discrete(labels = as.character(anos_completos))+
#   coord_cartesian(ylim = c(-0.5, 2)) 
# 
# # Exibir o gráfico
# print(gg_grafico_primeira_ocorrencia_mata_atlantica)
# 
# # Salvar o gráfico em formato PNG
# ggsave("imagens/cap04/bo-indice-abundancia-mata-atlantica.png",
#        gg_grafico_primeira_ocorrencia_mata_atlantica,
#        width = 10,
#        height = 5, 
#        units = "in") 


```

</br>

```{r grafico IA-mata-atlantica}
#| label: fig-ind-abund-mata-atlantica
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Variação no índice de tendência populacional analisando a abundância das tribos de borboletas frugívoras do bioma Mata Atlântica em relação ao primeiro ano de ocorrência. Tribos de borboletas indicadoras de florestas fechadas/preservadas (Brassolini, Morphini e Haeterini) estão somadas e representadas pela linha contínua verde. As tribos de borboletas indicadoras de florestas abertas/perturbadas (Callicorini, Biblidini e Ageroniini) estão somadas e representadas pela linha pontilhada ocre."


knitr::include_graphics("imagens/cap04/bo-indice-abundancia-mata-atlantica.png")

```




Na segunda abordagem utilizada para o índice de abundância, a análise de variações populacionais instantâneas, os valores de cada ano foram comparados ao valor do ano anterior. Na região climática sudoeste amazônica foi observada uma redução de Ageroniini (a única tribo representante das borboletas indicadoras de florestas abertas/perturbadas observadas na região) nos anos de 2017 e 2018, mas um aumento considerável da tribo em 2019. Devido a este grande crescimento populacional de Ageroniini e do esforço amostral na região em 2019 (2.122 indivíduos amostrados em 76 campanhas realizadas, com 38 EAs), o ano de 2020 apresentou uma redução drástica no índice, tanto devido ao baixo número de indivíduos de Ageroniini (n = 42), quanto à redução do esforço amostral para 26 campanhas (com 13 EAs). No ano de 2021 houve um aumento do índice em relação ao ano anterior, e uma pequena redução em 2022 (@fig-IA2-regioes-amazonia).   

As borboletas indicadoras de florestas fechadas/preservadas, por outro lado, seguiram o padrão inverso apresentado pelas borboletas indicadoras de florestas abertas/perturbadas, exceto em 2018, quando também sofreu uma redução do índice (@fig-IA2-regioes-amazonia). Esta é uma dinâmica "populacional" esperada, visto que as borboletas indicadoras de florestas fechadas e florestas abertas possuem requerimentos ambientais e climáticos contrastantes.  

As borboletas indicadoras de florestas fechadas/preservadas, por outro lado, seguiram o padrão inverso apresentado pelas borboletas indicadoras de florestas abertas/perturbadas, exceto em 2018, quando também sofreu uma redução do índice (@fig-IA2-regioes-amazonia). Esta é uma dinâmica populacional esperada, visto que as borboletas indicadoras de florestas fechadas e florestas abertas possuem requerimentos ambientais e climáticos contrastantes. 

Na região climática central amazônica, as tribos indicadoras de florestas abertas/perturbadas, representadas somente por Ageroniini, tiveram um aumento populacional em 2017 em relação a 2016, com uma subsequente redução nos anos de 2018 e 2019 (@fig-IA2-regioes-amazonia). A partir de 2020, houve um pequeno aumento em relação ao ano anterior e em 2021 esta tribo apresentou um grande aumento populacional. Porém, no ano seguinte, houve uma grande redução populacional desse grupo de borboletas (@fig-IA2-regioes-amazonia). No caso das borboletas de florestas fechadas/preservadas, notou-se uma oscilação de crescimento e redução populacional ao longo dos anos, com crescimento nos anos de 2020 e 2021 (@fig-IA2-regioes-amazonia). Os grupos indicadores tiveram o mesmo padrão de crescimento populacional em relação ao ano anterior em 2019, 2020 e 2021, ambos com diminuição populacional em 2022 (@fig-IA2-regioes-amazonia).  

Na região climática leste amazônica as tribos indicadoras de florestas fechadas e abertas apresentaram padrões de crescimento e diminuição populacional similares ao longo dos anos, com exceção de 2022, quando borboletas indicadoras de florestas abertas tiveram um aumento populacional em relação ao ano anterior, enquanto as borboletas indicadoras de florestas fechadas apresentaram uma redução (@fig-IA2-regioes-amazonia). Apesar dos mesmos padrões, as proporções das mudanças populacionais de um ano para o outro entre os dois grupos indicadores foram diferentes.  

A região climática sudeste amazônica não apresentou, em nenhum ano amostrado, o número mínimo de borboletas indicadoras de florestas abertas/perturbadas para que o índice fosse calculado (@fig-IA2-regioes-amazonia). No entanto, as borboletas indicadoras de florestas fechadas/preservadas mostraram uma oscilação populacional entre os anos (@fig-IA2-regioes-amazonia).  

Na região climática norte amazônica os grupos indicadores apresentaram um número mínimo de indivíduos para o cálculo do índice apenas a partir de 2018. Os padrões dos dois grupos foram congruentes em todos os anos, exceto em 2022, quando a abundância de borboletas indicadoras de florestas abertas/perturbadas aumentou em relação ao ano anterior, e as borboletas indicadoras de florestas fechadas/preservadas mostraram uma pequena redução (@fig-IA2-regioes-amazonia).  

</br>


```{r grafico IA2 regiões amazônia}
#| label: fig-IA2-regioes-amazonia
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Variação no Índice de variação instantânea das tribos de borboletas frugívoras do bioma Amazônico em relação ao ano anterior. Tribos de borboletas indicadoras de florestas fechadas/preservadas (Brassolini, Morphini e Haeterini) estão somadas e representadas pela linha contínua verde. As tribos de borboletas indicadoras de florestas abertas/perturbadas (Callicorini, Biblidini e Ageroniini) estão somadas e representadas pela linha pontilhada ocre."


knitr::include_graphics("imagens/cap04/bo-IA2-regioes-amazonia.png")

```

</br>

A variação instantânea observada nas populações das tribos de borboletas indicadoras de florestas fechadas e abertas no Cerrado mostram variações grandes entre anos (@fig-IA2-cerrado). No entanto, como os dados se referem a UCs diferentes em anos diferentes, as variações podem estar relacionadas a diferenças existentes entre as comunidades de borboletas nessas áreas, podendo não refletir bem as variações populacionais desses grupos no bioma.  

</br>


```{r grafico IA2 Cerrado}
#| label: fig-IA2-cerrado
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Variação no Índice de variação instantânea das tribos de borboletas frugívoras do bioma Cerrado em relação ao ano anterior. Tribos de borboletas indicadoras de florestas fechadas/preservadas (Brassolini e Morphini) estão somadas e representadas pela linha contínua verde. As tribos de borboletas indicadoras de florestas abertas/perturbadas (Callicorini, Biblidini e Ageroniini) estão somadas e representadas pela linha pontilhada ocre."


knitr::include_graphics("imagens/cap04/bo-IA2-cerrado.png")

```

</br>


As variações populacionais instantâneas observadas para as tribos de borboletas de florestas abertas nas UCs da Mata Atlântica (@fig-IA2-mata-atlantica) explicam as grandes variações observadas no índice de tendência populacional (@fig-ind-abund-mata-atlantica). Já as variações instantâneas observadas para as borboletas de florestas fechadas confirmam a tendência de redução dessas populações observadas no período, pois foram observadas poucas variações positivas. Apesar desta tendência ser muito influenciada pelo grande volume de informações vindas do PARNA Iguaçu, esse padrão precisa ser monitorado para avaliar se a tendência continua. 

</br>


```{r grafico IA2 Mata Atlântica}
#| label: fig-IA2-mata-atlantica
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Variação no Índice de variação instantânea das tribos de borboletas frugívoras do bioma Mata Atlântica em relação ao ano anterior. Tribos de borboletas indicadoras de florestas fechadas/preservadas (Brassolini e Morphini) estão somadas e representadas pela linha contínua verde. As tribos de borboletas indicadoras de florestas abertas/perturbadas (Callicorini, Biblidini e Ageroniini) estão somadas e representadas pela linha pontilhada ocre."


knitr::include_graphics("imagens/cap04/bo-IA2-mata-atlantica.png")

```

</br>



### Destaque

</br>


#### Efeito da queda dos tabocais na abundância das tribos de borboletas frugívoras no sudoeste da Amazônia  

</br>

Na região sudoeste da Amazônia, especialmente no estado do Acre, encontra-se uma vasta área de florestas de bambuzais do gênero *Guadua*, chamadas localmente de 'tabocal'. Estas florestas se estendem por uma superfície de aproximadamente 162.000 km^2^, na qual uma única população de bambu pode ocupar uma área de 330 km^2^ (@Carvalho_2013). Essas populações de taboca têm um ciclo de vida que varia de 27-28 anos (@Carvalho_2013). A população entra em senescência após sua reprodução sexuada, inicialmente com a perda de folhas dos indivíduos e, no fim, com sua sua morte e queda. As manchas de bambu são densas e altas e, ao morrerem, deixam uma grande porção de floresta aberta. 

Algumas UCs do Acre possuem extensas manchas florestas de tabocal e,  nos últimos anos, foram relatadas mortes de diversas dessas populações (Marcos Silveira, comunicação pessoal, 15 de janeiro de 2024). Porém, essa mortalidade não é imediata e a senescência dessas manchas pode levar mais de um ano. Há relatos da mortalidade de extensas áreas de tabocal de 2017 a 2021 nas seguintes UCs do Programa Monitora: RESEX do Cazumbá-Iracema (2017 e 2018), RESEX do Alto Tarauacá e RESEX Chico Mendes (2018) e RESEX Riozinho da Liberdade (2021). 

Para avaliar se a mortalidade das manchas de tabocal influenciou a abundância das tribos de borboletas frugívoras em cada UC, foi feito uma comparação entre anos para cada tribo, por meio do teste de Wilcoxon (ou teste U de Mann-Whitney). Este teste compara as medianas das abundâncias padronizadas pelo esforço amostral dos anos específicos com a mediana geral (a soma das medianas dos anos específicos dividida pelo número de anos). Um valor de *p* ≤ 0.01 indica que houve diferença significativa entre a mediana do ano específico e a mediana geral. Admitindo-se  que um evento de distúrbio na floresta pode influenciar a comunidade de borboletas tanto no mesmo ano quanto no ano seguinte, essas duas possibilidades foram consideradas na interpretação dos resultados. O valor de *p* considerado foi de 0.01, para que apenas efeitos mais fortes fossem detectados nos testes. A sobreposição dos intervalos de confiança de cada ano indica que não houve diferença significativa da abundância. As análises também foram aplicadas às tribos de borboletas do PARNA Serra do Divisor, local considerado "controle", por não apresentar florestas de taboca. 

Na RESEX do Cazumbá-Iracema, as tribos Brassolini e Morphini, indicadoras de florestas fechadas/preservadas, mostraram um aumento significativo na mediana da abundância no ano seguinte à mortalidade dos tabocais (@fig-abundancia-resex-cazumba-iracema-combinada). Este resultado é oposto ao esperado, pois com a morte dos tabocais a floresta fica mais aberta e menos propícia às espécies das tribos de floresta fechada. No entanto, a tribo Ageroniini, indicadora de florestas abertas/perturbadas, parece ter respondido à esta perturbação ambiental, visto que o aumento da mediana da abundância foi expressivo, resultando num valor quase 20 vezes maior do que o da mediana geral (@fig-abundancia-resex-cazumba-iracema-combinada). Outra tribo que também pode ter respondido à queda dos tabocais foi Coeini (@fig-abundancia-resex-cazumba-iracema-combinada) que, apesar de não ser uma tribo indicadora, têm espécies que são comuns no dossel e florestas abertas. 

</br>


```{r grafico abundancia-resex-cazumba-iracema}
#| label: fig-abundancia-resex-cazumba-iracema
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '75%'


# Análise  de efeito da queda do tabocal nas tribos de borboletas frugívoras - AUTOMATIZADO
# RESEX do Cazumbá-Iracema
# Script: Isabela Freitas Oliveira

# library(dplyr)
# library(tidyr)
# library(ggplot2)
# library(car)
# 
# #setwd("~/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela")
# 
# dados_borboletas <- read.table("dados/borboletas/dados_analise_borboletas_Isabela_V2.txt", header = TRUE)
# dados_borboletas$ano <- as.factor(dados_borboletas$ano)
# dados_borboletas <- dados_borboletas[dados_borboletas$ano != "2023", ]
# dados_borboletas <- dados_borboletas[!is.na(dados_borboletas$tribo), ]
# 
# 
# dados_regiao_especifica <- dados_borboletas %>%
#   filter(uc == 'Resex_do_Cazumba-Iracema')
# 
# # Calcular o esforço amostral para cada combinação de uc_ea, expedicao e ano
# esforco_por_expedicao <- dados_regiao_especifica %>%
#   group_by(uc_ea, uc, expedicao, ano) %>%
#   summarize(
#     max_dia_amostragem = max(dia_amostragem) - 1,
#     .groups = 'drop'
#   ) %>%
#   mutate(
#     esforco_amostral = 16 * max_dia_amostragem
#   )
# 
# # Agregar o esforço de amostragem para cada uc_ea e ano
# esforco_total_por_ea_ano <- esforco_por_expedicao %>%
#   group_by(uc_ea, ano) %>%
#   summarize(
#     esforco_total_ano = sum(esforco_amostral),
#     .groups = 'drop'
#   )
# 
# # Agregar o esforço de amostragem para cada uc e ano
# esforco_total_por_uc_ano <- esforco_por_expedicao %>%
#   group_by(uc, ano) %>%
#   summarize(
#     esforco_total_ano = sum(esforco_amostral),
#     .groups = 'drop'
#   )
# 
# # Agregação para obter o esforço total por ano
# esforco_por_ano <- esforco_total_por_uc_ano %>%
#   group_by(ano,uc) %>%
#   summarize(
#     esforco = sum(esforco_total_ano),
#     .groups = 'drop'
#   )
# 
# # Agregação para obter o número total de indivíduos por ano
# num_ind_por_ano <- dados_regiao_especifica %>%
#   group_by(ano) %>%
#   summarize(
#     num_ind = sum(individuos, na.rm = TRUE),
#     .groups = 'drop'
#   )
# 
# #criando uma coluna de UA e selecionando somente as colunas interessadas pra analise
# dados_regiao_especifica <- dados_regiao_especifica %>%
#   mutate(ua = paste(uc_ea, transeccao, sep = "_"))
# 
# #combinando os dados por UA por ano = 12 (3 ea x 4 parcelas)
# df_abu_ano <- dados_regiao_especifica %>%
#   group_by(tribo, ua, uc_ea,uc, ano) %>%
#   summarise(abundancia = sum(individuos, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Transforma o df para colocar os zeros
# df_tabocal <- df_abu_ano %>%
#   spread(key = tribo, value = abundancia, fill = 0)
# 
# # Retorna ao formato longo para as análises
# df_long <- df_tabocal %>%
#   pivot_longer(cols = Ageroniini:Satyrini, names_to = "tribo", values_to = "individuos")
# 
# # Agregação para obter a abundância total de cada tribo por ano
# abundancia_por_ano <- df_long %>%
#   group_by(tribo, ano) %>%
#   summarize(
#     abundancia_total = sum(individuos)
#   )
# 
# # Juntar as tabelas pela coluna 'ano' e 'uc'
# df_long_com_esforco <- left_join(df_long, esforco_por_ano, by = c("ano", "uc"))
# 
# 
# # Calcular a abundância padronizada pelo esforço amostral
# df_long <- df_long_com_esforco %>%
#   mutate(abundancia_padronizada = (individuos / esforco) * 100)
# #
# 
# library(tidyverse)
# 
# # Realizar análise e gerar gráficos para cada tribo
# 
# tribos <- unique(df_long$tribo)
# 
# for (tribo_atual in tribos) {
#   cat("Realizando análise e gerando gráfico para a tribo:", tribo_atual, "\n")
#   
#   # Filtrar os dados para a tribo atual
#   df_tribo <- df_long %>%
#     filter(tribo == tribo_atual)
#   
#   # Verificar se há dados para a tribo atual
#   if (nrow(df_tribo) == 0) {
#     cat("Não há dados para a tribo:", tribo_atual, "\n")
#     cat("Nenhuma análise ou gráfico gerado para a tribo:", tribo_atual, "\n")
#     next
#   }
# }
#   
#   # Calcular a mediana anual para cada ano
#   medianas_anuais <- tapply(df_tribo$abundancia_padronizada, df_tribo$ano, median)
#   
#   # Adicione o ano de 2020, mesmo que não haja dados
#   medianas_anuais <- c(medianas_anuais, NA)
#   names(medianas_anuais)[length(medianas_anuais)] <- "2020"
#   
#   # Calcular a mediana geral das medianas anuais
#   mediana_geral_anual <- median(medianas_anuais, na.rm = TRUE)
#   
#   # Remover os anos com NA das medianas anuais
#   medianas_anuais <- medianas_anuais[!is.na(medianas_anuais)]
#   
#   # Crie um vetor para armazenar os resultados dos testes
#   resultados_teste_anual <- numeric(length(medianas_anuais))
#   
#   # Faça um loop pelos anos e realize o teste de Wilcoxon para cada ano
#   for (ano_atual in names(medianas_anuais)) {
#     # Realiza o teste de Wilcoxon comparando as medianas do ano atual com a mediana geral
#     wilcox_test_resultado <- wilcox.test(df_tribo$abundancia_padronizada[df_tribo$ano == ano_atual], mu = mediana_geral_anual, exact = FALSE)
#     
#     # Armazena o valor p do teste no vetor de resultados
#     resultados_teste_anual[ano_atual] <- wilcox_test_resultado$p.value
#   }
#   
#   # Crie um data frame com as medianas anuais, a mediana geral anual e os valores-p
#   df_plot <- data.frame(Ano = as.character(unique(c(names(medianas_anuais), "2020"))), MedianaAnual = c(medianas_anuais, NA))
#   df_plot$MedianaGeral <- mediana_geral_anual
#   df_plot$ValorP <- resultados_teste_anual[match(df_plot$Ano, names(resultados_teste_anual))]
#   
#   # Calcule os erros padrão para cada ano
#   erros_padrao <- sapply(names(medianas_anuais), function(ano) {
#     dados_ano <- df_tribo$abundancia_padronizada[df_tribo$ano == ano]
#     desvio_padrao_ano <- sd(dados_ano, na.rm = TRUE)
#     erro_padrao_ano <- desvio_padrao_ano / sqrt(length(dados_ano))
#     return(erro_padrao_ano)
#   })
#   
#   # Adicione os intervalos de confiança ao data frame
#   df_plot$ErroPadrao <- c(erros_padrao, NA)
#   df_plot$IntervaloConfiancaInf <- pmax(df_plot$MedianaAnual - 1.96 * df_plot$ErroPadrao, 0)
#   df_plot$IntervaloConfiancaSup <- df_plot$MedianaAnual + 1.96 * df_plot$ErroPadrao
#   
#   # Definir os limites do eixo y de acordo com os valores das medianas
#   y_limit <- max(df_plot$IntervaloConfiancaSup)*1.1
#   
#   # Definir a cor de acordo com a tribo
#   cor_tribo <- if (tribo_atual %in% c("Brassolini", "Haeterini", "Morphini")) {
#     "#35978f"
#   } else if (tribo_atual %in% c("Satyrini", "Coeini", "Epiphilini", "Epicaliini", "Anaeini", "Melanitini", "Preponini")) {
#     "gray40"
#   } else {
#     "#bf812d"
#   }
#   
#   # Crie o gráfico ajustado com pontos e linhas
#   p_tribo <- ggplot(df_plot, aes(x = Ano, y = MedianaAnual)) +
#     geom_point(color = cor_tribo, size = .7) +
#     geom_line(size = 0.5, group = 1, color = cor_tribo) +  # Use group = 1 para conectar todos os pontos
#     geom_errorbar(aes(ymin = IntervaloConfiancaInf, ymax = IntervaloConfiancaSup), width = 0.2, color = cor_tribo) +
#     geom_hline(yintercept = mediana_geral_anual, linetype = "dashed", color = "red") +
#     labs(title = paste("", tribo_atual),
#          x = "Ano",
#          y = "Mediana da Abundância / Esforço Amostral") +
#     theme_minimal() +
#     theme(plot.title = element_text(hjust = 0.5, size = 8),
#           axis.title = element_text(size = 5.5),
#           axis.text = element_text(size = 6),
#           axis.line = element_line(color = "black"),
#           axis.ticks.y = element_line(color = "black"),
#           panel.grid.minor = element_blank(),
#           axis.line.x = element_blank(),
#           legend.position = "none") +  # Remover a legenda
#     ylim(0, y_limit) +  # Ajuste os limites conforme necessário
#     geom_text(data = df_plot[df_plot$ValorP < 0.05, ], 
#               aes(x = Ano, y = IntervaloConfiancaSup, label = "*"), 
#               vjust = -0.5,  
#               size = 3)
#   
#   # Exiba o gráfico ajustado
#   print(p_tribo)
#   
#   # Salvar a imagem usando ggsave()
# #   ggsave(filename = paste("mediana_", gsub(" ", "_", tolower(tribo_atual)), "_ajustado_pontos_linha_2020.png", sep = ""),  # Escolha um nome adequado para o arquivo
# #          plot = p_tribo,  # O objeto ggplot
# #          device = "png",  # Pode ser "jpeg", "tiff", etc.
# #          path = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela/Destaque/Cazumba-Iracema",  # Especifique o diretório onde você deseja salvar o gráfico
# #          dpi = 300,  # Define a resolução (DPI)
# #          width = 6, height = 5, units = "in")  # Define o tamanho da imagem
# # }
# 
# 
# library(gridExtra)
# 
# # Definir uma lista para armazenar os gráficos
# lista_graficos <- list()
# 
# # Defina a ordem das tribos
# ordem_tribos <- c("Brassolini", "Morphini", "Haeterini", "Preponini", "Melanitini", "Anaeini", 
#                   "Epicaliini", "Epiphilini", "Coeini", "Satyrini", "Callicorini", "Biblidini", "Ageroniini")
# 
# for (tribo_atual in ordem_tribos) {
#   cat("Realizando análise e gerando gráfico para a tribo:", tribo_atual, "\n")
#   
#   # Filtrar os dados para a tribo atual
#   df_tribo <- df_long %>%
#     filter(tribo == tribo_atual)
#   
#   # Verificar se há dados para a tribo atual
#   if (nrow(df_tribo) == 0) {
#     cat("Não há dados para a tribo:", tribo_atual, "\n")
#     cat("Nenhuma análise ou gráfico gerado para a tribo:", tribo_atual, "\n")
#     next
#   }
#   
#   # Calcular a mediana anual para cada ano
#   medianas_anuais <- tapply(df_tribo$abundancia_padronizada, df_tribo$ano, median)
#   
#   # Adicione o ano de 2020, mesmo que não haja dados
#   medianas_anuais <- c(medianas_anuais, NA)
#   names(medianas_anuais)[length(medianas_anuais)] <- "2020"
#   
#   # Calcular a mediana geral das medianas anuais
#   mediana_geral_anual <- median(medianas_anuais, na.rm = TRUE)
#   
#   # Remover os anos com NA das medianas anuais
#   medianas_anuais <- medianas_anuais[!is.na(medianas_anuais)]
#   
#   # Crie um vetor para armazenar os resultados dos testes
#   resultados_teste_anual <- numeric(length(medianas_anuais))
#   
#   # Faça um loop pelos anos e realize o teste de Wilcoxon para cada ano
#   for (ano_atual in names(medianas_anuais)) {
#     # Realiza o teste de Wilcoxon comparando as medianas do ano atual com a mediana geral
#     wilcox_test_resultado <- wilcox.test(df_tribo$abundancia_padronizada[df_tribo$ano == ano_atual], mu = mediana_geral_anual, exact = FALSE)
#     
#     # Armazena o valor p do teste no vetor de resultados
#     resultados_teste_anual[ano_atual] <- wilcox_test_resultado$p.value
#   }
#   
#   # Crie um data frame com as medianas anuais, a mediana geral anual e os valores-p
#   df_plot <- data.frame(Ano = as.character(unique(c(names(medianas_anuais), "2020"))), MedianaAnual = c(medianas_anuais, NA))
#   df_plot$MedianaGeral <- mediana_geral_anual
#   df_plot$ValorP <- resultados_teste_anual[match(df_plot$Ano, names(resultados_teste_anual))]
#   
#   # Calcule os erros padrão para cada ano
#   erros_padrao <- sapply(names(medianas_anuais), function(ano) {
#     dados_ano <- df_tribo$abundancia_padronizada[df_tribo$ano == ano]
#     desvio_padrao_ano <- sd(dados_ano, na.rm = TRUE)
#     erro_padrao_ano <- desvio_padrao_ano / sqrt(length(dados_ano))
#     return(erro_padrao_ano)
#   })
#   
#   # Adicione os intervalos de confiança ao data frame
#   df_plot$ErroPadrao <- c(erros_padrao, NA)
#   df_plot$IntervaloConfiancaInf <- pmax(df_plot$MedianaAnual - 1.96 * df_plot$ErroPadrao, 0)
#   df_plot$IntervaloConfiancaSup <- df_plot$MedianaAnual + 1.96 * df_plot$ErroPadrao
#   
#   # Definir os limites do eixo y de acordo com os valores das medianas
#   y_limit <- max(df_plot$IntervaloConfiancaSup) * 1.1
#   
#   # Definir a cor de acordo com a tribo
#   cor_tribo <- if (tribo_atual %in% c("Brassolini", "Haeterini", "Morphini")) {
#     "#35978f"
#   } else if (tribo_atual %in% c("Satyrini", "Coeini", "Epiphilini", "Epicaliini", "Anaeini", "Melanitini", "Preponini")) {
#     "gray40"
#   } else {
#     "#bf812d"
#   }
#   
#   # Crie o gráfico ajustado com pontos e linhas
#   p_tribo <- ggplot(df_plot, aes(x = Ano, y = MedianaAnual)) +
#     geom_point(color = cor_tribo, size = 1) +
#     geom_line(size = 0.5, group = 1, color = cor_tribo) +  # Use group = 1 para conectar todos os pontos
#     geom_errorbar(aes(ymin = IntervaloConfiancaInf, ymax = IntervaloConfiancaSup), width = 0.2, color = cor_tribo) +
#     geom_hline(yintercept = mediana_geral_anual, linetype = "dashed", color = "red") +
#     labs(title = paste("", tribo_atual),
#          x = "",
#          y = "Mediana da Abundância 
#  / Esforço Amostral") +
#     theme_minimal() +
#     theme(plot.title = element_text(hjust = 0.5, size = 8),
#           axis.title = element_text(size = 5.5),
#           axis.text = element_text(size = 6),
#           axis.line = element_line(color = "black"),
#           axis.ticks.y = element_line(color = "black"),
#           panel.grid.minor = element_blank(),
#           axis.line.x = element_blank(),
#           legend.position = "none") +  # Remover a legenda
#     ylim(0, y_limit) +  # Ajuste os limites conforme necessário
#     geom_text(data = df_plot[df_plot$ValorP < 0.05, ], 
#               aes(x = Ano, y = IntervaloConfiancaSup, label = "*"), 
#               vjust = -0.5,  
#               size = 3)
#   
#   # Adicionar o gráfico atual à lista
#   lista_graficos[[tribo_atual]] <- p_tribo
# }



```


```{r grafico abundancia-resex-cazumba-iracema-combinada}
#| label: fig-abundancia-resex-cazumba-iracema-combinada
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '90%'
#| fig-cap: "Variação na mediana da abundância das tribos de borboletas frugívoras na RESEX do Cazumbá-Iracema de 2016 a 2022. A linha horizontal pontilhada vermelha indica a mediana geral (soma da mediana de todos os anos dividido pelo número de anos). O asterisco indica que a mediana anual foi significativamente diferente da mediana total, considerando p ≤ 0.01."

# # Combine todos os gráficos em uma única imagem
# imagem_combinada <- grid.arrange(grobs = lista_graficos, ncol = 3)


# Salvar a imagem combinada usando ggsave()
# ggsave(filename = "todos_graficos_cazumba_iracema.png",  # Escolha um nome adequado para o arquivo
#        plot = imagem_combinada,  # O objeto ggplot
#        device = "png",  # Pode ser "jpeg", "tiff", etc.
#        path = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela/Destaque/Cazumba-Iracema",  # Especifique o diretório onde você deseja salvar a imagem
#        dpi = 300,  # Define a resolução (DPI)
#        width = 14, height = 12, units = "in")  # Define o tamanho da imagem


knitr::include_graphics("imagens/cap04/bo-destaque-cazumba.png")

```


</br>


Na RESEX do Alto Tarauacá, as borboletas parecem ter respondido ao impacto da queda das florestas de tabocal no mesmo ano em que ela ocorreu. Grande parte das tribos que tiveram resultados significativamente diferentes da mediana total foi detectada em 2019. As tribos Brassolini, Coeini e Ageroniini apresentaram um aumento em suas abundâncias, enquanto a tribo Anaeini apresentou uma diminuição (@fig-abundancia-resex-alto-tarauaca-combinada). Devido a pandemia, esta UC não coletou os dados em 2020, o que impossibilitou a avaliação do efeito da queda das tabocas nas borboletas após um ano. No entanto, em 2021, algumas tribos apresentaram uma abundância significativamente menor que a mediana geral. Este foi o caso das tribos Brassolini, Preponini, Anaeini e Epicaliini (@fig-abundancia-resex-alto-tarauaca-combinada). 

</br>



```{r grafico abundancia-resex-alto-tarauaca}
#| label: fig-abundancia-resex-alto-tarauaca
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '90%'



# Análise  de efeito da queda do tabocal nas tribos de borboletas frugívoras - AUTOMATIZADO
# RESEX do Alto Taraucá
# Script: Isabela Freitas Oliveira

# library(dplyr)
# library(tidyr)
# library(ggplot2)
# library(car)
# 
# #setwd("~/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela")
# 
# # dados_borboletas <- read.table("dados_analise_borboletas_Isabela_V2.txt", header = TRUE)
# # dados_borboletas$ano <- as.factor(dados_borboletas$ano)
# # dados_borboletas <- dados_borboletas[dados_borboletas$ano != "2023", ]
# # dados_borboletas <- dados_borboletas[!is.na(dados_borboletas$tribo), ]
# 
# 
# dados_regiao_especifica <- dados_borboletas %>%
#   filter(uc == 'Resex_do_Alto_Tarauaca')
# 
# # Calcular o esforço amostral para cada combinação de uc_ea, expedicao e ano
# esforco_por_expedicao <- dados_regiao_especifica %>%
#   group_by(uc_ea, uc, expedicao, ano) %>%
#   summarize(
#     max_dia_amostragem = max(dia_amostragem) - 1,
#     .groups = 'drop'
#   ) %>%
#   mutate(
#     esforco_amostral = 16 * max_dia_amostragem
#   )
# 
# # Agregar o esforço de amostragem para cada uc_ea e ano
# esforco_total_por_ea_ano <- esforco_por_expedicao %>%
#   group_by(uc_ea, ano) %>%
#   summarize(
#     esforco_total_ano = sum(esforco_amostral),
#     .groups = 'drop'
#   )
# 
# # Agregar o esforço de amostragem para cada uc e ano
# esforco_total_por_uc_ano <- esforco_por_expedicao %>%
#   group_by(uc, ano) %>%
#   summarize(
#     esforco_total_ano = sum(esforco_amostral),
#     .groups = 'drop'
#   )
# 
# # Agregação para obter o esforço total por ano
# esforco_por_ano <- esforco_total_por_uc_ano %>%
#   group_by(ano,uc) %>%
#   summarize(
#     esforco = sum(esforco_total_ano),
#     .groups = 'drop'
#   )
# 
# # Agregação para obter o número total de indivíduos por ano
# num_ind_por_ano <- dados_regiao_especifica %>%
#   group_by(ano) %>%
#   summarize(
#     num_ind = sum(individuos, na.rm = TRUE),
#     .groups = 'drop'
#   )
# 
# #criando uma coluna de UA e selecionando somente as colunas interessadas pra analise
# dados_regiao_especifica <- dados_regiao_especifica %>%
#   mutate(ua = paste(uc_ea, transeccao, sep = "_"))
# 
# #combinando os dados por UA por ano = 12 (3 ea x 4 parcelas)
# df_abu_ano <- dados_regiao_especifica %>%
#   group_by(tribo, ua, uc_ea,uc, ano) %>%
#   summarise(abundancia = sum(individuos, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Transforma o df para colocar os zeros
# df_tabocal <- df_abu_ano %>%
#   spread(key = tribo, value = abundancia, fill = 0)
# 
# # Retorna ao formato longo para as análises
# df_long <- df_tabocal %>%
#   pivot_longer(cols = Ageroniini:Satyrini, names_to = "tribo", values_to = "individuos")
# 
# # Agregação para obter a abundância total de cada tribo por ano
# abundancia_por_ano <- df_long %>%
#   group_by(tribo, ano) %>%
#   summarize(
#     abundancia_total = sum(individuos)
#   )
# 
# # Juntar as tabelas pela coluna 'ano' e 'uc'
# df_long_com_esforco <- left_join(df_long, esforco_por_ano, by = c("ano", "uc"))
# 
# 
# # Calcular a abundância padronizada pelo esforço amostral
# df_long <- df_long_com_esforco %>%
#   mutate(abundancia_padronizada = (individuos / esforco) * 100)
# #
# 
# library(tidyverse)
# 
# # Realizar análise e gerar gráficos para cada tribo
# 
# tribos <- unique(df_long$tribo)
# 
# for (tribo_atual in tribos) {
#   cat("Realizando análise e gerando gráfico para a tribo:", tribo_atual, "\n")
#   
#   # Filtrar os dados para a tribo atual
#   df_tribo <- df_long %>%
#     filter(tribo == tribo_atual)
#   
#   # Verificar se há dados para a tribo atual
#   if (nrow(df_tribo) == 0) {
#     cat("Não há dados para a tribo:", tribo_atual, "\n")
#     cat("Nenhuma análise ou gráfico gerado para a tribo:", tribo_atual, "\n")
#     next
#   }
#   
#   # Calcular a mediana anual para cada ano
#   medianas_anuais <- tapply(df_tribo$abundancia_padronizada, df_tribo$ano, median)
#   
#   # Adicione o ano de 2020, mesmo que não haja dados
#   medianas_anuais <- c(medianas_anuais, NA)
#   names(medianas_anuais)[length(medianas_anuais)] <- "2020"
#   
#   # Calcular a mediana geral das medianas anuais
#   mediana_geral_anual <- median(medianas_anuais, na.rm = TRUE)
#   
#   # Remover os anos com NA das medianas anuais
#   medianas_anuais <- medianas_anuais[!is.na(medianas_anuais)]
#   
#   # Crie um vetor para armazenar os resultados dos testes
#   resultados_teste_anual <- numeric(length(medianas_anuais))
#   
#   # Faça um loop pelos anos e realize o teste de Wilcoxon para cada ano
#   for (ano_atual in names(medianas_anuais)) {
#     # Realiza o teste de Wilcoxon comparando as medianas do ano atual com a mediana geral
#     wilcox_test_resultado <- wilcox.test(df_tribo$abundancia_padronizada[df_tribo$ano == ano_atual], mu = mediana_geral_anual, exact = FALSE)
#     
#     # Armazena o valor p do teste no vetor de resultados
#     resultados_teste_anual[ano_atual] <- wilcox_test_resultado$p.value
#   }
#   
#   # Crie um data frame com as medianas anuais, a mediana geral anual e os valores-p
#   df_plot <- data.frame(Ano = as.character(unique(c(names(medianas_anuais), "2020"))), MedianaAnual = c(medianas_anuais, NA))
#   df_plot$MedianaGeral <- mediana_geral_anual
#   df_plot$ValorP <- resultados_teste_anual[match(df_plot$Ano, names(resultados_teste_anual))]
#   
#   # Calcule os erros padrão para cada ano
#   erros_padrao <- sapply(names(medianas_anuais), function(ano) {
#     dados_ano <- df_tribo$abundancia_padronizada[df_tribo$ano == ano]
#     desvio_padrao_ano <- sd(dados_ano, na.rm = TRUE)
#     erro_padrao_ano <- desvio_padrao_ano / sqrt(length(dados_ano))
#     return(erro_padrao_ano)
#   })
#   
#   # Adicione os intervalos de confiança ao data frame
#   df_plot$ErroPadrao <- c(erros_padrao, NA)
#   df_plot$IntervaloConfiancaInf <- pmax(df_plot$MedianaAnual - 1.96 * df_plot$ErroPadrao, 0)
#   df_plot$IntervaloConfiancaSup <- df_plot$MedianaAnual + 1.96 * df_plot$ErroPadrao
#   
#   # Definir os limites do eixo y de acordo com os valores das medianas
#   y_limit <- max(df_plot$IntervaloConfiancaSup)*1.2
#   
#   # Definir a cor de acordo com a tribo
#   cor_tribo <- if (tribo_atual %in% c("Brassolini", "Haeterini", "Morphini")) {
#     "#35978f"
#   } else if (tribo_atual %in% c("Satyrini", "Coeini", "Epiphilini", "Epicaliini", "Anaeini", "Melanitini", "Preponini")) {
#     "gray40"
#   } else {
#     "#bf812d"
#   }
#   
#   # Crie o gráfico ajustado com pontos e linhas
#   p_tribo <- ggplot(df_plot, aes(x = Ano, y = MedianaAnual)) +
#     geom_point(color = cor_tribo, size = 1) +
#     geom_line(size = 0.5, group = 1, color = cor_tribo) +  # Use group = 1 para conectar todos os pontos
#     geom_errorbar(aes(ymin = IntervaloConfiancaInf, ymax = IntervaloConfiancaSup), width = 0.2, color = cor_tribo) +
#     geom_hline(yintercept = mediana_geral_anual, linetype = "dashed", color = "red") +
#     labs(title = paste("", tribo_atual),
#          x = "Ano",
#          y = "Mediana da Abundância / Esforço Amostral") +
#     theme_minimal() +
#     theme_minimal() +
#     theme(plot.title = element_text(hjust = 0.5, size = 8),
#           axis.title = element_text(size = 5),
#           axis.text = element_text(size = 5),
#           axis.line = element_line(color = "black"),
#           axis.ticks.y = element_line(color = "black"),
#           panel.grid.minor = element_blank(),
#           axis.line.x = element_blank(),
#           legend.position = "none") +  # Remover a legenda
#     ylim(0, y_limit) +  # Ajuste os limites conforme necessário
#     geom_text(data = df_plot[df_plot$ValorP < 0.05, ], 
#               aes(x = Ano, y = IntervaloConfiancaSup, label = "*"), 
#               vjust = -0.5,  
#               size = 3)
#   
#   # Exiba o gráfico ajustado
#   print(p_tribo)
#   
#   # Salvar a imagem usando ggsave()
#   ggsave(filename = paste("mediana_", gsub(" ", "_", tolower(tribo_atual)), "_ajustado_pontos_linha_2020.png", sep = ""),  # Escolha um nome adequado para o arquivo
#          plot = p_tribo,  # O objeto ggplot
#          device = "png",  # Pode ser "jpeg", "tiff", etc.
#          path = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela/Destaque/Alto Tarauaca",  # Especifique o diretório onde você deseja salvar o gráfico
#          dpi = 300,  # Define a resolução (DPI)
#          width = 6, height = 5, units = "in")  # Define o tamanho da imagem
# }
# 
# 
# library(gridExtra)
# 
# # Definir uma lista para armazenar os gráficos
# lista_graficos <- list()
# 
# # Defina a ordem das tribos
# ordem_tribos <- c("Brassolini", "Morphini", "Haeterini", "Preponini", "Melanitini", "Anaeini", 
#                   "Epicaliini", "Epiphilini", "Coeini", "Satyrini", "Callicorini", "Biblidini", "Ageroniini")
# 
# for (tribo_atual in ordem_tribos) {
#   cat("Realizando análise e gerando gráfico para a tribo:", tribo_atual, "\n")
#   
#   # Filtrar os dados para a tribo atual
#   df_tribo <- df_long %>%
#     filter(tribo == tribo_atual)
#   
#   # Verificar se há dados para a tribo atual
#   if (nrow(df_tribo) == 0) {
#     cat("Não há dados para a tribo:", tribo_atual, "\n")
#     cat("Nenhuma análise ou gráfico gerado para a tribo:", tribo_atual, "\n")
#     next
#   }
#   
#   # Calcular a mediana anual para cada ano
#   medianas_anuais <- tapply(df_tribo$abundancia_padronizada, df_tribo$ano, median)
#   
#   # Adicione o ano de 2020, mesmo que não haja dados
#   medianas_anuais <- c(medianas_anuais, NA)
#   names(medianas_anuais)[length(medianas_anuais)] <- "2020"
#   
#   # Calcular a mediana geral das medianas anuais
#   mediana_geral_anual <- median(medianas_anuais, na.rm = TRUE)
#   
#   # Remover os anos com NA das medianas anuais
#   medianas_anuais <- medianas_anuais[!is.na(medianas_anuais)]
#   
#   # Crie um vetor para armazenar os resultados dos testes
#   resultados_teste_anual <- numeric(length(medianas_anuais))
#   
#   # Faça um loop pelos anos e realize o teste de Wilcoxon para cada ano
#   for (ano_atual in names(medianas_anuais)) {
#     # Realiza o teste de Wilcoxon comparando as medianas do ano atual com a mediana geral
#     wilcox_test_resultado <- wilcox.test(df_tribo$abundancia_padronizada[df_tribo$ano == ano_atual], mu = mediana_geral_anual, exact = FALSE)
#     
#     # Armazena o valor p do teste no vetor de resultados
#     resultados_teste_anual[ano_atual] <- wilcox_test_resultado$p.value
#   }
#   
#   # Crie um data frame com as medianas anuais, a mediana geral anual e os valores-p
#   df_plot <- data.frame(Ano = as.character(unique(c(names(medianas_anuais), "2020"))), MedianaAnual = c(medianas_anuais, NA))
#   df_plot$MedianaGeral <- mediana_geral_anual
#   df_plot$ValorP <- resultados_teste_anual[match(df_plot$Ano, names(resultados_teste_anual))]
#   
#   # Calcule os erros padrão para cada ano
#   erros_padrao <- sapply(names(medianas_anuais), function(ano) {
#     dados_ano <- df_tribo$abundancia_padronizada[df_tribo$ano == ano]
#     desvio_padrao_ano <- sd(dados_ano, na.rm = TRUE)
#     erro_padrao_ano <- desvio_padrao_ano / sqrt(length(dados_ano))
#     return(erro_padrao_ano)
#   })
#   
#   # Adicione os intervalos de confiança ao data frame
#   df_plot$ErroPadrao <- c(erros_padrao, NA)
#   df_plot$IntervaloConfiancaInf <- pmax(df_plot$MedianaAnual - 1.96 * df_plot$ErroPadrao, 0)
#   df_plot$IntervaloConfiancaSup <- df_plot$MedianaAnual + 1.96 * df_plot$ErroPadrao
#   
#   # Definir os limites do eixo y de acordo com os valores das medianas
#   y_limit <- max(df_plot$IntervaloConfiancaSup) * 1.2
#   
#   # Definir a cor de acordo com a tribo
#   cor_tribo <- if (tribo_atual %in% c("Brassolini", "Haeterini", "Morphini")) {
#     "#35978f"
#   } else if (tribo_atual %in% c("Satyrini", "Coeini", "Epiphilini", "Epicaliini", "Anaeini", "Melanitini", "Preponini")) {
#     "gray40"
#   } else {
#     "#bf812d"
#   }
#   
#   # Crie o gráfico ajustado com pontos e linhas
#   p_tribo <- ggplot(df_plot, aes(x = Ano, y = MedianaAnual)) +
#     geom_point(color = cor_tribo, size = 1) +
#     geom_line(size = 0.5, group = 1, color = cor_tribo) +  # Use group = 1 para conectar todos os pontos
#     geom_errorbar(aes(ymin = IntervaloConfiancaInf, ymax = IntervaloConfiancaSup), width = 0.2, color = cor_tribo) +
#     geom_hline(yintercept = mediana_geral_anual, linetype = "dashed", color = "red") +
#     labs(title = paste("", tribo_atual),
#          x = "",
#          y = "Mediana da Abundância 
#  / Esforço Amostral") +
#     theme_minimal() +
#     theme(plot.title = element_text(hjust = 0.5, size = 8),
#           axis.title = element_text(size = 5),
#           axis.text = element_text(size = 5),
#           axis.line = element_line(color = "black"),
#           axis.ticks.y = element_line(color = "black"),
#           panel.grid.minor = element_blank(),
#           axis.line.x = element_blank(),
#           legend.position = "none") +  # Remover a legenda
#     ylim(0, y_limit) +  # Ajuste os limites conforme necessário
#     geom_text(data = df_plot[df_plot$ValorP < 0.05, ], 
#               aes(x = Ano, y = IntervaloConfiancaSup, label = "*"), 
#               vjust = -0.5,  
#               size = 3)
#   
#   # Adicionar o gráfico atual à lista
#   lista_graficos[[tribo_atual]] <- p_tribo
# }


```

</br>


```{r grafico abundancia-resex-alto-tarauca-combinada}
#| label: fig-abundancia-resex-alto-tarauaca-combinada
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '90%'
#| fig-cap: "Variação na mediana da abundância das tribos de borboletas frugívoras na RESEX do Alto Tarauacá de 2017 a 2022. A linha pontilhada vermelha indica a mediana geral (soma da mediana de todos os anos dividido pelo número de anos). O asterisco indica que a mediana anual foi significativamente diferente da mediana total, considerando p ≤ 0.01."

# # Combine todos os gráficos em uma única imagem
# imagem_combinada <- grid.arrange(grobs = lista_graficos, ncol = 3)

# Salvar a imagem combinada usando ggsave()
# ggsave(filename = "todos_graficos_alto_tarauaca.png",  # Escolha um nome adequado para o arquivo
#        plot = imagem_combinada,  # O objeto ggplot
#        device = "png",  # Pode ser "jpeg", "tiff", etc.
#        path = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela/Destaque/Alto Tarauaca",  # Especifique o diretório onde você deseja salvar a imagem
#        dpi = 300,  # Define a resolução (DPI)
#        width = 14, height = 12, units = "in")  # Define o tamanho da imagem


knitr::include_graphics("imagens/cap04/bo-destaque-alto-tarauaca.png")


```

</br>


Em 2018, a RESEX Chico Mendes sofreu quedas de florestas de taboca, mas essa perturbação não pareceu afetar a abundância das tribos de borboletas naquele ano. No entanto, no ano seguinte, foi observada uma redução significativa da abundância da tribo Satyrini (@fig-abundancia-resex-chico-mendes-combinada).  

Apesar dos resultados não apresentarem significância, há um padrão de diminuição da mediana da abundância de borboletas de 2018 para 2019. Com exceção das tribos Epiphilini e Anaeini, todas as outras apresentaram uma diminuição nas abundâncias (@fig-abundancia-resex-chico-mendes-combinada). Este é um resultado interessante, pois em 2019, diversas tribos de borboletas tiveram aumento na sua abundância em outras UCs da região Sudoeste da Amazônia (e.g., RESEX do Cazumbá-Iracema, RESEX do Alto do Tarauacá). 

 

```{r grafico abundancia-resex-chico-mendes}
#| label: fig-abundancia-resex-chico-mendes
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'



# Análise  de efeito da queda do tabocal nas tribos de borboletas frugívoras - AUTOMATIZADO
# RESEX Chico Mendes
# Script: Isabela Freitas Oliveira

# library(dplyr)
# library(tidyr)
# library(ggplot2)
# library(car)
# 
# # setwd("~/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela")
# # 
# # dados_borboletas <- read.table("dados_analise_borboletas_Isabela_V2.txt", header = TRUE)
# # dados_borboletas$ano <- as.factor(dados_borboletas$ano)
# # dados_borboletas <- dados_borboletas[dados_borboletas$ano != "2023", ]
# # dados_borboletas <- dados_borboletas[!is.na(dados_borboletas$tribo), ]
# 
# 
# dados_regiao_especifica <- dados_borboletas %>%
#   filter(uc == 'Resex_Chico_Mendes')
# 
# # Calcular o esforço amostral para cada combinação de uc_ea, expedicao e ano
# esforco_por_expedicao <- dados_regiao_especifica %>%
#   group_by(uc_ea, uc, expedicao, ano) %>%
#   summarize(
#     max_dia_amostragem = max(dia_amostragem) - 1,
#     .groups = 'drop'
#   ) %>%
#   mutate(
#     esforco_amostral = 16 * max_dia_amostragem
#   )
# 
# # Agregar o esforço de amostragem para cada uc_ea e ano
# esforco_total_por_ea_ano <- esforco_por_expedicao %>%
#   group_by(uc_ea, ano) %>%
#   summarize(
#     esforco_total_ano = sum(esforco_amostral),
#     .groups = 'drop'
#   )
# 
# # Agregar o esforço de amostragem para cada uc e ano
# esforco_total_por_uc_ano <- esforco_por_expedicao %>%
#   group_by(uc, ano) %>%
#   summarize(
#     esforco_total_ano = sum(esforco_amostral),
#     .groups = 'drop'
#   )
# 
# # Agregação para obter o esforço total por ano
# esforco_por_ano <- esforco_total_por_uc_ano %>%
#   group_by(ano,uc) %>%
#   summarize(
#     esforco = sum(esforco_total_ano),
#     .groups = 'drop'
#   )
# 
# # Agregação para obter o número total de indivíduos por ano
# num_ind_por_ano <- dados_regiao_especifica %>%
#   group_by(ano) %>%
#   summarize(
#     num_ind = sum(individuos, na.rm = TRUE),
#     .groups = 'drop'
#   )
# 
# #criando uma coluna de UA e selecionando somente as colunas interessadas pra analise
# dados_regiao_especifica <- dados_regiao_especifica %>%
#   mutate(ua = paste(uc_ea, transeccao, sep = "_"))
# 
# #combinando os dados por UA por ano = 12 (3 ea x 4 parcelas)
# df_abu_ano <- dados_regiao_especifica %>%
#   group_by(tribo, ua, uc_ea,uc, ano) %>%
#   summarise(abundancia = sum(individuos, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Transforma o df para colocar os zeros
# df_tabocal <- df_abu_ano %>%
#   spread(key = tribo, value = abundancia, fill = 0)
# 
# # Retorna ao formato longo para as análises
# df_long <- df_tabocal %>%
#   pivot_longer(cols = Ageroniini:Satyrini, names_to = "tribo", values_to = "individuos")
# 
# # Agregação para obter a abundância total de cada tribo por ano
# abundancia_por_ano <- df_long %>%
#   group_by(tribo, ano) %>%
#   summarize(
#     abundancia_total = sum(individuos)
#   )
# 
# # Juntar as tabelas pela coluna 'ano' e 'uc'
# df_long_com_esforco <- left_join(df_long, esforco_por_ano, by = c("ano", "uc"))
# 
# 
# # Calcular a abundância padronizada pelo esforço amostral
# df_long <- df_long_com_esforco %>%
#   mutate(abundancia_padronizada = (individuos / esforco) * 100)
# #
# 
# library(tidyverse)
# 
# # Realizar análise e gerar gráficos para cada tribo
# 
# tribos <- unique(df_long$tribo)
# 
# for (tribo_atual in tribos) {
#   cat("Realizando análise e gerando gráfico para a tribo:", tribo_atual, "\n")
#   
#   # Filtrar os dados para a tribo atual
#   df_tribo <- df_long %>%
#     filter(tribo == tribo_atual)
#   
#   # Verificar se há dados para a tribo atual
#   if (nrow(df_tribo) == 0) {
#     cat("Não há dados para a tribo:", tribo_atual, "\n")
#     cat("Nenhuma análise ou gráfico gerado para a tribo:", tribo_atual, "\n")
#     next
#   }
#   
#   # Calcular a mediana anual para cada ano
#   medianas_anuais <- tapply(df_tribo$abundancia_padronizada, df_tribo$ano, median)
#   
#   # Calcular a mediana geral das medianas anuais
#   mediana_geral_anual <- median(medianas_anuais, na.rm = TRUE)
#   
#   # Remover os anos com NA das medianas anuais
#   medianas_anuais <- medianas_anuais[!is.na(medianas_anuais)]
#   
#   # Crie um vetor para armazenar os resultados dos testes
#   resultados_teste_anual <- numeric(length(medianas_anuais))
#   
#   # Faça um loop pelos anos e realize o teste de Wilcoxon para cada ano
#   for (ano_atual in names(medianas_anuais)) {
#     # Realiza o teste de Wilcoxon comparando as medianas do ano atual com a mediana geral
#     wilcox_test_resultado <- wilcox.test(df_tribo$abundancia_padronizada[df_tribo$ano == ano_atual], mu = mediana_geral_anual, exact = FALSE)
#     
#     # Armazena o valor p do teste no vetor de resultados
#     resultados_teste_anual[ano_atual] <- wilcox_test_resultado$p.value
#   }
#   
#   # Crie um data frame com as medianas anuais, a mediana geral anual e os valores-p
#   df_plot <- data.frame(Ano = names(medianas_anuais), MedianaAnual = medianas_anuais)
#   df_plot$MedianaGeral <- mediana_geral_anual
#   df_plot$ValorP <- resultados_teste_anual[match(df_plot$Ano, names(resultados_teste_anual))]
#   
#   # Calcule os erros padrão para cada ano
#   erros_padrao <- sapply(names(medianas_anuais), function(ano) {
#     dados_ano <- df_tribo$abundancia_padronizada[df_tribo$ano == ano]
#     desvio_padrao_ano <- sd(dados_ano, na.rm = TRUE)
#     erro_padrao_ano <- desvio_padrao_ano / sqrt(length(dados_ano))
#     return(erro_padrao_ano)
#   })
#   
#   # Adicione os intervalos de confiança ao data frame
#   df_plot$ErroPadrao <- erros_padrao
#   df_plot$IntervaloConfiancaInf <- pmax(df_plot$MedianaAnual - 1.96 * df_plot$ErroPadrao, 0)
#   df_plot$IntervaloConfiancaSup <- df_plot$MedianaAnual + 1.96 * df_plot$ErroPadrao
#   
#   # Definir os limites do eixo y de acordo com os valores das medianas
#   y_limit <- max(df_plot$IntervaloConfiancaSup)*1.1
#   
#   # Definir a cor de acordo com a tribo
#   cor_tribo <- if (tribo_atual %in% c("Brassolini", "Haeterini", "Morphini")) {
#     "#35978f"
#   } else if (tribo_atual %in% c("Satyrini", "Coeini", "Epiphilini", "Epicaliini", "Anaeini", "Melanitini", "Preponini")) {
#     "gray40"
#   } else {
#     "#bf812d"
#   }
#   
#   # Crie o gráfico ajustado com pontos e linhas
#   p_tribo <- ggplot(df_plot, aes(x = Ano, y = MedianaAnual)) +
#     geom_point(color = cor_tribo, size = 1) +
#     geom_line(size = 0.5, group = 1, color = cor_tribo) +  # Use group = 1 para conectar todos os pontos
#     geom_errorbar(aes(ymin = IntervaloConfiancaInf, ymax = IntervaloConfiancaSup), width = 0.2, color = cor_tribo) +
#     geom_hline(yintercept = mediana_geral_anual, linetype = "dashed", color = "red") +
#     labs(title = paste("", tribo_atual),
#          x = "Ano",
#          y = "Mediana da Abundância / Esforço Amostral") +
#     theme_minimal() +
#      theme_minimal() +
#     theme(plot.title = element_text(hjust = 0.5, size = 8),
#           axis.title = element_text(size = 5),
#           axis.text = element_text(size = 5),
#           axis.line = element_line(color = "black"),
#           axis.ticks.y = element_line(color = "black"),
#           panel.grid.minor = element_blank(),
#           axis.line.x = element_blank(),
#           legend.position = "none") +  # Remover a legenda
#     ylim(0, y_limit) +  # Ajuste os limites conforme necessário
#     geom_text(data = df_plot[df_plot$ValorP < 0.05, ], 
#               aes(x = Ano, y = IntervaloConfiancaSup, label = "*"), 
#               vjust = -0.5,  
#               size = 3)
#   
#   # Exiba o gráfico ajustado
#   print(p_tribo)
#   
#   # Salvar a imagem usando ggsave()
#   ggsave(filename = paste("mediana_", gsub(" ", "_", tolower(tribo_atual)), "_ajustado_pontos_linha_2020.png", sep = ""),  # Escolha um nome adequado para o arquivo
#          plot = p_tribo,  # O objeto ggplot
#          device = "png",  # Pode ser "jpeg", "tiff", etc.
#          path = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela/Destaque/Chico Mendes",  # Especifique o diretório onde você deseja salvar o gráfico
#          dpi = 300,  # Define a resolução (DPI)
#          width = 6, height = 5, units = "in")  # Define o tamanho da imagem
# }
# 
# 
# library(gridExtra)
# 
# # Definir uma lista para armazenar os gráficos
# lista_graficos <- list()
# 
# # Defina a ordem das tribos
# ordem_tribos <- c("Brassolini", "Morphini", "Haeterini", "Preponini", "Melanitini", "Anaeini", 
#                   "Epicaliini", "Epiphilini", "Coeini", "Satyrini", "Callicorini", "Biblidini", "Ageroniini")
# 
# for (tribo_atual in ordem_tribos) {
#   cat("Realizando análise e gerando gráfico para a tribo:", tribo_atual, "\n")
#   
#   # Filtrar os dados para a tribo atual
#   df_tribo <- df_long %>%
#     filter(tribo == tribo_atual)
#   
#   # Verificar se há dados para a tribo atual
#   if (nrow(df_tribo) == 0) {
#     cat("Não há dados para a tribo:", tribo_atual, "\n")
#     cat("Nenhuma análise ou gráfico gerado para a tribo:", tribo_atual, "\n")
#     next
#   }
#   
#   # Calcular a mediana anual para cada ano
#   medianas_anuais <- tapply(df_tribo$abundancia_padronizada, df_tribo$ano, median)
#   
#   # Calcular a mediana geral das medianas anuais
#   mediana_geral_anual <- median(medianas_anuais, na.rm = TRUE)
#   
#   # Remover os anos com NA das medianas anuais
#   medianas_anuais <- medianas_anuais[!is.na(medianas_anuais)]
#   
#   # Crie um vetor para armazenar os resultados dos testes
#   resultados_teste_anual <- numeric(length(medianas_anuais))
#   
#   # Faça um loop pelos anos e realize o teste de Wilcoxon para cada ano
#   for (ano_atual in names(medianas_anuais)) {
#     # Realiza o teste de Wilcoxon comparando as medianas do ano atual com a mediana geral
#     wilcox_test_resultado <- wilcox.test(df_tribo$abundancia_padronizada[df_tribo$ano == ano_atual], mu = mediana_geral_anual, exact = FALSE)
#     
#     # Armazena o valor p do teste no vetor de resultados
#     resultados_teste_anual[ano_atual] <- wilcox_test_resultado$p.value
#   }
#   
#   # Crie um data frame com as medianas anuais, a mediana geral anual e os valores-p
#   df_plot <- data.frame(Ano = names(medianas_anuais), MedianaAnual = medianas_anuais)
#   df_plot$MedianaGeral <- mediana_geral_anual
#   df_plot$ValorP <- resultados_teste_anual[match(df_plot$Ano, names(resultados_teste_anual))]
#   
#   # Calcule os erros padrão para cada ano
#   erros_padrao <- sapply(names(medianas_anuais), function(ano) {
#     dados_ano <- df_tribo$abundancia_padronizada[df_tribo$ano == ano]
#     desvio_padrao_ano <- sd(dados_ano, na.rm = TRUE)
#     erro_padrao_ano <- desvio_padrao_ano / sqrt(length(dados_ano))
#     return(erro_padrao_ano)
#   })
#   
#   # Adicione os intervalos de confiança ao data frame
#   df_plot$ErroPadrao <- erros_padrao
#   df_plot$IntervaloConfiancaInf <- pmax(df_plot$MedianaAnual - 1.96 * df_plot$ErroPadrao, 0)
#   df_plot$IntervaloConfiancaSup <- df_plot$MedianaAnual + 1.96 * df_plot$ErroPadrao
#   
#   # Definir os limites do eixo y de acordo com os valores das medianas
#   y_limit <- max(df_plot$IntervaloConfiancaSup) * 1.1
#   
#   # Definir a cor de acordo com a tribo
#   cor_tribo <- if (tribo_atual %in% c("Brassolini", "Haeterini", "Morphini")) {
#     "#35978f"
#   } else if (tribo_atual %in% c("Satyrini", "Coeini", "Epiphilini", "Epicaliini", "Anaeini", "Melanitini", "Preponini")) {
#     "gray40"
#   } else {
#     "#bf812d"
#   }
#   
#   # Crie o gráfico ajustado com pontos e linhas
#   p_tribo <- ggplot(df_plot, aes(x = Ano, y = MedianaAnual)) +
#     geom_point(color = cor_tribo, size = 1) +
#     geom_line(size = 0.5, group = 1, color = cor_tribo) +  # Use group = 1 para conectar todos os pontos
#     geom_errorbar(aes(ymin = IntervaloConfiancaInf, ymax = IntervaloConfiancaSup), width = 0.2, color = cor_tribo) +
#     geom_hline(yintercept = mediana_geral_anual, linetype = "dashed", color = "red") +
#     labs(title = paste("", tribo_atual),
#          x = "",
#          y = "Mediana da Abundância 
#  / Esforço Amostral") +
#     theme_minimal() +
#      theme_minimal() +
#     theme(plot.title = element_text(hjust = 0.5, size = 8),
#           axis.title = element_text(size = 5),
#           axis.text = element_text(size = 5),
#           axis.line = element_line(color = "black"),
#           axis.ticks.y = element_line(color = "black"),
#           panel.grid.minor = element_blank(),
#           axis.line.x = element_blank(),
#           legend.position = "none") +  # Remover a legenda
#     ylim(0, y_limit) +  # Ajuste os limites conforme necessário
#     geom_text(data = df_plot[df_plot$ValorP < 0.05, ], 
#               aes(x = Ano, y = IntervaloConfiancaSup, label = "*"), 
#               vjust = -0.5,  
#               size = 3)
#   
#   # Adicionar o gráfico atual à lista
#   lista_graficos[[tribo_atual]] <- p_tribo
# }


```

</br>


```{r grafico abundancia-resex-chico-mendes-combinada}
#| label: fig-abundancia-resex-chico-mendes-combinada
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '90%'
#| fig-cap: "Variação na mediana da abundância das tribos de borboletas frugívoras na RESEX Chico Mendes em 2018 e 2019. A linha pontilhada vermelha indica a mediana geral (soma da mediana de todos os anos dividido pelo número de anos). O asterisco indica que a mediana anual foi significativamente diferente da mediana total, considerando p ≤ 0.01."

# # Combine todos os gráficos em uma única imagem
# imagem_combinada <- grid.arrange(grobs = lista_graficos, ncol = 3)

# Salvar a imagem combinada usando ggsave()
# ggsave(filename = "todos_graficos_chico_mendes.png",  # Escolha um nome adequado para o arquivo
#        plot = imagem_combinada,  # O objeto ggplot
#        device = "png",  # Pode ser "jpeg", "tiff", etc.
#        path = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela/Destaque/Chico Mendes",  # Especifique o diretório onde você deseja salvar a imagem
#        dpi = 300,  # Define a resolução (DPI)
#        width = 14, height = 12, units = "in")  # Define o tamanho da imagem


knitr::include_graphics("imagens/cap04/bo-destaque-chico-mendes.png")

```

</br>

Na RESEX Riozinho da Liberdade houve quedas das florestas de taboca em 2021, mas esta perturbação parece não ter influenciado significativamente as tribos de borboletas. No entanto, a tribo Morphini apresentou uma diminuição significativa da sua abundância em 2022 (@fig-abundancia-resex-riozinho-da-liberdade-combinada). 

</br>



```{r grafico abundancia-resex-riozinho-da-liberdade}
#| label: fig-abundancia-resex-riozinho-da-liberdade
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'



# Análise  de efeito da queda do tabocal nas tribos de borboletas frugívoras - AUTOMATIZADO
# RESEX Riozinho da Liberdade
# Script: Isabela Freitas Oliveira

# library(dplyr)
# library(tidyr)
# library(ggplot2)
# library(car)
# 
# # setwd("~/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela")
# # 
# # dados_borboletas <- read.table("dados_analise_borboletas_Isabela_V2.txt", header = TRUE)
# # dados_borboletas$ano <- as.factor(dados_borboletas$ano)
# # dados_borboletas <- dados_borboletas[dados_borboletas$ano != "2023", ]
# # dados_borboletas <- dados_borboletas[!is.na(dados_borboletas$tribo), ]
# 
# 
# dados_regiao_especifica <- dados_borboletas %>%
#   filter(uc == 'Resex_Riozinho_da_Liberdade')
# 
# # Calcular o esforço amostral para cada combinação de uc_ea, expedicao e ano
# esforco_por_expedicao <- dados_regiao_especifica %>%
#   group_by(uc_ea, uc, expedicao, ano) %>%
#   summarize(
#     max_dia_amostragem = max(dia_amostragem) - 1,
#     .groups = 'drop'
#   ) %>%
#   mutate(
#     esforco_amostral = 16 * max_dia_amostragem
#   )
# 
# # Agregar o esforço de amostragem para cada uc_ea e ano
# esforco_total_por_ea_ano <- esforco_por_expedicao %>%
#   group_by(uc_ea, ano) %>%
#   summarize(
#     esforco_total_ano = sum(esforco_amostral),
#     .groups = 'drop'
#   )
# 
# # Agregar o esforço de amostragem para cada uc e ano
# esforco_total_por_uc_ano <- esforco_por_expedicao %>%
#   group_by(uc, ano) %>%
#   summarize(
#     esforco_total_ano = sum(esforco_amostral),
#     .groups = 'drop'
#   )
# 
# # Agregação para obter o esforço total por ano
# esforco_por_ano <- esforco_total_por_uc_ano %>%
#   group_by(ano,uc) %>%
#   summarize(
#     esforco = sum(esforco_total_ano),
#     .groups = 'drop'
#   )
# 
# # Agregação para obter o número total de indivíduos por ano
# num_ind_por_ano <- dados_regiao_especifica %>%
#   group_by(ano) %>%
#   summarize(
#     num_ind = sum(individuos, na.rm = TRUE),
#     .groups = 'drop'
#   )
# 
# #criando uma coluna de UA e selecionando somente as colunas interessadas pra analise
# dados_regiao_especifica <- dados_regiao_especifica %>%
#   mutate(ua = paste(uc_ea, transeccao, sep = "_"))
# 
# #combinando os dados por UA por ano = 12 (3 ea x 4 parcelas)
# df_abu_ano <- dados_regiao_especifica %>%
#   group_by(tribo, ua, uc_ea,uc, ano) %>%
#   summarise(abundancia = sum(individuos, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Transforma o df para colocar os zeros
# df_tabocal <- df_abu_ano %>%
#   spread(key = tribo, value = abundancia, fill = 0)
# 
# # Retorna ao formato longo para as análises
# df_long <- df_tabocal %>%
#   pivot_longer(cols = Ageroniini:Satyrini, names_to = "tribo", values_to = "individuos")
# 
# # Agregação para obter a abundância total de cada tribo por ano
# abundancia_por_ano <- df_long %>%
#   group_by(tribo, ano) %>%
#   summarize(
#     abundancia_total = sum(individuos)
#   )
# 
# # Juntar as tabelas pela coluna 'ano' e 'uc'
# df_long_com_esforco <- left_join(df_long, esforco_por_ano, by = c("ano", "uc"))
# 
# 
# # Calcular a abundância padronizada pelo esforço amostral
# df_long <- df_long_com_esforco %>%
#   mutate(abundancia_padronizada = (individuos / esforco) * 100)
# #
# 
# library(tidyverse)
# 
# # Realizar análise e gerar gráficos para cada tribo
# 
# tribos <- unique(df_long$tribo)
# 
# for (tribo_atual in tribos) {
#   cat("Realizando análise e gerando gráfico para a tribo:", tribo_atual, "\n")
#   
#   # Filtrar os dados para a tribo atual
#   df_tribo <- df_long %>%
#     filter(tribo == tribo_atual)
#   
#   # Verificar se há dados para a tribo atual
#   if (nrow(df_tribo) == 0) {
#     cat("Não há dados para a tribo:", tribo_atual, "\n")
#     cat("Nenhuma análise ou gráfico gerado para a tribo:", tribo_atual, "\n")
#     next
#   }
#   
#   # Calcular a mediana anual para cada ano
#   medianas_anuais <- tapply(df_tribo$abundancia_padronizada, df_tribo$ano, median)
#   
#   # Calcular a mediana geral das medianas anuais
#   mediana_geral_anual <- median(medianas_anuais, na.rm = TRUE)
#   
#   # Remover os anos com NA das medianas anuais
#   medianas_anuais <- medianas_anuais[!is.na(medianas_anuais)]
#   
#   # Crie um vetor para armazenar os resultados dos testes
#   resultados_teste_anual <- numeric(length(medianas_anuais))
#   
#   # Faça um loop pelos anos e realize o teste de Wilcoxon para cada ano
#   for (ano_atual in names(medianas_anuais)) {
#     # Realiza o teste de Wilcoxon comparando as medianas do ano atual com a mediana geral
#     wilcox_test_resultado <- wilcox.test(df_tribo$abundancia_padronizada[df_tribo$ano == ano_atual], mu = mediana_geral_anual, exact = FALSE)
#     
#     # Armazena o valor p do teste no vetor de resultados
#     resultados_teste_anual[ano_atual] <- wilcox_test_resultado$p.value
#   }
#   
#   # Crie um data frame com as medianas anuais, a mediana geral anual e os valores-p
#   df_plot <- data.frame(Ano = names(medianas_anuais), MedianaAnual = medianas_anuais)
#   df_plot$MedianaGeral <- mediana_geral_anual
#   df_plot$ValorP <- resultados_teste_anual[match(df_plot$Ano, names(resultados_teste_anual))]
#   
#   # Calcule os erros padrão para cada ano
#   erros_padrao <- sapply(names(medianas_anuais), function(ano) {
#     dados_ano <- df_tribo$abundancia_padronizada[df_tribo$ano == ano]
#     desvio_padrao_ano <- sd(dados_ano, na.rm = TRUE)
#     erro_padrao_ano <- desvio_padrao_ano / sqrt(length(dados_ano))
#     return(erro_padrao_ano)
#   })
#   
#   # Adicione os intervalos de confiança ao data frame
#   df_plot$ErroPadrao <- erros_padrao
#   df_plot$IntervaloConfiancaInf <- pmax(df_plot$MedianaAnual - 1.96 * df_plot$ErroPadrao, 0)
#   df_plot$IntervaloConfiancaSup <- df_plot$MedianaAnual + 1.96 * df_plot$ErroPadrao
#   
#   # Definir os limites do eixo y de acordo com os valores das medianas
#   y_limit <- max(df_plot$IntervaloConfiancaSup)*1.1
#   
#   # Definir a cor de acordo com a tribo
#   cor_tribo <- if (tribo_atual %in% c("Brassolini", "Haeterini", "Morphini")) {
#     "#35978f"
#   } else if (tribo_atual %in% c("Satyrini", "Coeini", "Epiphilini", "Epicaliini", "Anaeini", "Melanitini", "Preponini")) {
#     "gray40"
#   } else {
#     "#bf812d"
#   }
#   
#   # Crie o gráfico ajustado com pontos e linhas
#   p_tribo <- ggplot(df_plot, aes(x = Ano, y = MedianaAnual)) +
#     geom_point(color = cor_tribo, size = 1) +
#     geom_line(size = 0.5, group = 1, color = cor_tribo) +  # Use group = 1 para conectar todos os pontos
#     geom_errorbar(aes(ymin = IntervaloConfiancaInf, ymax = IntervaloConfiancaSup), width = 0.2, color = cor_tribo) +
#     geom_hline(yintercept = mediana_geral_anual, linetype = "dashed", color = "red") +
#     labs(title = paste("", tribo_atual),
#          x = "Ano",
#          y = "Mediana da Abundância / Esforço Amostral") +
#     theme_minimal() +
#     theme(plot.title = element_text(hjust = 0.5, size = 8),
#           axis.title = element_text(size = 5),
#           axis.text = element_text(size = 5),
#           axis.line = element_line(color = "black"),
#           axis.ticks.y = element_line(color = "black"),
#           panel.grid.minor = element_blank(),
#           axis.line.x = element_blank(),
#           legend.position = "none") +  # Remover a legenda
#     ylim(0, y_limit) +  # Ajuste os limites conforme necessário
#     geom_text(data = df_plot[df_plot$ValorP < 0.05, ], 
#               aes(x = Ano, y = IntervaloConfiancaSup, label = "*"), 
#               vjust = -0.5,  
#               size = 3)
#   
#   # Exiba o gráfico ajustado
#   print(p_tribo)
#   
#   # Salvar a imagem usando ggsave()
#   ggsave(filename = paste("mediana_", gsub(" ", "_", tolower(tribo_atual)), "_ajustado_pontos_linha_2020.png", sep = ""),  # Escolha um nome adequado para o arquivo
#          plot = p_tribo,  # O objeto ggplot
#          device = "png",  # Pode ser "jpeg", "tiff", etc.
#          path = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela/Destaque/Riozinho da Liberdade",  # Especifique o diretório onde você deseja salvar o gráfico
#          dpi = 300,  # Define a resolução (DPI)
#          width = 6, height = 5, units = "in")  # Define o tamanho da imagem
# }
# 
# 
# library(gridExtra)
# 
# # Definir uma lista para armazenar os gráficos
# lista_graficos <- list()
# 
# # Defina a ordem das tribos
# ordem_tribos <- c("Brassolini", "Morphini", "Haeterini", "Preponini", "Melanitini", "Anaeini", 
#                   "Epicaliini", "Epiphilini", "Coeini", "Satyrini", "Callicorini", "Biblidini", "Ageroniini")
# 
# for (tribo_atual in ordem_tribos) {
#   cat("Realizando análise e gerando gráfico para a tribo:", tribo_atual, "\n")
#   
#   # Filtrar os dados para a tribo atual
#   df_tribo <- df_long %>%
#     filter(tribo == tribo_atual)
#   
#   # Verificar se há dados para a tribo atual
#   if (nrow(df_tribo) == 0) {
#     cat("Não há dados para a tribo:", tribo_atual, "\n")
#     cat("Nenhuma análise ou gráfico gerado para a tribo:", tribo_atual, "\n")
#     next
#   }
#   
#   # Calcular a mediana anual para cada ano
#   medianas_anuais <- tapply(df_tribo$abundancia_padronizada, df_tribo$ano, median)
#   
#   # Calcular a mediana geral das medianas anuais
#   mediana_geral_anual <- median(medianas_anuais, na.rm = TRUE)
#   
#   # Remover os anos com NA das medianas anuais
#   medianas_anuais <- medianas_anuais[!is.na(medianas_anuais)]
#   
#   # Crie um vetor para armazenar os resultados dos testes
#   resultados_teste_anual <- numeric(length(medianas_anuais))
#   
#   # Faça um loop pelos anos e realize o teste de Wilcoxon para cada ano
#   for (ano_atual in names(medianas_anuais)) {
#     # Realiza o teste de Wilcoxon comparando as medianas do ano atual com a mediana geral
#     wilcox_test_resultado <- wilcox.test(df_tribo$abundancia_padronizada[df_tribo$ano == ano_atual], mu = mediana_geral_anual, exact = FALSE)
#     
#     # Armazena o valor p do teste no vetor de resultados
#     resultados_teste_anual[ano_atual] <- wilcox_test_resultado$p.value
#   }
#   
#   # Crie um data frame com as medianas anuais, a mediana geral anual e os valores-p
#   df_plot <- data.frame(Ano = names(medianas_anuais), MedianaAnual = medianas_anuais)
#   df_plot$MedianaGeral <- mediana_geral_anual
#   df_plot$ValorP <- resultados_teste_anual[match(df_plot$Ano, names(resultados_teste_anual))]
#   
#   # Calcule os erros padrão para cada ano
#   erros_padrao <- sapply(names(medianas_anuais), function(ano) {
#     dados_ano <- df_tribo$abundancia_padronizada[df_tribo$ano == ano]
#     desvio_padrao_ano <- sd(dados_ano, na.rm = TRUE)
#     erro_padrao_ano <- desvio_padrao_ano / sqrt(length(dados_ano))
#     return(erro_padrao_ano)
#   })
#   
#   # Adicione os intervalos de confiança ao data frame
#   df_plot$ErroPadrao <- erros_padrao
#   df_plot$IntervaloConfiancaInf <- pmax(df_plot$MedianaAnual - 1.96 * df_plot$ErroPadrao, 0)
#   df_plot$IntervaloConfiancaSup <- df_plot$MedianaAnual + 1.96 * df_plot$ErroPadrao
#   
#   # Definir os limites do eixo y de acordo com os valores das medianas
#   y_limit <- max(df_plot$IntervaloConfiancaSup) * 1.1
#   
#   # Definir a cor de acordo com a tribo
#   cor_tribo <- if (tribo_atual %in% c("Brassolini", "Haeterini", "Morphini")) {
#     "#35978f"
#   } else if (tribo_atual %in% c("Satyrini", "Coeini", "Epiphilini", "Epicaliini", "Anaeini", "Melanitini", "Preponini")) {
#     "gray40"
#   } else {
#     "#bf812d"
#   }
#   
#   # Crie o gráfico ajustado com pontos e linhas
#   p_tribo <- ggplot(df_plot, aes(x = Ano, y = MedianaAnual)) +
#     geom_point(color = cor_tribo, size = 1) +
#     geom_line(size = 0.5, group = 1, color = cor_tribo) +  # Use group = 1 para conectar todos os pontos
#     geom_errorbar(aes(ymin = IntervaloConfiancaInf, ymax = IntervaloConfiancaSup), width = 0.2, color = cor_tribo) +
#     geom_hline(yintercept = mediana_geral_anual, linetype = "dashed", color = "red") +
#     labs(title = paste("", tribo_atual),
#          x = "",
#          y = "Mediana da Abundância 
#  / Esforço Amostral") +
#     theme_minimal() +
#     theme_minimal() +
#     theme(plot.title = element_text(hjust = 0.5, size = 8),
#           axis.title = element_text(size = 5),
#           axis.text = element_text(size = 5),
#           axis.line = element_line(color = "black"),
#           axis.ticks.y = element_line(color = "black"),
#           panel.grid.minor = element_blank(),
#           axis.line.x = element_blank(),
#           legend.position = "none") +  # Remover a legenda
#     ylim(0, y_limit) +  # Ajuste os limites conforme necessário
#     geom_text(data = df_plot[df_plot$ValorP < 0.05, ], 
#               aes(x = Ano, y = IntervaloConfiancaSup, label = "*"), 
#               vjust = -0.5,  
#               size = 3)
#   
#   # Adicionar o gráfico atual à lista
#   lista_graficos[[tribo_atual]] <- p_tribo
# }


```

</br>


```{r grafico abundancia-resex-riozinho-da-liberdade-combinada}
#| label: fig-abundancia-resex-riozinho-da-liberdade-combinada
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '90%'
#| fig-cap: "Variação na mediana da abundância das tribos de borboletas frugívoras na RESEX do Riozinho da Liberdade de 2020 a 2022. A linha pontilhada vermelha indica a mediana geral (soma da mediana de todos os anos dividido pelo número de anos). O asterisco indica que a mediana anual foi significativamente diferente da mediana total, considerando p ≤ 0.01."

# # Combine todos os gráficos em uma única imagem
# imagem_combinada <- grid.arrange(grobs = lista_graficos, ncol = 3)

# Salvar a imagem combinada usando ggsave()
# ggsave(filename = "todos_graficos_riozinho_da_liberdade.png",  # Escolha um nome adequado para o arquivo
#        plot = imagem_combinada,  # O objeto ggplot
#        device = "png",  # Pode ser "jpeg", "tiff", etc.
#        path = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela/Destaque/Riozinho da Liberdade",  # Especifique o diretório onde você deseja salvar a imagem
#        dpi = 300,  # Define a resolução (DPI)
#        width = 14, height = 12, units = "in")  # Define o tamanho da imagem


knitr::include_graphics("imagens/cap04/bo-destaque-riozinho.png")

```

</br>

No PARNA da Serra do Divisor, pela inexistência de florestas de taboca, era esperado que não houvesse grande diferença na abundância das tribos entre anos. Duas tribos, Brassolini e Epicaliini apresentaram diminuições significativas em suas abundâncias em 2021 (@fig-abundancia-parna-serra-divisor-combinada). Foi observado também que os valores de abundâncias foram menores em comparação aos anos anteriores (@fig-abundancia-parna-serra-divisor-combinada). 

</br>

```{r grafico abundancia-parna-serra-divisor}
#| label: fig-abundancia-parna-serra-divisor
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'



# Análise  de efeito da queda do tabocal nas tribos de borboletas frugívoras - AUTOMATIZADO
# PARANA Serra do Divisor
# Script: Isabela Freitas Oliveira

# library(dplyr)
# library(tidyr)
# library(ggplot2)
# library(car)
# 
# # setwd("~/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela")
# # 
# # dados_borboletas <- read.table("dados_analise_borboletas_Isabela_V2.txt", header = TRUE)
# # dados_borboletas$ano <- as.factor(dados_borboletas$ano)
# # dados_borboletas <- dados_borboletas[dados_borboletas$ano != "2023", ]
# # dados_borboletas <- dados_borboletas[!is.na(dados_borboletas$tribo), ]
# 
# 
# dados_regiao_especifica <- dados_borboletas %>%
#   filter(uc == 'Parna_da_Serra_do_Divisor')
# 
# # Calcular o esforço amostral para cada combinação de uc_ea, expedicao e ano
# esforco_por_expedicao <- dados_regiao_especifica %>%
#   group_by(uc_ea, uc, expedicao, ano) %>%
#   summarize(
#     max_dia_amostragem = max(dia_amostragem) - 1,
#     .groups = 'drop'
#   ) %>%
#   mutate(
#     esforco_amostral = 16 * max_dia_amostragem
#   )
# 
# # Agregar o esforço de amostragem para cada uc_ea e ano
# esforco_total_por_ea_ano <- esforco_por_expedicao %>%
#   group_by(uc_ea, ano) %>%
#   summarize(
#     esforco_total_ano = sum(esforco_amostral),
#     .groups = 'drop'
#   )
# 
# # Agregar o esforço de amostragem para cada uc e ano
# esforco_total_por_uc_ano <- esforco_por_expedicao %>%
#   group_by(uc, ano) %>%
#   summarize(
#     esforco_total_ano = sum(esforco_amostral),
#     .groups = 'drop'
#   )
# 
# # Agregação para obter o esforço total por ano
# esforco_por_ano <- esforco_total_por_uc_ano %>%
#   group_by(ano,uc) %>%
#   summarize(
#     esforco = sum(esforco_total_ano),
#     .groups = 'drop'
#   )
# 
# # Agregação para obter o número total de indivíduos por ano
# num_ind_por_ano <- dados_regiao_especifica %>%
#   group_by(ano) %>%
#   summarize(
#     num_ind = sum(individuos, na.rm = TRUE),
#     .groups = 'drop'
#   )
# 
# #criando uma coluna de UA e selecionando somente as colunas interessadas pra analise
# dados_regiao_especifica <- dados_regiao_especifica %>%
#   mutate(ua = paste(uc_ea, transeccao, sep = "_"))
# 
# #combinando os dados por UA por ano = 12 (3 ea x 4 parcelas)
# df_abu_ano <- dados_regiao_especifica %>%
#   group_by(tribo, ua, uc_ea,uc, ano) %>%
#   summarise(abundancia = sum(individuos, na.rm = TRUE)) %>%
#   ungroup()
# 
# # Transforma o df para colocar os zeros
# df_tabocal <- df_abu_ano %>%
#   spread(key = tribo, value = abundancia, fill = 0)
# 
# # Retorna ao formato longo para as análises
# df_long <- df_tabocal %>%
#   pivot_longer(cols = Ageroniini:Satyrini, names_to = "tribo", values_to = "individuos")
# 
# # Agregação para obter a abundância total de cada tribo por ano
# abundancia_por_ano <- df_long %>%
#   group_by(tribo, ano) %>%
#   summarize(
#     abundancia_total = sum(individuos)
#   )
# 
# # Juntar as tabelas pela coluna 'ano' e 'uc'
# df_long_com_esforco <- left_join(df_long, esforco_por_ano, by = c("ano", "uc"))
# 
# 
# # Calcular a abundância padronizada pelo esforço amostral
# df_long <- df_long_com_esforco %>%
#   mutate(abundancia_padronizada = (individuos / esforco) * 100)
# #
# 
# library(tidyverse)
# 
# # Realizar análise e gerar gráficos para cada tribo
# 
# tribos <- unique(df_long$tribo)
# 
# for (tribo_atual in tribos) {
#   cat("Realizando análise e gerando gráfico para a tribo:", tribo_atual, "\n")
#   
#   # Filtrar os dados para a tribo atual
#   df_tribo <- df_long %>%
#     filter(tribo == tribo_atual)
#   
#   # Verificar se há dados para a tribo atual
#   if (nrow(df_tribo) == 0) {
#     cat("Não há dados para a tribo:", tribo_atual, "\n")
#     cat("Nenhuma análise ou gráfico gerado para a tribo:", tribo_atual, "\n")
#     next
#   }
#   
#   # Calcular a mediana anual para cada ano
#   medianas_anuais <- tapply(df_tribo$abundancia_padronizada, df_tribo$ano, median)
#   
#   # Adicione o ano de 2020, mesmo que não haja dados
#   medianas_anuais <- c(medianas_anuais, NA)
#   names(medianas_anuais)[length(medianas_anuais)] <- "2020"
#   
#   # Calcular a mediana geral das medianas anuais
#   mediana_geral_anual <- median(medianas_anuais, na.rm = TRUE)
#   
#   # Remover os anos com NA das medianas anuais
#   medianas_anuais <- medianas_anuais[!is.na(medianas_anuais)]
#   
#   # Crie um vetor para armazenar os resultados dos testes
#   resultados_teste_anual <- numeric(length(medianas_anuais))
#   
#   # Faça um loop pelos anos e realize o teste de Wilcoxon para cada ano
#   for (ano_atual in names(medianas_anuais)) {
#     # Realiza o teste de Wilcoxon comparando as medianas do ano atual com a mediana geral
#     wilcox_test_resultado <- wilcox.test(df_tribo$abundancia_padronizada[df_tribo$ano == ano_atual], mu = mediana_geral_anual, exact = FALSE)
#     
#     # Armazena o valor p do teste no vetor de resultados
#     resultados_teste_anual[ano_atual] <- wilcox_test_resultado$p.value
#   }
#   
#   # Crie um data frame com as medianas anuais, a mediana geral anual e os valores-p
#   df_plot <- data.frame(Ano = as.character(unique(c(names(medianas_anuais), "2020"))), MedianaAnual = c(medianas_anuais, NA))
#   df_plot$MedianaGeral <- mediana_geral_anual
#   df_plot$ValorP <- resultados_teste_anual[match(df_plot$Ano, names(resultados_teste_anual))]
#   
#   # Calcule os erros padrão para cada ano
#   erros_padrao <- sapply(names(medianas_anuais), function(ano) {
#     dados_ano <- df_tribo$abundancia_padronizada[df_tribo$ano == ano]
#     desvio_padrao_ano <- sd(dados_ano, na.rm = TRUE)
#     erro_padrao_ano <- desvio_padrao_ano / sqrt(length(dados_ano))
#     return(erro_padrao_ano)
#   })
#   
#   # Adicione os intervalos de confiança ao data frame
#   df_plot$ErroPadrao <- c(erros_padrao, NA)
#   df_plot$IntervaloConfiancaInf <- pmax(df_plot$MedianaAnual - 1.96 * df_plot$ErroPadrao, 0)
#   df_plot$IntervaloConfiancaSup <- df_plot$MedianaAnual + 1.96 * df_plot$ErroPadrao
#   
#   # Definir os limites do eixo y de acordo com os valores das medianas
#   y_limit <- max(df_plot$IntervaloConfiancaSup)*1.2
#   
#   # Definir a cor de acordo com a tribo
#   cor_tribo <- if (tribo_atual %in% c("Brassolini", "Haeterini", "Morphini")) {
#     "#35978f"
#   } else if (tribo_atual %in% c("Satyrini", "Coeini", "Epiphilini", "Epicaliini", "Anaeini", "Melanitini", "Preponini")) {
#     "gray40"
#   } else {
#     "#bf812d"
#   }
#   
#   # Crie o gráfico ajustado com pontos e linhas
#   p_tribo <- ggplot(df_plot, aes(x = Ano, y = MedianaAnual)) +
#     geom_point(color = cor_tribo, size = 1) +
#     geom_line(size = 0.5, group = 1, color = cor_tribo) +  # Use group = 1 para conectar todos os pontos
#     geom_errorbar(aes(ymin = IntervaloConfiancaInf, ymax = IntervaloConfiancaSup), width = 0.2, color = cor_tribo) +
#     geom_hline(yintercept = mediana_geral_anual, linetype = "dashed", color = "red") +
#     labs(title = paste("", tribo_atual),
#          x = "Ano",
#          y = "Mediana da Abundância / Esforço Amostral") +
#     theme_minimal() +
#     theme(plot.title = element_text(hjust = 0.5, size = 8),
#           axis.title = element_text(size = 5),
#           axis.text = element_text(size = 5),
#           axis.line = element_line(color = "black"),
#           axis.ticks.y = element_line(color = "black"),
#           panel.grid.minor = element_blank(),
#           axis.line.x = element_blank(),
#           legend.position = "none") +  # Remover a legenda
#     ylim(0, y_limit) +  # Ajuste os limites conforme necessário
#     geom_text(data = df_plot[df_plot$ValorP < 0.05, ], 
#               aes(x = Ano, y = IntervaloConfiancaSup, label = "*"), 
#               vjust = -0.5,  
#               size = 3)
#   
#   # Exiba o gráfico ajustado
#   print(p_tribo)
#   
#   # Salvar a imagem usando ggsave()
#   ggsave(filename = paste("mediana_", gsub(" ", "_", tolower(tribo_atual)), "_ajustado_pontos_linha_2020.png", sep = ""),  # Escolha um nome adequado para o arquivo
#          plot = p_tribo,  # O objeto ggplot
#          device = "png",  # Pode ser "jpeg", "tiff", etc.
#          path = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela/Destaque/Serra do Divisor",  # Especifique o diretório onde você deseja salvar o gráfico
#          dpi = 300,  # Define a resolução (DPI)
#          width = 6, height = 5, units = "in")  # Define o tamanho da imagem
# }
# 
# 
# library(gridExtra)
# 
# # Definir uma lista para armazenar os gráficos
# lista_graficos <- list()
# 
# # Defina a ordem das tribos
# ordem_tribos <- c("Brassolini", "Morphini", "Haeterini", "Preponini", "Melanitini", "Anaeini", 
#                   "Epicaliini", "Epiphilini", "Coeini", "Satyrini", "Callicorini", "Biblidini", "Ageroniini")
# 
# for (tribo_atual in ordem_tribos) {
#   cat("Realizando análise e gerando gráfico para a tribo:", tribo_atual, "\n")
#   
#   # Filtrar os dados para a tribo atual
#   df_tribo <- df_long %>%
#     filter(tribo == tribo_atual)
#   
#   # Verificar se há dados para a tribo atual
#   if (nrow(df_tribo) == 0) {
#     cat("Não há dados para a tribo:", tribo_atual, "\n")
#     cat("Nenhuma análise ou gráfico gerado para a tribo:", tribo_atual, "\n")
#     next
#   }
#   
#   # Calcular a mediana anual para cada ano
#   medianas_anuais <- tapply(df_tribo$abundancia_padronizada, df_tribo$ano, median)
#   
#   # Adicione o ano de 2020, mesmo que não haja dados
#   medianas_anuais <- c(medianas_anuais, NA)
#   names(medianas_anuais)[length(medianas_anuais)] <- "2020"
#   
#   # Calcular a mediana geral das medianas anuais
#   mediana_geral_anual <- median(medianas_anuais, na.rm = TRUE)
#   
#   # Remover os anos com NA das medianas anuais
#   medianas_anuais <- medianas_anuais[!is.na(medianas_anuais)]
#   
#   # Crie um vetor para armazenar os resultados dos testes
#   resultados_teste_anual <- numeric(length(medianas_anuais))
#   
#   # Faça um loop pelos anos e realize o teste de Wilcoxon para cada ano
#   for (ano_atual in names(medianas_anuais)) {
#     # Realiza o teste de Wilcoxon comparando as medianas do ano atual com a mediana geral
#     wilcox_test_resultado <- wilcox.test(df_tribo$abundancia_padronizada[df_tribo$ano == ano_atual], mu = mediana_geral_anual, exact = FALSE)
#     
#     # Armazena o valor p do teste no vetor de resultados
#     resultados_teste_anual[ano_atual] <- wilcox_test_resultado$p.value
#   }
#   
#   # Crie um data frame com as medianas anuais, a mediana geral anual e os valores-p
#   df_plot <- data.frame(Ano = as.character(unique(c(names(medianas_anuais), "2020"))), MedianaAnual = c(medianas_anuais, NA))
#   df_plot$MedianaGeral <- mediana_geral_anual
#   df_plot$ValorP <- resultados_teste_anual[match(df_plot$Ano, names(resultados_teste_anual))]
#   
#   # Calcule os erros padrão para cada ano
#   erros_padrao <- sapply(names(medianas_anuais), function(ano) {
#     dados_ano <- df_tribo$abundancia_padronizada[df_tribo$ano == ano]
#     desvio_padrao_ano <- sd(dados_ano, na.rm = TRUE)
#     erro_padrao_ano <- desvio_padrao_ano / sqrt(length(dados_ano))
#     return(erro_padrao_ano)
#   })
#   
#   # Adicione os intervalos de confiança ao data frame
#   df_plot$ErroPadrao <- c(erros_padrao, NA)
#   df_plot$IntervaloConfiancaInf <- pmax(df_plot$MedianaAnual - 1.96 * df_plot$ErroPadrao, 0)
#   df_plot$IntervaloConfiancaSup <- df_plot$MedianaAnual + 1.96 * df_plot$ErroPadrao
#   
#   # Definir os limites do eixo y de acordo com os valores das medianas
#   y_limit <- max(df_plot$IntervaloConfiancaSup) * 1.2
#   
#   # Definir a cor de acordo com a tribo
#   cor_tribo <- if (tribo_atual %in% c("Brassolini", "Haeterini", "Morphini")) {
#     "#35978f"
#   } else if (tribo_atual %in% c("Satyrini", "Coeini", "Epiphilini", "Epicaliini", "Anaeini", "Melanitini", "Preponini")) {
#     "gray40"
#   } else {
#     "#bf812d"
#   }
#   
#   # Crie o gráfico ajustado com pontos e linhas
#   p_tribo <- ggplot(df_plot, aes(x = Ano, y = MedianaAnual)) +
#     geom_point(color = cor_tribo, size = 1) +
#     geom_line(size = 0.5, group = 1, color = cor_tribo) +  # Use group = 1 para conectar todos os pontos
#     geom_errorbar(aes(ymin = IntervaloConfiancaInf, ymax = IntervaloConfiancaSup), width = 0.2, color = cor_tribo) +
#     geom_hline(yintercept = mediana_geral_anual, linetype = "dashed", color = "red") +
#     labs(title = paste("", tribo_atual),
#          x = "",
#          y = "Mediana da Abundância 
#  / Esforço Amostral") +
#     theme_minimal() +
#     theme(plot.title = element_text(hjust = 0.5, size = 8),
#           axis.title = element_text(size = 5),
#           axis.text = element_text(size = 5),
#           axis.line = element_line(color = "black"),
#           axis.ticks.y = element_line(color = "black"),
#           panel.grid.minor = element_blank(),
#           axis.line.x = element_blank(),
#           legend.position = "none") +  # Remover a legenda
#     ylim(0, y_limit) +  # Ajuste os limites conforme necessário
#     geom_text(data = df_plot[df_plot$ValorP < 0.05, ], 
#               aes(x = Ano, y = IntervaloConfiancaSup, label = "*"), 
#               vjust = -0.5,  
#               size = 3)
#   
#   # Adicionar o gráfico atual à lista
#   lista_graficos[[tribo_atual]] <- p_tribo
# }


```

</br>


```{r grafico abundancia-parna-serra-divisor-combinada}
#| label: fig-abundancia-parna-serra-divisor-combinada
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '90%'
#| fig-cap: "Variação na abundância das tribos de borboletas frugívoras no PARNA da Serra do Divisor de 2018 a 2022. A linha pontilhada vermelha indica a mediana geral (soma da mediana de todos os anos dividido pelo número de anos). O asterisco indica que a mediana anual foi significativamente diferente da mediana total, considerando p ≤ 0.01."

# # Combine todos os gráficos em uma única imagem
# imagem_combinada <- grid.arrange(grobs = lista_graficos, ncol = 3)

# Salvar a imagem combinada usando ggsave()
# ggsave(filename = "todos_graficos_serra_do_divisor.png",  # Escolha um nome adequado para o arquivo
#        plot = imagem_combinada,  # O objeto ggplot
#        device = "png",  # Pode ser "jpeg", "tiff", etc.
#        path = "/Users/isabelafreitasoliveira/Documents/ICMBIO-COMOB/Dados_Monitora/Análise de dados/Monitora_Borboletas_Isabela/Destaque/Serra do Divisor",  # Especifique o diretório onde você deseja salvar a imagem
#        dpi = 300,  # Define a resolução (DPI)
#        width = 14, height = 12, units = "in")  # Define o tamanho da imagem

knitr::include_graphics("imagens/cap04/bo-destaque-serra-divisor.png")

```


</br>

Esse padrão de diminuição das abundâncias das tribos a partir de 2021 também foi observado nas UCs anteriormente citadas. Dessa forma, sugere-se que algum evento climático/ambiental pode ter afetado as comunidades de borboletas em toda a região do estado do Acre. No entanto, a queda das florestas de taboca parece ter uma grande influência local em alguns grupos de borboletas, principalmente as tribos indicadoras, confirmando que este nível taxonômico responde a esse tipo de distúrbio. 

</br>


## Discussão

</br>

O Programa Monitora vem se estabelecendo como um dos maiores programas de monitoramento da biodiversidade do mundo. O Brasil, por sua extensão continental e diversos biomas ainda carentes em estudos a longo prazo, necessita, cada vez mais, do apoio federal (ARPA, FUNBIO, CNPq) e de ONGs nacionais (IPE, ECOPORÉ, FEST)  e internacionais (PNUD, Gordon and Betty Moore Foundation), para a sua continuidade. Somente dessa forma é possível acumular esforços para que a biodiversidade brasileira seja conhecida e protegida. Com o Programa Monitora, além de monitorar os grupos ao longo dos anos, foi possível atualizar a distribuição geográfica de diversas espécies de borboletas, explorar cientificamente novos locais e registrar novas espécies para o Brasil (i.e., PARNA do Monte Roraima; Oliveira et al. *em revisão*), além de descobrir novas espécies para a ciência (novo gênero de borboleta coletado na REBIO do Tapirapé; @Barbosa_2023). 

Nas amostragens de borboletas frugívoras do Programa Monitora, o protocolo básico foi, em geral, adequadamente aplicado, com a obtenção de importantes dados para o país. Especialmente na Amazônia, região de grandes dificuldades logísticas, novas áreas têm sido inventariadas, proporcionando, mesmo que em caráter ainda preliminar, um panorama mais amplo da diversidade. No entanto, para que o conhecimento desse grupo continue evoluindo, são funcamentais tanto o compromisso das UCs participantes com sua permanência no Programa, quanto a adesão de novas áreas, como ressaltado ao longo do capítulo. O ano de 2022 (ano limite das análises desse relatório) apresentou a maior quantidade de UCs do Programa aplicando o protocolo básico de borboletas frugívoras, destacando não somente a recuperação em relação à redução no esforço amostral causada pela baixa amostragem nos anos da pandemia de COVID-19, mas também a superação do maior esforço até então registrado, em período imediatamente anterior à pandemia. É de se esperar que o número de UCs consolidadas cresçam, não somente na Amazônia, mas também nos outros biomas, Cerrado e Mata Atlântica. Esta ampliação espacial do esforço amostral se faz necessária devido à grande relação entre esforço e número de capturas. Sendo assim, quanto maior o número de locais amostrados, maior a abundância, riqueza e diversidade de borboletas conhecidas (@Freitas_2024).  

Um fator indispensável para um programa de monitoramento é a sua amostragem temporal (@Middlebrook_2023). As amostragens ao longo do tempo (anos) possibilitam detectar variações ou estabilidade na abundância, riqueza e composição de espécies em uma determinado local ou região (@Mattoni_2001; @VanSwaay_2015; @Middlebrook_2023; @Freitas_2024). Portanto, além da ampliação da amostragem em termos espaciais, deve-se, principalmente, priorizar a continuidade das amostragens ao longo dos anos, pois somente desta forma análises temporais robustas poderão ser realizadas para a detecção consistente de eventuais flutuações temporais dos indicadores escolhidos. A interpretação dos dados é dificultada pelos acréscimos, decréscimos ou substituições de UCs ao longo dos anos. Com as diferenças ambientais de cada UC, a falta de constância nas amostragens das UCs analisadas resulta em dados muitas vezes inconsistentes e dispersos, dificultando a obtenção de resultados sólidos para a região. Portanto, torna-se importante analisar a comunidade de borboletas frugívoras  de cada UC separadamente para evitar a influência dos dados de outras UCs na interpretação dos dados regionais. É importante ressaltar que o Programa Monitora ainda está na fase de adequação, crescimento e consolidação. Os programas de monitoramento de borboletas em países temperados estão estabelecidos a décadas, como por exemplo o [The United Kingdom Butterfly Monitoring Scheme (UKBMS)](https://ukbms.org/), iniciado em 1976, e coletando dados anualmente em mais de 3.000 locais na Grã-Bretanha.  

A tribo Satyrini tem sido a mais representativa em todas as localidades amostradas, um resultado comum, dado que é a tribo de borboletas frugívoras com mais espécies (Espeland et al. 2023). Devido à sua grande diversidade, não é considerada uma tribo indicadora de um determinado tipo florestal, pois inclui várias espécies que habitam diversos ambientes, desde florestas fechadas até florestas abertas e perturbadas. Em contraste, as borboletas indicadoras de florestas fechadas/preservadas (Brassolini, Morphini e Haeterini) e as indicadoras de florestas abertas/perturbadas (Ageroniini, Callicorini e Biblidini), parecem representar bem seus respectivos ambientes. Um resultado interessante observado foi que as borboletas indicadoras de florestas fechadas tendem a apresentar uma abundância mais constante ao longo dos anos do que as borboletas de florestas abertas/perturbadas. Esse padrão está intimamente ligado à história natural desses organismos, frequentemente relacionada ao ambiente amostrado. Como as amostragens são realizadas predominantemente em áreas protegidas florestais, espera-se que as borboletas indicadoras de florestas fechadas/preservadas sejam mais representativas do que as de florestas abertas/perturbadas. Portanto, a representatividade de borboletas de florestas abertas na Amazônia, por exemplo, indica uma mudança local drástica, como a queda de uma floresta de taboca, ou uma alteração climática intensa na região. Assim, as flutuações intensas de borboletas de florestas abertas ao longo dos anos refletem mudanças, enquanto as pequenas flutuações de borboletas indicadoras de florestas fechadas indicam estabilidade. Com base nessas observações, esses grupos se mostram ótimos modelos para a interpretação ambiental. No entanto, são necessárias pesquisas mais detalhadas focadas nas questões climáticas e ambientais, como alteração de uso da terra, degradação das florestas e deriva de agrotóxicos.  

As borboletas são amplamente utilizadas como indicadores de mudanças climáticas e ambientais em todo o mundo (@VanSwaay_2008; @Staats_2014; @Roy_2015; @VanSwaay_2015; @Sanderson_2021). Os monitoramentos com séries temporais mais longas vêm sendo realizados em países do norte global, especialmente na Europa. Esses monitoramentos, frequentemente, utilizam a abordagem de ciência cidadã, envolvendo a população local no registro de espécies de borboletas. Esses países têm uma diversidade de espécies muito menor que o Brasil, o que torna relativamente mais fácil a obtenção de dados ao nível de espécies. O Programa Monitora utiliza o protocolo básico de borboletas (i.e., tribo como nível taxonômico) por ser mais simples de replicar, considerando que algumas áreas podem ter mais de 100 espécies de borboletas frugívoras. Além disso, essas áreas abrigam muitas espécies crípticas, tornando a identificação a nível específico muitas vezes bastante difícil ou mesmo inviável. Assim, ressaltamos a importância de iniciativas como o Programa Monitora para avaliar a eficácia do uso de tribos de borboletas em monitoramentos e diagnósticos ambientais. Conforme citado ao longo do relatório, é importante que os indivíduos amostrados nas UCs sejam fotografados para que especialistas possam identificá-los ao nível de espécie ou morfoespécie, aumentando a assertividade e a confiabilidade dos resultados do monitoramento.  



## Recomendações


</br>


::: callout-tip

## Boas práticas para aprimorar o Programa

</br>

- Ampliar o número de unidades de conservação com aplicação do protocolo de borboletas frugívoras (Básico e Avançado) nos biomas Mata Atlântica e Cerrado, dado que esses biomas não chegaram a atingir a suficiência amostral em nenhum ano desde o início do Programa; 

- Na Região Climática Noroeste da Amazônia, implementar o protocolo de borboletas frugívoras em pelo menos três UCs (nove EAs), preferencialmente na ESEC Juami-Japurá, no PARNA do Pico da Neblina e na RESEX Auatí-Paraná;  

- Ampliar o número de UCs com aplicação do protocolo de borboletas frugívoras nas regiões do médio e baixo rio Juruá, regiões carentes de amostragem de borboletas e de extrema importância biológica. É sugerida a implementação nas RESEX Médio e Baixo Juruá e na FLONA de Tefé;  

- Ampliar o número de UCs com aplicação do protocolo de borboletas frugívoras na Região Climática Sudeste Amazônica de forma que seja alcançada a suficiência amostral de 18 EAs no ano. Sugere-se a implementação na FLONA de Carajás, na REBIO Nascentes da Serra do Cachimbo e na ESEC Iquê;  

- Consolidar a implantação do protocolo de borboletas frugívoras naquelas unidades de conservação ainda não consolidadas, de forma que as UCs contem com pelo menos três estações amostrais implantadas e em operação; 

- Assegurar que durante as campanhas de campo as amostragens sejam realizadas de acordo com as diretrizes estabelecidas no protocolo amostral, em especial quanto ao respeito aos períodos de coleta definidos para cada região e em relação ao esforço amostral (número de dias de amostragens em cada EA); 

- Assegurar que os dados coletados sejam repassados à Coordenação de acordo com as orientações definidas e num prazo razoável após a realização da campanha de campo;  

- Divulgar novamente às UCs os períodos indicados para amostragem nas diferentes regiões, dado que ainda há várias unidades amostrando fora desse período. 

::: 

</br>

## Referências

