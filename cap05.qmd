
```{r library, echo=FALSE, message=FALSE, warning=FALSE}

library(tidyverse)
library(data.table)
library(descr)
library(RColorBrewer)
library(kableExtra)
library(knitr)
library(DT)
library(plotly)
library(ggthemes)
library(forcats)
library(leaflet)
library(sf)
library(rgdal)
library(treemapify)
library(reshape2)
library(randomcoloR)
library(gridExtra)
```


# Mamíferos e aves  

</br>

**Arlindo Gomes Filho^1^, Elildo Alves Ribeiro de Carvalho Junior^2^, Gerson Buss^3^, Marcelo Lima Reis^4^, Marcos de Sousa Fialho^1^, Rafael Suertegaray Rossato^3^, Ricardo Sampaio^3^, Richard Hatakeyama^5^, Thiago Orsi Laranjeiras^6^** 

1. Centro Nacional de Pesquisa e Conservação de Aves Silvestres – CEMAVE  
*Instituto Chico Mendes de Conservação da Biodiversidade – ICMBio*  
*BR-230 Km 10*  
*Floresta Nacional da Restinga de Cabedelo*  
*58108-012 Cabedelo, PB*  

2. Centro Nacional de Pesquisa e Conservação de Mamíferos Carnívoros – CENAP   
*Instituto Chico Mendes de Conservação da Biodiversidade – ICMBio*  
*Estrada Municipal Hisaichi Takebayashi, 8600 - Bairro da Usina*  
*12952-011 Atibaia, SP*  


3. Centro Nacional de Pesquisa e Conservação de Primatas Brasileiros – CPB  
*Instituto Chico Mendes de Conservação da Biodiversidade – ICMBio*  
*BR-230 Km 10*  
*Floresta Nacional da Restinga de Cabedelo*  
*58108-012 Cabedelo, PB*  


4. Coordenação de Monitoramento da Biodiversidade - COMOB  
*Instituto Chico Mendes de Conservação da Biodiversidade – ICMBio*  
*Complexo Administrativo EQSW 103/104 s/n*  
*70670-350 Brasília, DF*  


5. Núcleo de Gestão Integrada - NGI ICMBio Tefé  
*Instituto Chico Mendes de Conservação da Biodiversidade – ICMBio*  
*Estr. do Aeroporto, 725 - Centro*  
*69550-101 Tefé, AM*  

6. Parque Nacional do Viruá  
*Instituto Chico Mendes de Conservação da Biodiversidade – ICMBio*  
*69360-000 Caracaraí, RR* 

<br>

Mamíferos e aves florestais de médio e grande porte são animais que sofrem muita pressão com a caça e, portanto, são considerados indicadores de impactos de origem antrópica. A defaunação das florestas acarreta a chamada “síndrome da floresta vazia” (@Redford_1992). A redução das populações animais além de ser uma diminuição direta da biodiversidade, também acomete a própria estrutura e manutenção das florestas, ao perder polinizadores, dispersores de sementes e outros processos ecológicos importantes. Daí a necessidade de realizar o monitoramento desses dois grupos no âmbito do Programa Monitora.

A taxonomia utilizada para os mamíferos e aves foi a mesma adotada no processo de avaliação do estado de conservação das espécies da fauna brasileira (@SALVE_2024).

</br>

## Estado da implementação

</br>

Para o período de 2014 a 2022 foram registradas 52 UCs federais e 138 UAs (transecções lineares) em operação, isto é, com amostragens dos alvos mamíferos e aves com o método do protocolo básico (censo diurno em transecção linear), nos biomas Amazônia, Cerrado e Mata Atlântica.

Destas 52 UCs federais com coleta de dados de mamíferos e aves, 34 (67%) já estão consolidadas, isto é, possuem pelo menos três unidades amostrais (transecções lineares) em operação. Seis UCs retomaram as amostragens em 2022, sete UCs são consideradas como paradas ou interrompidas (mais de dois anos consecutivos sem amostragem) e duas UCs não fizeram amostragens de 2022 (@fig-esforco-total-uc-bioma-script).

```{r processamento dos dados}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

# Carregando os dados no formato .csv

masto_aves_csv <-
  read_csv2("dados/base_masto_aves_esforco_corrigido.csv")

# Nesse arquivo "base_masto_aves_eforco_corrigido.csv" a coluna de esforço 
# foi corrigida, visto que os valores estavam sem o ponto decimal, 
# indicando quantidades 10 vezes superiores ao valor real (ex.: 45 km e vez de 4.5 km)



# Convertendo os dados para o formato .rds

saveRDS(masto_aves_csv, file = "dados/masto_aves.rds")

masto_aves <- readRDS("dados/masto_aves.rds")

# Carregando a planilha com a UCs classificadas por grupo - proteção integral x
# uso sustentável

ucs_grupos <-
  read_csv2("dados/dados_brutos/ucs_grupos.csv")


# Juntando planilha ucs_grupos com a planilha masto_aves

masto_aves <-
  left_join(masto_aves, ucs_grupos, by = "cnuc")

#View(masto_aves)

# Criando a coluna biomas

masto_aves <- masto_aves %>% 
mutate(
  bioma = case_when(
    uc == "Esec de Pirapitinga" ~ "Cerrado",
    uc == "Esec Serra Geral do Tocantins" ~ "Cerrado",
    uc == "Parna da Chapada dos Veadeiros" ~ "Cerrado",
    uc == "Parna da Serra da Bodoquena" ~ "Cerrado",
    uc == "Parna da Serra do Cipó" ~ "Cerrado",
    uc == "Parna da Serra da Bocaina" ~ "Mata Atlântica",
    uc == "Parna da Serra dos Órgãos" ~ "Mata Atlântica",
    uc == "Parna do Iguaçu" ~ "Mata Atlântica",
    uc == "Parna do Superagui" ~ "Mata Atlântica",
    uc == "Rebio Guaribas" ~ "Mata Atlântica",
    uc == "Rebio de Una" ~ "Mata Atlântica",
    TRUE ~ "Amazônia"))

#View(masto_aves)

#unique(masto_aves$bioma)

# Corrigindo a lista de primatas - alterando registros na coluna "taxon_validado": 
# Mico spp para Mico sp e "Callicebus spp" para "Callicebus sp"

masto_aves <- masto_aves %>% 
mutate(
  taxon_validado = case_when(
    taxon_validado == "Mico spp" ~ "Mico sp",
    taxon_validado == "Callicebus spp" ~ "Callicebus sp",
    TRUE ~ taxon_validado))

#unique(masto_aves$taxon_validado)


# Corrigindo validação de Ozotocerus em Roraima

masto_aves <- masto_aves %>%
mutate(
  taxon_validado = case_when(
    uc == "Esec de Maracá" & taxon_validado == "Ozotocerus bezoarticus" ~ "NA",
  TRUE ~ taxon_validado))


# list_primatas <- masto_aves |>
#   filter(ordem == "Primates")
# 
# unique(list_primatas$taxon_validado)

# Convertendo a classe de algumas variáveis para fator

masto_aves$uc <- as.factor(masto_aves$uc)
masto_aves$bioma <- as.factor(masto_aves$bioma)
masto_aves$uc_ca <- as.factor(masto_aves$uc_ca)
masto_aves$categoria <- as.factor(masto_aves$categoria)
masto_aves$grupo <- as.factor(masto_aves$grupo)

#glimpse(masto_aves)

```



O esforço de amostragem nos nove anos considerados neste relatório correspondeu a 5.356 dias de campo (transecção/dia) e 25.602,55 km percorridos (@fig-esforco-acumulado-script), resultando em 22.985 registros de mamíferos de médio e grande porte e de 12.995 aves terrestres cinegéticas (@fig-taxons-acumulados-script). No total, foram identificados ?? táxons de Mamíferos e 38 de Aves entre gêneros e espécies (Apêndice C), ?? e 6 dos quais estão ameaçados de extinção, respectivamente. O esforço por UC, ordenadas por bioma (Mata Atlântica, Cerrado e Amazônia), é apresentado na @fig-esforco-total-uc-bioma-script.  


```{r grafico 1 esforço Elildo}
#| label: fig-esforco-acumulado-script
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Esforço por ano (linha marrom) e acumulado (linha verde) em quilômetros percorridos nas unidades de conservação integrantes do Programa Monitora no período de 2014 a 2022."


# scripts para produzir 3 graficos para o relatorio florestal
# Elildo Carvalho Jr & Marcos Fialho

# Obs 1: outros graficos produzidos anteriormente (incluindo taxas de crescimento de populacoes,
# media geometrica das tendencias etc ja foram entregues, Rmarkdown para gera-los esta em outro arquivo 

library(here)
library(tidyverse)
library(RColorBrewer)

#-----------3 graficos para o relatorio florestal-------------------

#----- ler dados
load(here("data", "monitora.RData"))

#----- grafico de esforco anual e acumulado por bioma
monitora %>%
  filter(ano != 2023) %>%
  distinct(bioma, uc, ano, ea, data, esforco) %>%
  group_by(bioma, ano) %>%
  summarise(esforco_anual = sum(esforco),
            ucs = n_distinct(uc),
            taxa = n()/esforco_anual) %>%
  mutate(esf_acumulado = cumsum(esforco_anual)) %>%
  relocate(esf_acumulado, .after = esforco_anual) %>%
  ggplot(aes(x=ano)) +
  geom_line(aes(y = esf_acumulado), colour = "cyan4", linewidth = 1) +
  geom_line(aes(y = esforco_anual), colour = "#BF8120", linewidth = 1) +
  ylab("Esforço (km)") +
  xlab("") +
  theme_classic() +
  #scale_y_continuous(limits = c(0, NA), expand = c(0, 0)) +
  theme(strip.text.x = element_text(size = 12)) +
  theme(strip.background = element_blank()) +
  theme(axis.text.x = element_text(size = 8)) +
  theme(axis.text.y = element_text(size = 8)) +
  facet_wrap(~ bioma, scales = "free") +
  labs(x = "Ano")




# salvar
ggsave("imagens/cap05/ma_esforco_acumulado1.jpg",
       plot = last_plot(),
       device =  "jpeg",
       scale=1.5,
       width = 210,
       height = 70,
       units = "mm",
       dpi = 120)

```


</br>

```{r gráfico 2 esforço Elildo}
#| label: fig-taxons-acumulados-script
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Táxons registrados acumulados (linha) e número de unidades de conservação (barras) com protocolo básico de masto-aves executado por ano entre 2014 e 2022."

#----- grafico com numero de UCs ativas e numero acumulado de encontros por ano
monitora %>%
  filter(ano != 2023) %>%
  distinct(bioma, uc, ano, ea, data, esforco) %>%
  group_by(bioma, ano) %>%
  summarise(esforco_anual = sum(esforco),
            ucs = n_distinct(uc)) %>%
  left_join(monitora %>%
              arrange(ano) %>%
              distinct(taxon_validado, .keep_all = TRUE) %>%
              group_by(bioma, ano) %>%
              count() %>%
              ungroup() %>%
              rename(taxa_registrados = n),
            by = c("bioma", "ano")) %>%
  mutate(taxon_acumulado = cumsum(taxa_registrados)) %>%
  relocate(taxon_acumulado, .after = esforco_anual) %>%
  mutate(taxon_acumulado = case_when(is.na(taxon_acumulado) ~ max(taxon_acumulado, na.rm = TRUE),
                                     .default = taxon_acumulado)) %>%
  ggplot(aes(x=ano)) +
  geom_bar(aes(y = ucs*10), stat = "identity", 
           fill = "cyan4", colour = "cyan4") +
  geom_line(aes(y = taxon_acumulado), stat = "identity", colour = "#95D8D8", linewidth = 0.8) +
  scale_y_continuous(
    name = "Taxa validados (acumulado)",  # features of first axis
    sec.axis = sec_axis(~.*0.1, name="Número de UCs"), # add second axis and specify its features
    expand = c(0, 0)
  ) +
  scale_x_continuous(breaks = seq(2014, 2022, 2)) +
  theme_classic() +
  theme(strip.text.x = element_text(size = 12)) +
  theme(strip.background = element_blank()) +
  theme(axis.text.x = element_text(size = 8)) +
  theme(axis.text.y = element_text(size = 8)) +
  facet_wrap(~ bioma, scales = "free") +
  # theme(aspect.ratio = 3/4,  # Ajustar o painel para uma relação 3/4 laltura/largura
  #   plot.background = element_rect(fill = "white")) +
  labs(x = "Ano")

ggsave("imagens/cap05/ma_ucs_ativas_taxa_acumulado1.jpg",
       plot = last_plot(),
       device =  "jpeg",
       scale=1.5,
       width = 210,
       height = 70,
       units = "mm",
       dpi = 120)



```


</br>

```{r gráfico 3 esforço Elildo}
#| label: fig-esforco-total-uc-bioma-script
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '80%'
#| fig-cap: "Esforço em quilômetros percorridos por unidade de conservação por bioma por ano."

#----- grafico de esforco total e anual por uc/bioma
pallete <- RColorBrewer::brewer.pal(length(unique(monitora$ano)), "Spectral")

monitora %>%
  filter(ano != 2023) %>%
  distinct(bioma, uc, ano, ea, data, esforco) %>%
  group_by(bioma, uc, ano) %>% 
  summarize(esforco = sum(esforco)) %>% 
  group_by(uc) %>%
  mutate(esf_total = sum(esforco)) %>%
  ungroup() %>%
  arrange(esf_total) %>%
  mutate(uc = factor(uc, levels = unique(uc)),
         ano = factor(ano)) %>% 
  ggplot(aes(x = uc, y = esforco, group = ano, fill = ano)) +
  geom_bar(stat = "identity") +
  facet_grid(rows = vars(desc(bioma)), scales = "free", space = "free_y")  +
  coord_flip() +
    
  theme_classic() +
  xlab("") +
  ylab("Esforço total (km)") +
  theme(
    #strip.background = element_blank(),
    strip.text.x = element_blank()
  ) +
  scale_fill_manual(values = pallete, name = "Ano", 
                    guide = guide_legend(reverse = TRUE)) +
  theme(strip.text.x = element_text(size = 14)) +
  theme(strip.text.y = element_blank()) +
  #theme(strip.background = element_blank()) +
  theme(axis.text.x = element_text(size = 7, face = "bold")) +
  theme(axis.text.y = element_text(size = 6)) +
  theme(axis.line.x=element_blank()) +
  theme(panel.grid.major.x = element_line(color = "lightgray")) 

  

ggsave("imagens/cap05/ma_esforco_total_uc_bioma1.jpg",
       plot = last_plot(),
       device =  "jpeg",
       scale=0.6,
       width = 240,
       height = 300,
       units = "mm",
       dpi = 120)

```


```{r grafico esforço acumulado}
#| label: fig-esforco-acumulado
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '80%'
# #| fig-cap: "Esforço por ano e acumulado em quilômetros percorridos nas unidades de conservação aderidas ao Programa Monitora entre 2014 e 2022."
# 
# knitr::include_graphics("imagens/cap05/ma_esforco_acumulado1.JPG")

```

```{r grafico ucs_ativas_taxa_acumulado}
#| label: fig-taxons-acumulados
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
# #| fig-cap: "Táxons registrados acumulados e número de unidades de conservação com protocolo básico de masto-aves executado por ano entre 2014 e 2022."
# 
# knitr::include_graphics("imagens/cap05/ma_ucs_ativas_taxa_acumulado1.JPG")

```

```{r grafico esforco_total_uc_bioma.jpg}
#| label: fig-esforco-total-uc-bioma
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| #| fig.pos: 'H'
#| out.width: '90%'
# #| fig-cap: "Esforço em quilômetros percorridos por unidade de conservação por bioma por ano."
# 
# knitr::include_graphics("imagens/cap05/ma_esforco_total_uc_bioma1.JPG")
```

</br>

## Resultados

</br>

### Visão geral

</br>

A grande maioria dos registros de mamíferos (??%) corresponde a primatas e roedores (@fig-registros-ordem). Esse resultado se deve, em parte, ao fato de a detecção do método ser mais eficiente para o registro desses grupos. Espécies noturnas e esquivas, como a maioria dos carnívoros, são dificilmente registradas.

```{r paletas de cores}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

# Criando paletas de cores

# cores = viridis(13)
# cores <- brewer.pal(12, "Set3")
# cores <- colorRampPalette(c("darkblue","lightblue"))
# cores(13)

cor1 <- c(Primates = "#008B8B",
      Rodentia = "#4AB1B1",
      Tinamiformes = "#70C4C4",
      Galliformes = "#95D8D8",
      Artiodactyla = "#CDF5F5",
      Gruiformes = "#D9D9D9",
      Carnivora = "#CCCCCC",
      Pilosa = "#B2B2B2",
      Perissodactyla = "#999999",
      Cingulata = "#666666",
      Didelphimorphia = "#FEE6CE",
      Lagomorpha = "#FDAE6B",
      Cariamiformes = "#E6550D")


cor2 <- c("#008B8B",
          "#CDF5F5",
          "#D9D9D9",
          "#70C4C4",
          "#666666"
          )

cor3 <-
  c(
    "#008B8B",
    "#129494",
    "#008B8B",
    "#38A8A8",
    "#4AB1B1",
    "#5DBBBB",
    "#70C4C4",
    "#82CECE",
    "#95D8D8",
    "#A8E2E2",
    "#BAEBEB",
    "#CDF5F5",
    "#E0FFFF"
    )


cor4 <- c("#008B8B", "#BAEBEB", "#259E9E", "#E0FFFF", "#38A8A8", "#95D8D8")

```

```{r contagem_especies_por_ordem}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

# Limpando dados da coluna taxon-validado para a contagem de número de 
# espécies por ordem
# Foram excluídos alguns regitros "gênero sp", para os casos em que todas
# as espécies do gênero já tenham sido registradas


limpeza_registros_numero_especies_por_ordem <-  masto_aves %>%
  filter(!(masto_aves$taxon_validado  == "Aburria sp" |
             masto_aves$taxon_validado  == "Crax sp" |
             masto_aves$taxon_validado  == "Odonthophorus sp" |
             masto_aves$taxon_validado  == "Pauxi sp" |
             masto_aves$taxon_validado  == "Coendou sp" |
             masto_aves$taxon_validado  == "Myoprocta sp" |
             masto_aves$taxon_validado  == "Dasyprocta sp" |
             masto_aves$taxon_validado  == "Microsciurus sp" |
             masto_aves$taxon_validado  == "Sciurillus sp" |
             masto_aves$taxon_validado  == "Urosciurus sp" |
             masto_aves$taxon_validado  == "Guerlinguetus sp" |
             masto_aves$taxon_validado  == "Mazama sp" |
             masto_aves$taxon_validado  == "Leopardus sp" |
             masto_aves$taxon_validado  == "Cacajao sp" |
             masto_aves$taxon_validado  == "Callicebus sp" |
             masto_aves$taxon_validado  == "Callithrix sp" |
             masto_aves$taxon_validado  == "Cebus sp" |
             masto_aves$taxon_validado  == "Saimiri sp" 
             )) |> 
  filter(!is.na(ordem)) |>
  filter(!is.na(taxon_validado)) |> 
  group_by(taxon_validado, ordem) |> 
  summarise(count = n()) 

#contagem_numero_especies_por_ordem

numero_especies_por_ordem <- limpeza_registros_numero_especies_por_ordem |> 
  group_by(ordem) |> 
  count() |> 
  arrange(desc(n))


```

```{r limpeza_registros_numero_especies_por_ordem_bioma}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

#limpeza_registros_numero_especies_por_ordem_bioma

limpeza_registros_numero_especies_por_ordem_bioma <-  masto_aves %>%
  filter(!(masto_aves$taxon_validado  == "Aburria sp" |
             masto_aves$taxon_validado  == "Crax sp" |
             masto_aves$taxon_validado  == "Odonthophorus sp" |
             masto_aves$taxon_validado  == "Pauxi sp" |
             masto_aves$taxon_validado  == "Coendou sp" |
             masto_aves$taxon_validado  == "Myoprocta sp" |
             masto_aves$taxon_validado  == "Dasyprocta sp" |
             masto_aves$taxon_validado  == "Microsciurus sp" |
             masto_aves$taxon_validado  == "Sciurillus sp" |
             masto_aves$taxon_validado  == "Urosciurus sp" |
             masto_aves$taxon_validado  == "Guerlinguetus sp" |
             masto_aves$taxon_validado  == "Mazama sp" |
             masto_aves$taxon_validado  == "Leopardus sp" |
             masto_aves$taxon_validado  == "Cacajao sp" |
             masto_aves$taxon_validado  == "Callicebus sp" |
             masto_aves$taxon_validado  == "Callithrix sp" |
             masto_aves$taxon_validado  == "Cebus sp" |
             masto_aves$taxon_validado  == "Saimiri sp" 
             )) |> 
  filter(!is.na(ordem)) %>%
  filter(!is.na(taxon_validado)) |> 
  group_by(taxon_validado, ordem, bioma) %>%
  summarise(count = n()) 

#contagem_numero_especies_por_ordem_bioma

numero_especies_por_ordem_bioma <- limpeza_registros_numero_especies_por_ordem_bioma |> 
  group_by(bioma, ordem) |> 
  count() |> 
  arrange(desc(n))

```

```{r G_especies_registros_ordem_geral}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

# Gráfico do número de espécies e de registros por ordem - geral

registros_especies_geral <- masto_aves %>%
  filter(!is.na(ordem)) |> 
  group_by(ordem) %>%
  summarise(count = n()) |> 
  arrange(desc(count))
  
G_especies_registros_ordem_geral <- numero_especies_por_ordem  |> 
  ggplot() +
  geom_col(data = registros_especies_geral, aes(x = fct_reorder(ordem, count, .desc = F), y = count, fill = "darkgreen")) +
  geom_col(aes(x = fct_reorder(ordem, n, .desc = F), y = n, fill = "darkcyan")) +
  geom_text(aes(ordem, n, label = n, alpha = 0.5, hjust = -0.1), size = 2) +
  coord_flip() +
  scale_fill_manual(
    values = c("darkcyan","#A8E2E2")) +
  scale_x_discrete(name = "") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    axis.text = element_text(size = 6, face = "bold"),
    plot.title = element_text(size = 11),
    legend.position = "none",
    axis.title = element_text(size = 8, margin = margin(t = 10))
  ) +
  scale_y_log10(name = "", labels = scales::number_format(big.mark = ".")) +
  labs(title = "      Geral",
       y = "Número de espécies e de registros por ordem")

G_especies_registros_ordem_geral

```

```{r G_especies_registros_ordem_bioma_amazonia}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

# Gráfico do número de espécies e de registros por ordem - bioma amazônia

registros_especies_amazonia <- masto_aves %>%
  filter(!is.na(ordem)) |>
  filter(bioma == "Amazônia") |> 
  group_by(ordem) |> 
  summarise(count = n()) |> 
  arrange(desc(count))
  
G_especies_registros_ordem_bioma_amazonia <- numero_especies_por_ordem_bioma  |> 
  filter(bioma == "Amazônia") |> 
  ggplot() +
  geom_col(data = registros_especies_amazonia, aes(x = fct_reorder(ordem, count, .desc = F), y = count, fill = "darkgreen")) +
  geom_col(aes(x = fct_reorder(ordem, n, .desc = F), y = n, fill = "darkcyan")) +
  geom_text(aes(ordem, n, label = n, alpha = 0.5, hjust = -0.1), size = 2) +
  coord_flip() +
  scale_fill_manual(
    values = c("darkcyan","#A8E2E2")) +
  scale_x_discrete(name = "") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    axis.text = element_text(size = 6, face = "bold"),
    plot.title = element_text(size = 11),
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  scale_y_log10(name = "", labels = scales::number_format(big.mark = ".")) +
  labs(title = "      Amazônia",
       y = "Número de espécies e de registros por ordem")

G_especies_registros_ordem_bioma_amazonia


```

```{r G_especies_registros_ordem_bioma_mata_atlantica}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| 
# Gráfico do número de espécies e de registros por ordem - bioma mata atlântica

registros_especies_mata_atlantica <- masto_aves %>%
  filter(!is.na(ordem)) |>
  filter(bioma == "Mata Atlântica") |> 
  group_by(ordem) |> 
  summarise(count = n()) |> 
  arrange(desc(count))
  
G_especies_registros_ordem_bioma_mata_atlantica <- numero_especies_por_ordem_bioma  |> 
  filter(bioma == "Mata Atlântica") |> 
  ggplot() +
  geom_col(data = registros_especies_mata_atlantica, aes(x = fct_reorder(ordem, count, .desc = F), y = count, fill = "darkgreen")) +
  geom_col(aes(x = fct_reorder(ordem, n, .desc = F), y = n, fill = "darkcyan")) +
  geom_text(aes(ordem, n, label = n, alpha = 0.5, hjust = -0.1), size = 2) +
  coord_flip() +
  scale_fill_manual(
    values = c("darkcyan","#A8E2E2")) +
  scale_x_discrete(name = "") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    axis.text = element_text(size = 6, face = "bold"),
    plot.title = element_text(size = 11),
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  scale_y_log10(name = "", labels = scales::number_format(big.mark = ".")) +
  labs(title = "     Mata Atlântica",
       y = "Número de espécies e de registros por ordem")

G_especies_registros_ordem_bioma_mata_atlantica

```

```{r G_especies_registros_ordem_bioma_cerrado}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

# Gráfico do número de espécies e de registros por ordem - bioma cerrado

registros_especies_cerrado <- masto_aves %>%
  filter(!is.na(ordem)) |>
  filter(bioma == "Cerrado") |> 
  group_by(ordem) |> 
  summarise(count = n()) |> 
  arrange(desc(count))
  
G_especies_registros_ordem_bioma_cerrado <- numero_especies_por_ordem_bioma  |> 
  filter(bioma == "Cerrado") |> 
  ggplot() +
  geom_col(data = registros_especies_cerrado, aes(x = fct_reorder(ordem, count, .desc = F), y = count, fill = "darkgreen")) +
  geom_col(aes(x = fct_reorder(ordem, n, .desc = F), y = n, fill = "darkcyan")) +
  geom_text(aes(ordem, n, label = n, alpha = 0.5, hjust = -0.1), size = 2) +
  coord_flip() +
  scale_fill_manual(
    values = c("darkcyan","#A8E2E2")) +
  scale_x_discrete(name = "") +
  theme_minimal() +
  theme(
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    #panel.grid.major.x = element_blank(),
    axis.text = element_text(size = 6, face = "bold"),
    plot.title = element_text(size = 11),
    
    legend.position = "none",
    axis.title.x = element_text(size = 11, margin = margin(t = 10))
  ) +
  scale_y_log10(name = "", labels = scales::number_format(big.mark = ".")) +
  labs(title = "     Cerrado",
       y = "Número de espécies e de registros por ordem")

G_especies_registros_ordem_bioma_cerrado


```

```{r juntanto os gráficos de ordem e espécies, echo = FALSE}
#| label: fig-registros-ordem
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '80%'
#| fig-cap: "Representatividade das principais ordens de mamíferos amostradas no Programa Monitora, durante o período de 2014 a 2022. As barras em verde escuro representam o número de espécies registradas na ordem e as barras em verde claro o número de registros."


# G_ordem_especies_combinado <- 
# (G_especies_registros_ordem_geral + G_especies_registros_ordem_bioma_amazonia) /
# (G_especies_registros_ordem_bioma_mata_atlantica  + G_especies_registros_ordem_bioma_cerrado)
# 
# G_ordem_especies_combinado 

grid.arrange(G_especies_registros_ordem_geral, G_especies_registros_ordem_bioma_amazonia, G_especies_registros_ordem_bioma_mata_atlantica, G_especies_registros_ordem_bioma_cerrado,
             layout_matrix = matrix(c(1, 2, 3, 4), 
                                    byrow = TRUE, nrow = 2, ncol = 2))


```

Em relação aos mamíferos, primatas foram o grupo preponderante. As cinco famílias foram registradas e apenas o gênero *Callibella* sp. não foi observado. Setenta espécies diferentes foram registradas, o que corresponde a 84,7% do total de primatas brasileiros. Destas, 18 espécies são consideradas ameaçadas de extinção e duas possuem deficiência de dados (DD) para avaliação.

```{r tabela mamíferos}
#| label: tbl-lista-mamiferos
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| tab-cap: "Mamíferos registrados nas amostragens diurnas em transecções lineares do Programa Monitora, no período de 2014 a 2022. Os números entre parênteses correspondem ao número de espécies registradas para o táxon. Em vermelho estão os táxons ameaçados e sua respectiva categoria de ameaça. As espécies 'Deficientes em Dados (DD)' também estão indicadas."

tabela_mamiferos <- read.csv2("dados/tabelas/tabela_3.4.1.csv", encoding="UTF-8")

tab_mamiferos <- kbl(tabela_mamiferos,
             booktabs = TRUE,
             longtable = TRUE,
             # caption = "Espécies de aves migratórias e seus respectivos escores de vulnerabilidade usados na análise do Zonation.*",
            col.names = c("Ordem", "Família", "Táxon")) %>%
    column_spec(3, italic = TRUE) %>%
kable_styling(full_width = F, bootstrap_options = c("striped", "hover", "condensed", "responsive"), latex_options = c("repeat_header"), repeat_header_text = "\\textit{(continuação)}")

tab_mamiferos

```

Com relação as aves, até o momento, 38 táxons, entre gêneros e espécies, foram registrados (Apêndice D). Durante as amostragens busca-se a identificação no nível específico dos indivíduos observados, contudo, em algumas unidades ocorrem em simpatria duas, três ou mais espécies de um mesmo gênero, e, na maioria das vezes, essas espécies são semelhantes entre si. Isso faz com que, por segurança, a validação desses registros seja realizada no nível de gênero. São situações que podem ocorrer com os gêneros *Nothura* (codornas), *Penelope* (jacus), Tinamus (macucos) e *Crypturellus* (inhambus), todos estes gêneros com um ou mais táxons ameaçados de extinção (Apêndice D), conforme a Portaria MMA nº 148/22.

A grande maioria dos registros de Aves está quase igualmente distribuída entre Galliformes e Tinamídeos. Esse resultado se deve ao fato de a detecção do método ser eficiente para o registro desses grupos, mas também por Gruiformes (jacamins) ocorrerem apenas no bioma Amazônico, e nunca com mais de uma espécie por localidade, enquanto que Cariamiformes são típicos de ambientes abertos (fig-registros-ordem).

A variação entre as proporções de registros registadas para o Cerrado e a Mata Atlântica ao longo dos nove anos de amostragem deve-se ao pequeno número de unidades de conservação aderidas ao Programa Monitora, a inconstância nas amostragens e ao pequeno esforço amostral, seja por unidade de conservação, seja por bioma (@fig-registros-ordem).

```{r tabela aves}
#| label: tbl-lista-aves
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| tab-cap: "Táxons (gêneros e espécies) de aves registrados nas unidades de conservação amostradas no período de 2014 a 2022."

tabela_aves <- read.csv2("dados/tabelas/tabela_3.4.2.csv", encoding="UTF-8")

tab_aves <- kbl(tabela_aves,
             booktabs = TRUE,
             longtable = TRUE,
             # caption = "Espécies de aves migratórias e seus respectivos escores de vulnerabilidade usados na análise do Zonation.*",
            col.names = c("Ordem", "Família", "Táxon")) %>%
    column_spec(3, italic = TRUE) %>%
kable_styling(full_width = F, bootstrap_options = c("striped", "hover", "condensed", "responsive"), latex_options = c("repeat_header"), repeat_header_text = "\\textit{(continuação)}")


tab_aves

```

</br>

### Abundância relativa de mamíferos e aves por biomas

</br>

Em termos de abundância total de mamíferos e aves, o bioma Amazônico se destaca em relação aos outros dois biomas tratados. Enquanto que Cerrado e Mata Atlântica não parecem divergir de forma relevante (@fig-taxa-encontro-bioma). O valor médio da abundância relativa de mamíferos e aves no bioma Amazônia variou de ?? em 20?? a ?? avistamentos por 10 km percorridos em 20??, para mamíferos e ?? em 20?? a ?? em 20?? para aves.

```{r estimativas_taxas_de_encontro}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true


#### Cálculo das taxas de encontro 

# Checando os nomes das colunas

#names(masto_aves) 

# Preenchendo as linhas vazias da coluna esforço

masto_aves_esforco <-
  masto_aves |> 
  arrange(uc, ano, ea) |>
  fill(esforco)

# View(masto_aves_esforco) 


# Limpando a planilha - selecionando apenas colunas relevantes

masto_aves_esforco <- masto_aves_esforco |>
  select(
    cnuc,
    uc,
    bioma,
    ano,
    ea,
    everything(),
    -c(
      h_fim,
      cond_clim,
      populacao,
      tempo_censo,
      observadores,
      problema_amostragem,
      nome_ea,
      h_inicio,
      velocidade,
      n_guia,
      h_avistamento,
      observacoes
    )
   )

#glimpse(masto_aves_esforco)


#### Ajuste dos códigos CNUC --------------

masto_aves_esforco$cnuc <- as.character(masto_aves_esforco$cnuc)

masto_aves_esforco <- masto_aves_esforco %>% 
mutate(
  Cnuc = case_when(
    cnuc == "284" ~ "0000.00.0284",
    cnuc == "1626" ~ "0000.00.1626",
    cnuc == "179" ~ "0000.00.0179",
    cnuc == "189" ~ "0000.00.0189",
    cnuc == "207" ~ "0000.00.0207",
    cnuc == "232" ~ "0000.00.0232",
    cnuc == "238" ~ "0000.00.0238",
    cnuc == "241" ~ "0000.00.0241",
    cnuc == "242" ~ "0000.00.0242",
    cnuc == "257" ~ "0000.00.0257",
    cnuc == "285" ~ "0000.00.0285",
    cnuc == "169" ~ "0000.00.0169",
    cnuc == "174" ~ "0000.00.0174",
    cnuc == "210" ~ "0000.00.0210",
    cnuc == "258" ~ "0000.00.0258",
    cnuc == "260" ~ "0000.00.0260",
    cnuc == "163" ~ "0000.00.0163",
    cnuc ==  "67" ~ "0000.00.0067",
    cnuc == "118" ~ "0000.00.0118",
    cnuc == "136" ~ "0000.00.0136",
    cnuc ==  "47" ~ "0000.00.0047",
    cnuc ==  "57" ~ "0000.00.0057",
    cnuc ==  "60" ~ "0000.00.0060",
    cnuc ==  "61" ~ "0000.00.0061",
    cnuc ==  "68" ~ "0000.00.0068",
    cnuc == "123" ~ "0000.00.0123",
    cnuc ==  "76" ~ "0000.00.0076",
    cnuc == "139" ~ "0000.00.0139",
    cnuc == "142" ~ "0000.00.0142",
    cnuc == "143" ~ "0000.00.0143",
    cnuc == "148" ~ "0000.00.0148",
    cnuc == "149" ~ "0000.00.0149",
    cnuc == "151" ~ "0000.00.0151",
    cnuc == "152" ~ "0000.00.0152",
    cnuc == "172" ~ "0000.00.0172",
    cnuc == "173" ~ "0000.00.0173",
    cnuc == "178" ~ "0000.00.0178",
    cnuc == "187" ~ "0000.00.0187",
    cnuc == "188" ~ "0000.00.0188",
    cnuc == "196" ~ "0000.00.0196",
    cnuc == "202" ~ "0000.00.0202",
    cnuc == "208" ~ "0000.00.0208",
    cnuc == "211" ~ "0000.00.0211",
    cnuc == "213" ~ "0000.00.0213",
    cnuc == "221" ~ "0000.00.0221",
    cnuc == "222" ~ "0000.00.0222",
    cnuc == "256" ~ "0000.00.0256",
    cnuc == "259" ~ "0000.00.0259",
    cnuc == "274" ~ "0000.00.0274",
    cnuc == "281" ~ "0000.00.0281",
    cnuc == "1633" ~ "0000.00.1633",
    cnuc == "1810" ~ "0000.00.1810"))
    
#unique(masto_aves_esforco$Cnuc)
#View(masto_aves_esforco)

# cnuc <- masto_aves_esforco |>
#   distinct(uc, Cnuc) |>
#   arrange()
# 
# cnuc
  
```

```{r calculando_esforço_por_trilha}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true


#### Calculando o esforço por trilha (ea)


# Visualizando o esforço por trilha por dia em cada ano e UC

#unique(masto_aves_esforco$esforco) # Valores únicos de esforço

esforco_dia_trilha <- masto_aves_esforco  |> 
  distinct(uc, bioma, grupo, ano, ea, data, esforco) 
  
#View(esforco_dia_trilha)


esforco_dia_trilha_rep <- masto_aves_esforco  |> # número amostragens por trilha
  distinct(uc, bioma, grupo, ano, ea, data, esforco) |> 
  count(uc, bioma, grupo, ano, ea, esforco)

#View(esforco_dia_trilha_rep)

## Estimando o esforço total naquela trilha por ano por UC

esforco_total_trilha <- esforco_dia_trilha |> # esforço total por trilha
  group_by(uc, bioma, grupo, ano, ea) |>
  summarise(extensao = sum(esforco))

#View(esforco_total_trilha)

# Checando trilhas com esforço > 50 km

trilhas_esforco_total_maior_50km <- esforco_total_trilha |>
  filter(extensao > 50)

# print(trilhas_esforco_total_maior_50km, n = 70)
# View(trilhas_esforco_total_maior_50km)

```

```{r taxa_encontro_total}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true


#### Calculando o número de registros total

registros_total_trilha <- masto_aves_esforco |>
  group_by(uc, bioma, grupo, ano, ea)  |>
  count() |>
  drop_na()

#View(registros_total)

# juntanto tabelas esforco_total + registros_total

taxa_encontro_trilha_total <-
  left_join(registros_total_trilha, esforco_total_trilha, c("uc", "bioma", "grupo", "ano", "ea"))

#View(taxa_encontro_trilha_total)

taxa_encontro_trilha_total <- taxa_encontro_trilha_total |>
  mutate(taxa_encontro = (n/extensao) * 10)

#View(taxa_encontro_trilha_total)


# Taxa de encontro média/UC/ano

taxa_encontro_trilha_total_media <- taxa_encontro_trilha_total |>
  group_by(uc, bioma, grupo, ano) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n))
  )

#View(taxa_encontro_trilha_total_media)

```

```{r cálculo da taxa de encontro média do período - 2014-2022}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

## Calculando o número de registros total

registros_total_uc_ano <- masto_aves_esforco |>
  group_by(uc, Cnuc, bioma, grupo, ano)  |>
  count() |>
  drop_na()

#View(registros_periodo_amostragem)

esforco_total_uc_ano <- esforco_total_trilha |> 
  group_by(uc, bioma, grupo, ano) |>
  summarise(extensao_total = sum(extensao))

#View(esforco_total_uc)
  

# juntanto tabelas esforco + registros_total

taxa_encontro_geral_uc_ano <-
  left_join(registros_total_uc_ano, esforco_total_uc_ano, c("uc", "bioma", "grupo", "ano"))

#View(taxa_encontro_periodo_amostragem)

taxa_encontro_geral_uc_ano <- taxa_encontro_geral_uc_ano |>
  mutate(taxa_encontro = (n / extensao_total) * 10)

#View(taxa_encontro_periodo_amostragem)


taxa_encontro_geral_uc <- taxa_encontro_geral_uc_ano |>
  group_by(uc, Cnuc, bioma, grupo) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975)*ep,
  )


#View(taxa_encontro_periodo_amostragem)

write.csv(taxa_encontro_geral_uc, "dados/planilhas/taxa_encontro_geral_uc.csv", row.names = FALSE)

```

```{r processamento dados - mapa taxa de encontro geral}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

#ucs_monitora <- read_csv("dados/ucs_federais_cnuc_15.09.2023.csv")
#
# ucs_monitora$lat <- as.numeric(ucs_monitora$lat)
# ucs_monitora$long <- as.numeric(ucs_monitora$long)

#UC <-  readOGR("shapes/LimiteUCsFederais_jun_23.shp", verbose = FALSE)

#brasil <- read_country()

#brasil_regioes <- read_region()
brasil_regioes <- readOGR("shapes/regioes_2010.shp", verbose = FALSE)

ucs_comp_florestal <-  readOGR("shapes/ucs_comp_florestal.shp", verbose = FALSE)

#C_monitora <-  readOGR("shapes/ucs_monitora_jun_23.shp", verbose = FALSE)

taxa_encontro_geral <- read_csv("dados/planilhas/taxa_encontro_geral_uc.csv")


#taxa_encontro_geral_cnuc <- taxa_encontro_geral |> rename(Cnuc = cnuc)

#View(taxa_encontro_geral_cnuc)

ucs_comp_florestal_unido <- sp::merge(ucs_comp_florestal, taxa_encontro_geral, by = "Cnuc")


#ucs_comp_florestal_unido
ucs_comp_florestal_unido$taxa_enc_media <- round(ucs_comp_florestal_unido$taxa_enc_media, 2)

#ucs_comp_florestal_unido

# ucs <- st_read("shapes/ucs_comp_florestal.shp")
# brasil <- st_read("shapes/lim_pais_a.shp")
#
# library(sf)
# library(ggplot2)

```

```{r taxa de encontro geral por classe - mamíferos e aves - 2014 a 2022}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

## Calculando o número de registros total

registros_total_classe_ano <- masto_aves_esforco |>
  group_by(uc, bioma, grupo, ano, classe)  |>
  count() |>
  drop_na()

#View(registros_periodo_amostragem_classe)

esforco_total_uc_ano <- esforco_total_trilha |> 
  group_by(uc, bioma, grupo, ano) |>
  summarise(extensao_total = sum(extensao))

#View(esforco_total_uc)
  

# juntanto tabelas esforco + registros_total

taxa_encontro_total_classe_ano <-
  left_join(registros_total_classe_ano, esforco_total_uc_ano, c("uc", "bioma", "grupo", "ano"))

#View(taxa_encontro_periodo_amostragem_classe)

taxa_encontro_total_classe_ano <- taxa_encontro_total_classe_ano |>
  mutate(taxa_encontro = (n / extensao_total) * 10)

#View(taxa_encontro_periodo_amostragem_classe)


taxa_encontro_total_classe <- taxa_encontro_total_classe_ano |>
  group_by(uc, bioma, grupo, classe) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975)*ep 
  )


#View(taxa_encontro_periodo_amostragem_classe)

```

```{r cálculo da taxa de encontro por classe}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true


## Calculando o número de registros por classe, por trilha, por ano e por UC

registros_classe <- masto_aves_esforco |>
  group_by(uc, ano, bioma, ea, classe)  |>
  count() |>
  drop_na(classe)

#View(registros_classe)


# juntanto tabelas esforco + registros_classe

taxa_encontro_trilha_classe <-
  left_join(registros_classe, esforco_total_trilha, c("uc", "bioma", "ano", "ea"))

#View(taxa_encontro_trilha_classe)

taxa_encontro_trilha_classe <- taxa_encontro_trilha_classe |>
  mutate(taxa_encontro = (n / extensao) * 10)

#View(taxa_encontro_trilha_classe)


taxa_encontro_trilha_classe <- taxa_encontro_trilha_classe |>
  group_by(uc, bioma, ano, classe) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975) * ep)
  
#View(taxa_encontro_trilha_classe)

```

```{r G_taxa_encontro_geral_bioma_emparelhado_media_IC A}
#| label: fig-taxa-encontro-bioma
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Taxa de avistamento média de aves e mamíferos por bioma para o período de 2014 a 2022."

# Taxa de encontro geral mamíferos e aves por bioma - emparelhado

G_taxa_encontro_geral_bioma_emparelhado_media_IC <- taxa_encontro_total_classe |> 
 group_by(bioma, classe) |> 
 summarise(
     n = n(),
     taxa_enc_media_bioma = mean(taxa_enc_media),
       dp = sd(taxa_enc_media, na.rm = TRUE),
       ep = dp / sqrt(n),
       IC_95 = qnorm(.975) * ep) |> 

  # View(G_taxa_encontro_geral_bioma_emparelhado_media_IC)

  ggplot(aes(
    x = fct_reorder(bioma, taxa_enc_media_bioma, .desc = T),
    y = taxa_enc_media_bioma), color = classe) +
  geom_pointrange(
    aes(color = classe, ymin = taxa_enc_media_bioma - IC_95, ymax =             taxa_enc_media_bioma + IC_95), 
    position = position_dodge2(width = 0.5),
    width = 0.5,
    #size = 0.5,
    linewidth = 0.7
  ) +
  geom_point(aes(colour = classe), size = 3, position = position_dodge2(width = 0.5)) +
  scale_color_manual(values = c("#359780", "#BF8120")) +
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.text = element_text(size = 10),
        legend.title = element_blank(),
        legend.position = c(0.75, 0.8),
        axis.text=element_text(size=13),
        axis.title.y = element_text(size = 13, margin = margin(r = 20))) +
        scale_x_discrete(name = " ") +
        scale_y_continuous(limits = c(0, 15)) +
  labs(title = " ", x = " ", y = "Avistamentos/10 km")


G_taxa_encontro_geral_bioma_emparelhado_media_IC

# ggsave("imagens/cap05/G_taxa_encontro_geral_bioma_emparelhado_media_IC.png", 
#        height = 4.5, width = 6, units = "in", dpi = 300)

```

O valor médio da abundância relativa de mamíferos e aves no bioma Amazônia variou de ?? em 20?? a ?? avistamentos por 10 km em 20??, para mamíferos e de ?? em 20?? a ?? avistamentos por 10 km em 20??, para aves. Quando se observa como essa abundância total de mamíferos e aves variou entre os anos para os biomas (@fig-taxa-encontro-tempo), verificamos que para a Amazônia os primeiros anos apresentam uma maior dispersão dos resultados obtidos explicada pelo proporcionalmente reduzido de UCs participantes e esforço amostral, e um leve decréscimo nas abundâncias totais entre 2021 e 2022. Para a Mata Atlântica os resultados não são consistentes devido a descontinuidade de amostragem e variação no esforço entre os anos, já para o Cerrado, o padrão observado se justifica...xxxxxxxxx

</br>

### Taxa de encontro de mamíferos e aves ao longo do tempo - geral e por bioma - 2014 a 2022

</br>


```{r G_taxa_encontro_geral_mamiferos_aves_2014-2022_media_IC}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true


# Taxa de encontro geral mamíferos e aves emparelhado - 2014-2022

G_taxa_encontro_geral_periodo_emparelhado_media_IC <- taxa_encontro_total_classe_ano |> 
 filter(ano != 2023) |> 
 group_by(ano, classe) |> 
 summarise(
     n = n(),
     taxa_encontro_media = mean(taxa_encontro),
       dp = sd(taxa_encontro, na.rm = TRUE),
       ep = dp / sqrt(n),
       IC_95 = qnorm(.975) * ep) |> 

  ggplot(aes(
    x = ano,
    y = taxa_encontro_media), color = classe) +
  geom_pointrange(
    aes(color = classe, ymin = taxa_encontro_media - IC_95, ymax = taxa_encontro_media + IC_95), 
    position = position_dodge2(width = 0.5),
    width = 0.5,
    #size = 1.5,
    linewidth = 0.7) +
  scale_color_manual(values = c("#359780", "#BF8120")) +
  geom_point(aes(color = classe), width = 0.5, size = 1.5, position = position_dodge2(width = 0.5)) +
  
  geom_hline(aes(yintercept = 8.27), colour = "#BF8120", show.legend = FALSE, linewidth = 0.5) +
  geom_abline(aes(slope = 0, intercept = 4.82), colour = "#359780", show.legend = FALSE, linewidth = 0.5) +
  
  scale_color_manual(values = c("#359780", "#BF8120", "#359780", "#BF8120")) +
  
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        #legend.title = element_blank(),
        #legend.title = element_text(size = 9),
        #legend.position = c(0.87, 0.80),
        legend.position = "none",
        plot.title = element_text(size = 10),
        axis.text=element_text(size=8),
        axis.text.x = element_blank(),
        axis.title.y = element_text(size = 9, margin = margin(r = 10))) +
        #scale_x_discrete(name = " ") +
        scale_y_continuous(limits = c(0, 20)) +
  labs(title = "Geral", colour = "Geral", x = NULL, y = "Avistamentos/10 km")


G_taxa_encontro_geral_periodo_emparelhado_media_IC

# ggsave("imagens/cap05/G_taxa_encontro_geral_periodo_emparelhado_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)


```

```{r G_taxa_encontro_mamiferos_aves_amazonia_2014-2022_media_IC}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

# Taxa de encontro geral mamíferos e aves emparelhado - 2014-2022

G_taxa_encontro_amazonia_periodo_emparelhado_media_IC <- taxa_encontro_total_classe_ano |> 
 filter(bioma == "Amazônia" & ano != 2023) |> 
 group_by(ano, classe) |> 
 summarise(
     n = n(),
     taxa_encontro_media = mean(taxa_encontro),
       dp = sd(taxa_encontro, na.rm = TRUE),
       ep = dp / sqrt(n),
       IC_95 = qnorm(.975) * ep) |> 

  ggplot(aes(
    x = ano,
    y = taxa_encontro_media)) +
  geom_pointrange(
    aes(color = classe, ymin = taxa_encontro_media - IC_95, ymax = taxa_encontro_media + IC_95), 
    #position = "dodge2",
    position = position_dodge2(width = 0.5),
    width = 0.5,
    #size = 0.6,
    linewidth = 0.7) +
  #scale_color_manual(values = c("#359780", "#BF8120", "red", "blue")) +
  geom_point(aes(colour = classe), size = 1.5, position = position_dodge2(width = 0.5)) +
  geom_hline(aes(yintercept = 9.34), colour = "#BF8120", show.legend = FALSE, linewidth = 0.5) +
  geom_abline(aes(slope = 0, intercept = 5.27), colour = "#359780", show.legend = FALSE, linewidth = 0.5) +
  
  scale_color_manual(values = c("#359780", "#BF8120", "#359780", "#BF8120")) +
 
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.title = element_blank(),
        #legend.title = element_text(size = 9),
        legend.position = c(0.75, 0.87),
        legend.text = element_text(size = 9),
        #legend.position = "none",
        plot.title = element_text(size = 10),
        axis.text=element_text(size=8),
        axis.text.x = element_blank(),
        axis.title.y = element_text(size = 9, margin = margin(r = 10))) +
        #scale_x_discrete(name = " ") +
        scale_y_continuous(limits = c(0, 20)) +
  labs(title = "Amazônia", colour = "Amazônia", x = NULL, y = NULL)


G_taxa_encontro_amazonia_periodo_emparelhado_media_IC

# ggsave("imagens/cap05/G_taxa_encontro_amazonia_periodo_emparelhado_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r  G_taxa_encontro_mamiferos_aves_mata_atlantica_2014-2022_media_IC}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

# Taxa de encontro geral mamíferos e aves emparelhado - 2014-2022

G_taxa_encontro_mata_atlantica_periodo_emparelhado_media_IC <- taxa_encontro_total_classe_ano |> 
 filter(bioma == "Mata Atlântica" & ano != 2023) |> 
 group_by(ano, classe) |> 
 summarise(
     n = n(),
     taxa_encontro_media = mean(taxa_encontro),
       dp = sd(taxa_encontro, na.rm = TRUE),
       ep = dp / sqrt(n),
       IC_95 = qnorm(.975) * ep) |> 

  ggplot(aes(
    x = ano,
    y = taxa_encontro_media)) +
  geom_pointrange(
    aes(color = classe, ymin = taxa_encontro_media - IC_95, ymax = taxa_encontro_media + IC_95), 
    #position = "dodge2",
    position = position_dodge2(width = 0.5),
    width = 0.5,
    #size = 0.6,
    linewidth = 0.7) +
  scale_color_manual(values = c("#359780", "#BF8120")) +
  geom_point(aes(colour = classe), size = 1.5, position = position_dodge2(width = 0.5)) +
  
  geom_hline(aes(yintercept = 3.17), colour = "#BF8120", show.legend = FALSE, linewidth = 0.5) +
  geom_abline(aes(slope = 0, intercept = 1.84), colour = "#359780", show.legend = FALSE, linewidth = 0.5) +
  
  scale_color_manual(values = c("#359780", "#BF8120", "#359780", "#BF8120")) +
  
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        #legend.title = element_blank(),
        #legend.title = element_text(size = 9),
        #legend.position = c(0.77, 0.80),
        legend.position = "none",
        plot.title = element_text(size = 10),
        axis.text=element_text(size=8),
        axis.title.y = element_text(size = 9, margin = margin(r = 10))) +
        #scale_x_discrete(name = " ") +
        scale_y_continuous(limits = c(-5, 15)) +
        scale_x_continuous(breaks = taxa_encontro_trilha_classe$ano) +
  labs(title = "Mata Atlântica", colour = "Mata Atlântica", x = "Ano", y = "Avistamentos/10 km")
  
G_taxa_encontro_mata_atlantica_periodo_emparelhado_media_IC

# ggsave("imagens/cap05/G_taxa_encontro_mata_atlantica_periodo_emparelhado_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_mamiferos_aves_cerrado_2014-2022_media_IC}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true

# Taxa de encontro geral mamíferos e aves emparelhado - 2014-2022

G_taxa_encontro_cerrado_periodo_emparelhado_media_IC <- taxa_encontro_total_classe_ano |>
 filter(bioma == "Cerrado" & ano != 2023) |>
 group_by(ano, classe) |>
 summarise(
     n = n(),
     taxa_encontro_media = mean(taxa_encontro),
       dp = sd(taxa_encontro, na.rm = TRUE),
       ep = dp / sqrt(n),
       IC_95 = qnorm(.975) * ep) |>
  
    ggplot(aes(
    x = ano,
    y = taxa_encontro_media)) +
  geom_pointrange(
    aes(color = classe, ymin = taxa_encontro_media - IC_95, ymax = taxa_encontro_media + IC_95), 
    #position = "dodge2",
    position = position_dodge2(width = 0.5),
    width = 0.5,
    #size = 0.6,
    linewidth = 0.7) +
  scale_color_manual(values = c("#359780", "#BF8120")) +
  geom_point(aes(colour = classe), size = 1.5, position = position_dodge2(width = 0.5)) +
  
  geom_hline(aes(yintercept = 4.07), colour = "#BF8120", show.legend = FALSE, linewidth = 0.5) +
  geom_abline(aes(slope = 0, intercept = 3.26), colour = "#359780", show.legend = FALSE, linewidth = 0.5) +
  
  scale_color_manual(values = c("#359780", "#BF8120", "#359780", "#BF8120")) +

  
  theme_minimal() +
  theme(axis.line.x=element_blank(),
        axis.line.y=element_blank(),
        axis.ticks.y = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.major.x = element_blank(),
        #legend.title = element_blank(),
        #legend.title = element_text(size = 9),
        #legend.position = c(0.75, 0.84),
        legend.position = "none",
        plot.title = element_text(size = 10),
        axis.text=element_text(size=8),
        axis.title.y = element_text(size = 9, margin = margin(r = 10))) +
        #scale_x_discrete(name = " ") +
        scale_y_continuous(limits = c(-5, 15)) +
        scale_x_continuous(breaks = taxa_encontro_trilha_classe$ano) +
        
  labs(title = "Cerrado", colour = "Cerrado", x = "Ano", y = NULL)

G_taxa_encontro_cerrado_periodo_emparelhado_media_IC

# ggsave("imagens/cap05/G_taxa_encontro_cerrado_periodo_emparelhado_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r juntanto os gráficos taxas de encontro ao longo do tempo por bioma}
#| label: fig-taxa-encontro-tempo
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '85%'
#| fig-cap: "Variação anual na taxa de avistamento média de aves e mamíferos no período de 2014 a 2022 (geral e por bioma). As linhas horizontais representam a taxa de avistamento média para cada grupo considerando todo o período amostral."

# G_taxas_encontro_geral_biomas <- 
# (G_taxa_encontro_geral_periodo_emparelhado_media_IC + G_taxa_encontro_amazonia_periodo_emparelhado_media_IC) /
# (G_taxa_encontro_mata_atlantica_periodo_emparelhado_media_IC  + G_taxa_encontro_cerrado_periodo_emparelhado_media_IC)
# 
# G_taxas_encontro_geral_biomas 

# ggsave("imagens/cap05/G_taxas_encontro_geral_biomas.png", height = 4.5, width = 6, units = "in", dpi = 300)


grid.arrange(G_taxa_encontro_geral_periodo_emparelhado_media_IC, G_taxa_encontro_amazonia_periodo_emparelhado_media_IC, G_taxa_encontro_mata_atlantica_periodo_emparelhado_media_IC, G_taxa_encontro_cerrado_periodo_emparelhado_media_IC,
             layout_matrix = matrix(c(1, 2, 3, 4), 
                                    byrow = TRUE, nrow = 2, ncol = 2))

```
</br>

### Abundância de mamíferos e aves nas unidades de conservação

</br>

Entre as UCs com maiores taxas totais para mamíferos encontramos a Rebio do Uatumã, a Resex Verde para Sempre e a Esec da Terra do Meio (@fig-taxa-encontro-geral-mamiferos), estas três UCs também estão entre as quatro UCs com maiores taxas totais para aves (@fig-taxa-encontro-geral-aves). Contudo, a posição da Resex Verde para Sempre deve ser tomada com cautela visto que representa um único ano de amostragem (2022). Uma visão espacial da taxa de avistamento média geral, considerando conjuntamente aves e mamíferos, é apresentada na figura @fig-taxa-encontro-mapa.

```{r G_taxa_encontro_geral_mamiferos_media_IC}
#| label: fig-taxa-encontro-geral-mamiferos
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Taxa média de avistamento de aves por unidade de conservação, para o período de 2014 a 2022."

# Gráfico da taxa de encontro total - mamíferos média e IC

cores_biomas <- c("cyan4", "#BF8120", "#95D8D8")

G_taxa_encontro_geral_mamiferos_media_IC <- taxa_encontro_total_classe |>
  filter(classe == "Mammalia") |> 

  ggplot(aes(
    x = fct_reorder(uc, taxa_enc_media, .desc = F),
    y = taxa_enc_media)) +
  geom_point(size = 1) +
  geom_pointrange(
    aes(color = bioma, ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    size = 0.3,
    linewidth = 0.4) +
    #colour = "#BF8120") +
  
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(name = "Avistamentos/10 km") +
  scale_color_manual(values = cores_biomas) +
  theme_minimal() +
  theme(#panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        #axis.text=element_text(size=10),
        axis.text.y = element_text(size = 6, face = "bold"),
        axis.title.x = element_text(size = 10, margin = unit(c(3, 0, 0, 0), "mm"))) +
        
  labs(title = "Mamíferos", col = NULL)

G_taxa_encontro_geral_mamiferos_media_IC

# ggsave("imagens/cap05/G_taxa_encontro_geral_mamiferos_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r G_taxa_encontro_geral_aves_media_IC}
#| label: fig-taxa-encontro-geral-aves
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Taxa média de avistamento de aves por unidade de conservação, para o período de 2014 a 2022."

# Gráfico da taxa de encontro total 2014 a 2022 - aves média e IC


G_taxa_encontro_geral_aves_media_IC <- taxa_encontro_total_classe |>
  filter(classe == "Aves") |>

    ggplot(aes(
    x = fct_reorder(uc, taxa_enc_media, .desc = F),
    y = taxa_enc_media
  )) +
  geom_point(size = 1) +
  geom_pointrange(
    aes(color = bioma, ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
    size = 0.3,
    linewidth = 0.4) +
    
  coord_flip() +
  scale_x_discrete(name = " ") +
  scale_y_continuous(limits = c(0, 15), name = "Avistamentos/10 km") +
  scale_color_manual(values = cores_biomas) +
  theme_minimal() +
  theme(#panel.grid.minor.y = element_blank(),
        #panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        #panel.grid.major.x = element_blank(),
        #axis.text=element_text(size=10),
        axis.text.y = element_text(size = 6, face = "bold"),
        axis.title.x = element_text(size = 10, margin = unit(c(3, 0, 0, 0), "mm"))) +
  
  labs(title = "Aves", col = NULL)

G_taxa_encontro_geral_aves_media_IC

# ggsave("imagens/cap05/G_taxa_encontro_geral_aves_media_IC.png", height = 4.5, width = 6, units = "in", dpi = 300)

```
</br>

###### Variação espacial na taxa de encontro média - mamíferos e aves conjuntamente

</br>

<center>

```{r mapa taxas de encontro - geral}
#| label: fig-taxa-encontro-mapa
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Distribuição espacial das taxas médias de avistamento de mamíferos e aves (taxa geral, consierando conjuntamente os dois grupos) registradas nas unidades de conservação integrantes do Programa Monitora de 2014 a 2022."


backg <- htmltools::tags$style(".leaflet-container { background: white; }" )

colours_red <- colorNumeric(palette = "Reds", domain = NULL)

mapa <- leaflet(ucs_comp_florestal_unido) |>

  #Base groups
  setView(lng = -58, lat = -14,
           zoom = 4) %>%
   #addProviderTiles(providers$Stamen.TonerLite, group = "Stamen Toner Lite") %>%
  # addProviderTiles(providers$OpenStreetMap.Mapnik, group = "Open Street Map") %>%
   addProviderTiles(providers$Esri.WorldImagery, group = "Imágenes de ESRI") %>%
  # addProviderTiles(providers$Esri.NatGeoWorldMap, group = "Esri.NatGeoWorldMap") %>%

  
  # addPolygons(data = brasil, weight = 0.3,
  #             color = "black",
  #             fillColor = "white") |> 
  
  addPolygons(data = brasil_regioes, weight = 0.3,
              color = "black",
              fillColor = "white") |>
  
  addPolygons(data = ucs_comp_florestal_unido,
    fillColor = ~ colours_red(ucs_comp_florestal_unido$taxa_enc_media),
    fillOpacity = 1,
    weight = 0.3,
    color = "black",
    popup = paste("Nome: ", ucs_comp_florestal_unido$uc, "<br>",
                  "Bioma: ", ucs_comp_florestal_unido$BiomaCRL, "<br>",
                  "Taxa de avistamento: ", ucs_comp_florestal_unido$taxa_enc_media, "<br>")) |>
  
  htmlwidgets::prependContent(backg) |> 

  addLegend(
    pal = colours_red,
    values = ~ ucs_comp_florestal_unido$taxa_enc_media,
    title = "Taxa de avistamento",
    position = "bottomleft"
  ) |>

# Layers Control

    addLayersControl(
        baseGroups = c(#"StamenTonerLite",
                       "Open Street Map",
                       "Imágenes de ESRI"),
                       #"Esri.NatGeoWorldMap"),
        position = "topright")

mapa
 

```

</center>


```{r cálculos registros por espécie, por trilha, por ano e por UC}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true


## Calculando o número de registros por espécie, por trilha, por ano e por UC

registros_taxon_validado <- masto_aves_esforco |>
  group_by(uc, ano, ea, classe, taxon_validado) |>
  count() |>
  drop_na(taxon_validado)

# View(registros_taxon_validado)


# Juntanto tabelas esforco + registros_taxon_validado

taxa_encontro_trilha_taxon_validado <-
  left_join(registros_taxon_validado,
            esforco_total_trilha,
            c("uc", "ano", "ea"))

#View(taxa_encontro_trilha_taxon_validado)

taxa_encontro_trilha_taxon_validado <-
  taxa_encontro_trilha_taxon_validado |>
  mutate(taxa_encontro = (n / extensao) * 10)

#View(taxa_encontro_trilha_taxon_validado)


# Taxa de encontro de espécies por UC e por ano

taxa_encontro_trilha_taxon_validado_ano <-
  taxa_encontro_trilha_taxon_validado |>
  group_by(uc, ano, classe, taxon_validado) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975) * ep)


#View(taxa_encontro_trilha_taxon_validado_ano)


# Taxa de encontro de espécies de mamíferos por UC

taxa_encontro_trilha_taxon_validado_mamiferos <-
  taxa_encontro_trilha_taxon_validado |>
  filter(classe == "Mammalia") |>
  group_by(uc, taxon_validado) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975) * ep)

#View(taxa_encontro_trilha_taxon_validado_mamiferos)

# Taxa de encontro de espécies de aves por UC

taxa_encontro_trilha_taxon_validado_aves <-
  taxa_encontro_trilha_taxon_validado |>
  filter(classe == "Aves") |>
  group_by(uc, taxon_validado) |>
  summarise(
    n = n(),
    taxa_enc_media = mean(taxa_encontro),
    dp = sd(taxa_encontro),
    ep = dp / (sqrt(n)),
    IC_95 = qnorm(.975) * ep)

#View(taxa_encontro_trilha_taxon_validado_aves)

```

</br>

### Considerações sobre algumas espécie ameaçadas

</br>

Dentre as espécies de aves alvo deste protocolo, quatorze espécies ameaçadas ocorrem ou poderia ser esperado que ocorressem nas 52 unidades de conservação analisadas. A saber, *Nothura minor*, *Taoniscus nanus*, *Crypturellus zabele*, *Tinamus tao*, *Aburria jacutinga* e *A. cujubi*, *Penelope jacucaca* e *P. pileata*, *Crax blumenbachii* e *C. globulosa*, *Psophia obscura*, *P. interjecta*, *P. viridis* e *P. dextralis*, mais duas subespécies, no caso *Penelope s. alagoensis* e *Crax f. pinima*.

Destes foram registrados *Aburria cujubi*, *Crax globulosa* e as quatro espécies ameaçadas de *Psophia*. Bem como, a subespécie ameaçada de *Penelope*). No entanto, ressaltamos que *Tinamus tao*, *Penelope pileata*, *P. jacucaca* e *Nothura minor* foram ou poderiam ter sido registrados em campo, porém, como ocorrem em simpatria com espécies semelhantes, seus dados foram validados em nível de gênero.

Importante ressaltar a ausência de registros de *A. jacutinga*, que seria esperada para quatro UCs na Mata Atlântica, na região Sul e Sudeste, dada sua distribuição geográfica original.

```{r preparando os dados de espécies ameaçadas}
#| echo: false
#| include: false
#| message: false
#| warning: false
#| cache: true


lista_spp_ameacadas_salve <-
  read_csv2("dados/dados_brutos/lista_spp_ameacadas_salve_ajustada_cemave_cpb_13.12.203.csv")

#View(lista_spp_ameacadas_salve)

lista_spp_ameacadas_salve <- lista_spp_ameacadas_salve |>
  rename(taxon_validado = nome_cientifico)

taxa_encontro_spp_ameacadas <- left_join(taxa_encontro_trilha_taxon_validado, lista_spp_ameacadas_salve, by = "taxon_validado")

#View(taxa_encontro_spp_ameacadas)

taxa_encontro_spp_ameacadas <- taxa_encontro_spp_ameacadas |>
  select(-classe.y) |> 
  rename(classe = classe.x) |> 
  filter(!is.na(categoria))


#View(taxa_encontro_spp_ameacadas)


taxa_encontro_spp_ameacadas_uc <- taxa_encontro_spp_ameacadas |>
  group_by(uc, taxon_validado) |> 
  count()

#View(taxa_encontro_spp_ameacadas_uc)

```

</br>

#### Abundância para algumas espécies ameaçadas de mamíferos e aves

</br>

```{r figura das espécies ameaçadas no tempo - primatas Atelídeos}
#| label: fig-especies-ameacadas-atelideos
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Taxas médias de avistamento estimadas por ano para duas espécies de primatas atelídeos ameaçados. Os pontos representam valores médios obtidos a partir das taxas registradas para diferentes unidades de conservação. As barras de variação e o número de registros para cada ano não são apresentados para maior clareza da figura."

cor_ameacadas2 <- c("#008B8B", "#666666", "#BF8120", "brown")



G_especie_ameacada_ucs_ano_media_primatas_atelideos <- taxa_encontro_spp_ameacadas |>
  group_by(ano, classe, ordem, taxon_validado, categoria) |> 
  filter(taxon_validado %in% c("Ateles chamek", "Ateles marginatus")) |>
  summarise(n = n(),
            taxa_enc_media = mean(taxa_encontro),
            sd = sd(taxa_encontro),
            ep = sd / sqrt(n),
            IC_95 = qnorm(.975) * ep) |> 

  ggplot(aes(
    x = ano,
    y = taxa_enc_media, color = taxon_validado, shape = categoria)) +
  # geom_errorbar(
  #   aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
  #   size = 0.8,
  #   linewidth = 0.5,
  #   width = 0.1,
  #   colour = "cyan4") +
  geom_line(size = 0.5) +
  geom_point(size = 3, alpha = 0.8) +
  
    theme_minimal() +
    theme(
      panel.grid.minor.y = element_blank(),
      #panel.grid.major.y = element_blank(),
      panel.grid.minor.x = element_blank(),
      panel.grid.major.x = element_blank(),
      axis.text=element_text(size=10),
      axis.text.x = element_text(size = 12),
      axis.text.y = element_text(size = 11),
      axis.title.y = element_text(size = 11, margin = margin(r = 10)),
      axis.title.x = element_text(size = 11, margin = margin(t = 10)),
      #axis.line.y = element_line(),
      #axis.ticks.y = element_line(),
      title = element_text(size = 10),
      legend.text=element_text(size=10),
      legend.position = "right",
      legend.title = element_blank()) +
      scale_color_manual(values = cor_ameacadas2) +
      scale_y_continuous(limits = c(0, 1.5)) +
      scale_x_continuous(breaks = taxa_encontro_spp_ameacadas$ano) +
      labs(title = "Primatas - Atelídeos",
       x = "Ano",
       y = "Avistamentos/10 km",
       col = NULL)

G_especie_ameacada_ucs_ano_media_primatas_atelideos

# ggsave("imagens/cap05/G_especie_ameacada_ucs_ano_media_primatas_atelideos.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r figura das espécies ameaçadas no tempo - Outros primatas}
#| label: fig-especies-ameacadas-outros-primatas
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Taxas médias de avistamento estimadas por ano para cinco espécies de primatas ameaçados. Os pontos representam valores médios obtidos a partir das taxas registradas para diferentes unidades de conservação. As barras de variação e o número de registros para cada ano não são apresentados para maior clareza da figura."



cor_ameacadas1 <- c("#008B8B", "#70C4C4", "#666666", "#BF8120", "brown")



G_especie_ameacada_ucs_ano_media_outros_primatas <- taxa_encontro_spp_ameacadas |>
  group_by(ano, classe, ordem, taxon_validado, categoria) |> 
  filter(taxon_validado %in% c("Cebus kaapori", "Sapajus cay", "Mico rondoni", "Chiropotes satanas", "Chiropotes utahickae")) |>
  summarise(n = n(),
            taxa_enc_media = mean(taxa_encontro),
            sd = sd(taxa_encontro),
            ep = sd / sqrt(n),
            IC_95 = qnorm(.975) * ep) |> 

  ggplot(aes(
    x = ano,
    y = taxa_enc_media, color = taxon_validado, shape = categoria)) +
  # geom_errorbar(
  #   aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
  #   size = 0.8,
  #   linewidth = 0.5,
  #   width = 0.1,
  #   colour = "cyan4") +
  geom_line(size = 0.5) +
  geom_point(size = 3, alpha = 0.8) +
  
    theme_minimal() +
    theme(
      panel.grid.minor.y = element_blank(),
      #panel.grid.major.y = element_blank(),
      panel.grid.minor.x = element_blank(),
      panel.grid.major.x = element_blank(),
      axis.text=element_text(size=10),
      axis.text.x = element_text(size = 12),
      axis.text.y = element_text(size = 11),
      axis.title.y = element_text(size = 11, margin = margin(r = 10)),
      axis.title.x = element_text(size = 11, margin = margin(t = 10)),
      #axis.line.y = element_line(),
      #axis.ticks.y = element_line(),
      title = element_text(size = 10),
      legend.text=element_text(size=10),
      legend.position = "right",
      legend.title = element_blank()) +
      scale_color_manual(values = cor_ameacadas1) +
      scale_y_continuous(limits = c(0, 1.5)) +
      scale_x_continuous(breaks = taxa_encontro_spp_ameacadas$ano) +
      labs(title = "Outros Primatas",
       x = "Ano",
       y = "Avistamentos/10 km",
       col = NULL)

G_especie_ameacada_ucs_ano_media_outros_primatas

# ggsave("imagens/cap05/G_especie_ameacada_ucs_ano_media_outros_primatas.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r figura das espécies ameaçadas no tempo - Tamanduá}
#| label: fig-especies-ameacadas-tamandua
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Taxas médias de avistamento estimadas por ano para a espécie ameaçada tamanduá-bandeira (*Myrmecophaga tridactyla*). Os pontos representam valores médios obtidos a partir das taxas registradas para diferentes unidades de conservação. As barras de variação e o número de registros para cada ano não são apresentados para maior clareza da figura."



cor_ameacadas3 <- c("cyan4")

G_especie_ameacada_ucs_ano_media_tamandua <- taxa_encontro_spp_ameacadas |>
  group_by(ano, classe, ordem, taxon_validado, categoria) |> 
  filter(taxon_validado %in% c("Myrmecophaga tridactyla")) |>
  summarise(n = n(),
            taxa_enc_media = mean(taxa_encontro),
            sd = sd(taxa_encontro),
            ep = sd / sqrt(n),
            IC_95 = qnorm(.975) * ep) |> 

  ggplot(aes(
    x = ano,
    y = taxa_enc_media, color = taxon_validado, shape = categoria)) +
  # geom_errorbar(
  #   aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
  #   size = 0.8,
  #   linewidth = 0.5,
  #   width = 0.1,
  #   colour = "cyan4") +
  geom_line(size = 0.5) +
  geom_point(size = 3, alpha = 0.8) +
  
    theme_minimal() +
    theme(
      panel.grid.minor.y = element_blank(),
      #panel.grid.major.y = element_blank(),
      panel.grid.minor.x = element_blank(),
      panel.grid.major.x = element_blank(),
      axis.text=element_text(size=10),
      axis.text.x = element_text(size = 12),
      axis.text.y = element_text(size = 11),
      axis.title.y = element_text(size = 11, margin = margin(r = 10)),
      axis.title.x = element_text(size = 11, margin = margin(t = 10)),
      #axis.line.y = element_line(),
      #axis.ticks.y = element_line(),
      title = element_text(size = 10),
      legend.text=element_text(size=10),
      legend.position = "right",
      legend.title = element_blank()) +
      scale_color_manual(values = cor_ameacadas3) +
      scale_y_continuous(limits = c(0, 0.5)) +
      scale_x_continuous(breaks = taxa_encontro_spp_ameacadas$ano) +
      labs(title = "Outros mamíferos",
       x = "Ano",
       y = "Avistamentos/10 km",
       col = NULL)

G_especie_ameacada_ucs_ano_media_tamandua

# ggsave("imagens/cap05/G_especie_ameacada_ucs_ano_media_tamandua.png", height = 4.5, width = 6, units = "in", dpi = 300)

```

```{r figura das espécies ameaçadas no tempo - aves}
#| label: fig-especies-ameacadas-aves
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Taxas médias de avistamento estimadas por ano para cinco espécies de aves ameaçadas. Os pontos representam valores médios obtidos a partir das taxas registradas para diferentes unidades de conservação. As barras de variação e o número de registros para cada ano não são apresentados para maior clareza da figura. "


cor_ameacadas1 <- c("#008B8B", "#70C4C4", "#666666", "#BF8120", "brown")



G_especie_ameacada_ucs_ano_media_aves_selecionadas <- taxa_encontro_spp_ameacadas |>
  group_by(ano, classe, ordem, taxon_validado, categoria) |> 
  filter(taxon_validado %in% c("Aburria cujubi", "Psophia obscura", "Psophia dextralis", "Psophia interjecta", "Psophia viridis")) |>
  summarise(n = n(),
            taxa_enc_media = mean(taxa_encontro),
            sd = sd(taxa_encontro),
            ep = sd / sqrt(n),
            IC_95 = qnorm(.975) * ep) |> 

  ggplot(aes(
    x = ano,
    y = taxa_enc_media, color = taxon_validado, shape = categoria)) +
  # geom_errorbar(
  #   aes(ymin = taxa_enc_media - IC_95, ymax = taxa_enc_media + IC_95),
  #   size = 0.8,
  #   linewidth = 0.5,
  #   width = 0.1,
  #   colour = "cyan4") +
  geom_line(size = 0.5) +
  geom_point(size = 3, alpha = 0.8) +
  
    theme_minimal() +
    theme(
      panel.grid.minor.y = element_blank(),
      #panel.grid.major.y = element_blank(),
      panel.grid.minor.x = element_blank(),
      panel.grid.major.x = element_blank(),
      axis.text=element_text(size=10),
      axis.text.x = element_text(size = 12),
      axis.text.y = element_text(size = 11),
      axis.title.y = element_text(size = 11, margin = margin(r = 10)),
      axis.title.x = element_text(size = 11, margin = margin(t = 10)),
      #axis.line.y = element_line(),
      #axis.ticks.y = element_line(),
      title = element_text(size = 10),
      legend.text=element_text(size=10),
      legend.position = "right",
      legend.title = element_blank()) +
      scale_color_manual(values = cor_ameacadas1) +
      scale_y_continuous(limits = c(0, 1.5)) +
      scale_x_continuous(breaks = taxa_encontro_spp_ameacadas$ano) +
      labs(title = "Aves ameaçadas",
       x = "Ano",
       y = "Avistamentos/10 km",
       col = NULL)

G_especie_ameacada_ucs_ano_media_aves_selecionadas

# ggsave("imagens/cap05/G_especie_ameacada_ucs_ano_media_aves_selecionadas.png", height = 4.5, width = 6, units = "in", dpi = 300)

```
</br>

### Média Geométrica das populações (Living Planet Index -- LPI)


A média geométrica das abundâncias relativas é uma medida de escolha para monitoramento de tendências da biodiversidade em diversos programas (Buckland et al., 2005; @Green_2019). Este índice reflete tendências na abundância e equitabilidade entre as populações, e não é afetado pelo ano base escolhido nem por variações inter-populacionais na detectabilidade, por ser baseado em tendências intra-populacionais (@Buckland_2011; @Van_Strien_2012). Para o cálculo da média geométrica, utilizamos dados de 160 populações em 22 UCs. Somente foram incluídas populações com pelo menos cinco anos de monitoramento, taxa de encontro média \> 0.5 encontros a cada 10 km, e com esforço amostral suficiente para atingir um coeficiente de variação da taxa de encontro ≥ 0.25. A média geométrica e seu intervalo de confiança foram estimados por bootstrap seguindo as recomendações de (@Buckland_2005, @Buckland_2011).

</br>

#### Resultado da Média Geométrica


A média geométrica das abundâncias relativas das populações analisadas permaneceu estável ao longo do monitoramento, com o intervalo de 95% de credibilidade incluindo a linha de base durante todo o período (@fig-media-geometrica). Esse resultado sugere que as UCs monitoradas tem sido efetivas para a conservação das espécies de aves e mamíferos alvo do Programa Monitora. Embora essa seja uma ótima notícia, ela deve ser interpretada em seu devido contexto, em especial considerando que o protocolo foca principalmente espécies relativamente comuns e ecologicamente flexíveis, que a duração do monitoramento foi relativamente curta em relação à longevidade das espécies-alvo, e que a maioria das estações amostrais foi estabelecida em áreas de referência (áreas íntegras no interior das UCs), representando cenários ideais e não necessariamente os gradientes de pressão que atuam sobre a biodiversidade na escala regional e/ou fora das UCs. A continuação do monitoramento e o estabelecimento de estações amostrais em áreas impactadas pode elucidar melhor as tendências da biodiversidade.

```{r média geométrica}
#| label: fig-media-geometrica
#| echo: false
#| message: false
#| warning: false
#| cache: true
#| fig.pos: 'H'
#| out.width: '70%'
#| fig-cap: "Média geométrica das estimativas de abundãncia relativa para 160 populações monitoradas. A linha branca escura corresponde aos valores médios; as faixas azuladasombreadas, ao intervalo de confiança de 90 e 95%."

knitr::include_graphics("imagens/cap05/ma_media_geometrica.JPG")

```

</br>

## Destaques

</br>

<font color="red">*There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable. If you are going to use a passage of Lorem Ipsum, you need to be sure there isn't anything embarrassing hidden in the middle of text. All the Lorem Ipsum generators on the Internet tend to repeat predefined chunks as necessary, making this the first true generator on the Internet. It uses a dictionary of over 200 Latin words, combined with a handful of model sentence structures, to generate Lorem Ipsum which looks reasonable. The generated Lorem Ipsum is therefore always free from repetition, injected humour, or non-characteristic words etc.*</font>

</br>

## Discussão

</br>

<font color="red">*There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable. If you are going to use a passage of Lorem Ipsum, you need to be sure there isn't anything embarrassing hidden in the middle of text. All the Lorem Ipsum generators on the Internet tend to repeat predefined chunks as necessary, making this the first true generator on the Internet. It uses a dictionary of over 200 Latin words, combined with a handful of model sentence structures, to generate Lorem Ipsum which looks reasonable. The generated Lorem Ipsum is therefore always free from repetition, injected humour, or non-characteristic words etc.*</font>

</br>

## Recomendações

</br>

<font color="red">*There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable. If you are going to use a passage of Lorem Ipsum, you need to be sure there isn't anything embarrassing hidden in the middle of text. All the Lorem Ipsum generators on the Internet tend to repeat predefined chunks as necessary, making this the first true generator on the Internet. It uses a dictionary of over 200 Latin words, combined with a handful of model sentence structures, to generate Lorem Ipsum which looks reasonable. The generated Lorem Ipsum is therefore always free from repetition, injected humour, or non-characteristic words etc.*</font>

